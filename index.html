<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowState Pro - AI Task Management Platform</title>
    <meta name="description" content="AI-powered task management platform with intelligent scheduling, voice integration, and collaboration features">
    <meta name="theme-color" content="var(--primary-color)">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }
    </script>
    
    <style>
        :root {
            /* Light Theme - Professional */
            --bg-primary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --bg-tertiary: rgba(248, 250, 252, 0.9);
            --text-primary: #1a202c;
            --text-secondary: #64748b;
            --text-accent: #3b82f6;
            --border-color: rgba(0, 0, 0, 0.08);
            --shadow-primary: 0 10px 25px rgba(0, 0, 0, 0.08);
            --shadow-secondary: 0 4px 12px rgba(0, 0, 0, 0.04);
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --card-bg: rgba(255, 255, 255, 0.9);
            --accent-gradient: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        [data-theme="dark"] {
            /* Dark Theme - Modern */
            --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --bg-secondary: rgba(15, 23, 42, 0.95);
            --bg-tertiary: rgba(30, 41, 59, 0.9);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-accent: #60a5fa;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-primary: 0 25px 50px rgba(0, 0, 0, 0.4);
            --shadow-secondary: 0 8px 25px rgba(0, 0, 0, 0.2);
            --primary-color: #60a5fa;
            --success-color: #34d399;
            --warning-color: #fbbf24;
            --danger-color: #f87171;
            --card-bg: rgba(15, 23, 42, 0.95);
            --accent-gradient: linear-gradient(135deg, #60a5fa, #3730a3);
        }

        [data-theme="elegant"] {
            /* Elegant Theme - Premium */
            --bg-primary: linear-gradient(135deg, #fdf4ff 0%, #f3e8ff 100%);
            --bg-secondary: rgba(253, 244, 255, 0.95);
            --bg-tertiary: rgba(243, 232, 255, 0.9);
            --text-primary: #581c87;
            --text-secondary: #7c3aed;
            --text-accent: #a855f7;
            --border-color: rgba(139, 92, 246, 0.15);
            --shadow-primary: 0 20px 40px rgba(139, 92, 246, 0.15);
            --shadow-secondary: 0 8px 20px rgba(139, 92, 246, 0.08);
            --primary-color: #8b5cf6;
            --success-color: #06d6a0;
            --warning-color: #ffd60a;
            --danger-color: #ff006e;
            --card-bg: rgba(253, 244, 255, 0.9);
            --accent-gradient: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
        }

        /* Layout Components */
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--bg-secondary);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: var(--shadow-primary);
            border: 1px solid var(--border-color);
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .app-logo {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            font-weight: 700;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .app-name {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .app-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-left: 4px;
            font-weight: 500;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
        }

        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            text-align: center;
        }

        .nav-tab:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards and Components */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
            transition: all 0.3s ease;
            margin-bottom: 24px;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
            text-decoration: none;
            justify-content: center;
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        /* File Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: var(--bg-tertiary);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-zone:hover {
            border-color: var(--primary-color);
            background: var(--card-bg);
        }

        .upload-zone.dragover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .upload-subtext {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Task Components */
        .task-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .task-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-secondary);
        }

        .task-card.priority-high {
            border-left: 4px solid var(--danger-color);
        }

        .task-card.priority-medium {
            border-left: 4px solid var(--warning-color);
        }

        .task-card.priority-low {
            border-left: 4px solid var(--success-color);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .task-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 4px;
        }

        .task-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .task-priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .task-priority.high {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .task-priority.medium {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .task-priority.low {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .task-progress {
            margin-top: 12px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        /* Voice Interface */
        .voice-interface {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .voice-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: var(--accent-gradient);
            color: white;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }

        .voice-btn.listening {
            background: var(--danger-color);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Notifications */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }

        .notification {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
            backdrop-filter: blur(20px);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            border-left: 4px solid var(--success-color);
        }

        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }

        .notification.error {
            border-left: 4px solid var(--danger-color);
        }

        /* Analytics Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-secondary);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Team Collaboration */
        .team-member {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .member-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--accent-gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .member-role {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .member-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .app-container {
                padding: 20px;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .task-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .nav-tab {
                font-size: 12px;
                padding: 10px 16px;
            }
            
            .voice-interface {
                bottom: 20px;
                right: 20px;
            }
            
            .voice-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .show { display: block !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }
        .p-4 { padding: 16px; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-4 { gap: 16px; }
    </style>
</head>
<body data-theme="light">
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Voice Interface -->
    <div class="voice-interface">
        <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()" title="Voice Commands">
            🎤
        </button>
    </div>

    <div class="app-container">
        <!-- App Header -->
        <div class="app-header">
            <div class="app-title">
                <div class="app-logo">FS</div>
                <div>
                    <div class="app-name">FlowState Pro</div>
                    <div class="app-subtitle">AI-Powered Task Management Platform</div>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex gap-2">
                    <button class="btn btn-secondary btn-small" onclick="setTheme('light')">Light</button>
                    <button class="btn btn-secondary btn-small" onclick="setTheme('dark')">Dark</button>
                    <button class="btn btn-secondary btn-small" onclick="setTheme('elegant')">Elegant</button>
                </div>
                <div class="flex items-center gap-2">
                    <div class="member-status"></div>
                    <span style="font-size: 14px; color: var(--text-secondary);">AI Active</span>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">🏠 Dashboard</button>
            <button class="nav-tab" onclick="switchTab('import')">📄 Import & Parse</button>
            <button class="nav-tab" onclick="switchTab('tasks')">✅ Smart Tasks</button>
            <button class="nav-tab" onclick="switchTab('analytics')">📊 Analytics</button>
            <button class="nav-tab" onclick="switchTab('collaboration')">👥 Teams</button>
            <button class="nav-tab" onclick="switchTab('integrations')">🔗 Integrations</button>
            <button class="nav-tab" onclick="switchTab('ai-chat')">🤖 AI Assistant</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Quick Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="productivityScore">0%</div>
                    <div class="stat-label">Productivity Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="weeklyStreak">0</div>
                    <div class="stat-label">Weekly Streak</div>
                </div>
            </div>

            <!-- Today's Priority Tasks -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">🎯 Today's Priority Tasks</div>
                        <div class="card-subtitle">AI-optimized task prioritization based on deadlines and importance</div>
                    </div>
                    <button class="btn btn-primary btn-small" onclick="showTaskCreator()">
                        ➕ Quick Add
                    </button>
                </div>
                <div id="priorityTasks">
                    <div class="text-center p-4" style="color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px;">📋</div>
                        <div>No priority tasks for today. Import your schedule to get started!</div>
                    </div>
                </div>
            </div>

            <!-- AI Insights -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">🧠 AI Productivity Insights</div>
                        <div class="card-subtitle">Personalized recommendations based on your work patterns</div>
                    </div>
                </div>
                <div id="aiInsights">
                    <div class="flex gap-4">
                        <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 8px;">🕘 Peak Productivity Hours</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">9:00 AM - 11:00 AM based on completion patterns</div>
                        </div>
                        <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 8px;">⚡ Focus Recommendation</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Try 25-minute focus blocks for optimal performance</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import & Parse Tab -->
        <div id="import" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">📄 Digital Tracksheet & Schedule Parser</div>
                        <div class="card-subtitle">Import and automatically parse tasks from various file formats</div>
                    </div>
                </div>
                
                <!-- File Upload Zone -->
                <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">Drop files here or click to upload</div>
                    <div class="upload-subtext">Supports PDF, Excel, CSV, Google Sheets, and images (OCR)</div>
                </div>
                <input type="file" id="fileInput" multiple accept=".pdf,.xlsx,.xls,.csv,.jpg,.png" style="display: none;" onchange="handleFileUpload(event)">

                <!-- Processing Status -->
                <div id="processingStatus" class="hidden">
                    <div class="flex items-center gap-3 p-4" style="background: var(--bg-tertiary); border-radius: 8px; margin-top: 20px;">
                        <div style="width: 20px; height: 20px; border: 2px solid var(--primary-color); border-top: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <div>
                            <div style="font-weight: 600;">Processing your files...</div>
                            <div style="font-size: 14px; color: var(--text-secondary);" id="processingText">Analyzing document structure and extracting tasks</div>
                        </div>
                    </div>
                </div>

                <!-- Parsed Results -->
                <div id="parsedResults" class="hidden mt-4">
                    <div class="card-title mb-4">📋 Extracted Tasks</div>
                    <div id="extractedTasks"></div>
                    <div class="flex gap-3 mt-4">
                        <button class="btn btn-primary" onclick="importAllTasks()">Import All Tasks</button>
                        <button class="btn btn-secondary" onclick="reviewTasks()">Review & Edit</button>
                    </div>
                </div>
            </div>

            <!-- OCR and AI Analysis -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">🔍 AI-Powered Content Analysis</div>
                        <div class="card-subtitle">Advanced NLP processing for unstructured data</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Paste Text or Notes</label>
                    <textarea class="form-input" id="textInput" rows="6" placeholder="Paste your syllabus, meeting notes, or project plans here for AI analysis..."></textarea>
                </div>
                
                <div class="flex gap-3">
                    <button class="btn btn-primary" onclick="analyzeText()">🧠 Analyze with AI</button>
                    <button class="btn btn-secondary" onclick="clearText()">Clear</button>
                </div>

                <!-- Analysis Results -->
                <div id="analysisResults" class="hidden mt-4">
                    <div class="card-title mb-4">🎯 AI Analysis Results</div>
                    <div id="analysisContent"></div>
                </div>
            </div>
        </div>

        <!-- Smart Tasks Tab -->
        <div id="tasks" class="tab-content">
            <!-- Task Creation Panel -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">✨ Intelligent Task Creator</div>
                        <div class="card-subtitle">AI-powered task generation with smart prioritization</div>
                    </div>
                </div>
                
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label class="form-label">Task Description</label>
                        <input type="text" class="form-input" id="newTaskTitle" placeholder="e.g., Complete research paper on AI ethics">
                    </div>
                    <div style="flex: 0 0 200px;">
                        <label class="form-label">Due Date</label>
                        <input type="datetime-local" class="form-input" id="newTaskDue">
                    </div>
                </div>
                
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label class="form-label">Priority</label>
                        <select class="form-input" id="newTaskPriority">
                            <option value="high">🔴 High Priority</option>
                            <option value="medium" selected>🟡 Medium Priority</option>
                            <option value="low">🟢 Low Priority</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="form-label">Estimated Duration</label>
                        <select class="form-input" id="newTaskDuration">
                            <option value="15">15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="60" selected>1 hour</option>
                            <option value="120">2 hours</option>
                            <option value="240">4 hours</option>
                            <option value="custom">Custom...</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button class="btn btn-primary" onclick="createIntelligentTask()">🤖 Create with AI</button>
                    <button class="btn btn-secondary" onclick="createBasicTask()">➕ Add Simple Task</button>
                    <button class="btn btn-secondary" onclick="enableVoiceTask()">🎤 Voice Create</button>
                </div>
            </div>

            <!-- Task Management Views -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">📋 Task Management</div>
                        <div class="card-subtitle">Organize and track your tasks efficiently</div>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-secondary btn-small" onclick="setTaskView('list')" id="listViewBtn">📄 List</button>
                        <button class="btn btn-secondary btn-small" onclick="setTaskView('kanban')" id="kanbanViewBtn">📊 Kanban</button>
                        <button class="btn btn-secondary btn-small" onclick="setTaskView('calendar')" id="calendarViewBtn">📅 Calendar</button>
                    </div>
                </div>
                
                <!-- List View -->
                <div id="listView" class="task-view">
                    <div id="taskList">
                        <div class="text-center p-4" style="color: var(--text-secondary);">
                            <div style="font-size: 48px; margin-bottom: 16px;">📝</div>
                            <div>No tasks yet. Create your first task above!</div>
                        </div>
                    </div>
                </div>

                <!-- Kanban View -->
                <div id="kanbanView" class="task-view hidden">
                    <div class="flex gap-4" style="min-height: 400px;">
                        <div class="flex-1">
                            <div class="card-title mb-3">📝 To Do</div>
                            <div id="todoColumn" class="task-column" style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; min-height: 300px;"></div>
                        </div>
                        <div class="flex-1">
                            <div class="card-title mb-3">🔄 In Progress</div>
                            <div id="progressColumn" class="task-column" style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; min-height: 300px;"></div>
                        </div>
                        <div class="flex-1">
                            <div class="card-title mb-3">✅ Completed</div>
                            <div id="completedColumn" class="task-column" style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; min-height: 300px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Calendar View -->
                <div id="calendarView" class="task-view hidden">
                    <div class="text-center p-4" style="color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px;">📅</div>
                        <div>Calendar view coming soon with full scheduling integration!</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <!-- Productivity Dashboard -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">📈 Productivity Analytics</div>
                        <div class="card-subtitle">Comprehensive insights into your work patterns and efficiency</div>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-secondary btn-small" onclick="setAnalyticsPeriod('week')">Week</button>
                        <button class="btn btn-secondary btn-small" onclick="setAnalyticsPeriod('month')">Month</button>
                        <button class="btn btn-secondary btn-small" onclick="setAnalyticsPeriod('quarter')">Quarter</button>
                    </div>
                </div>
                
                <!-- Chart Container -->
                <div style="height: 400px; margin-bottom: 30px;">
                    <canvas id="productivityChart"></canvas>
                </div>
            </div>

            <!-- Detailed Analytics -->
            <div class="flex gap-4">
                <div class="flex-1 card">
                    <div class="card-title mb-4">⏱️ Time Distribution</div>
                    <div style="height: 300px;">
                        <canvas id="timeChart"></canvas>
                    </div>
                </div>
                <div class="flex-1 card">
                    <div class="card-title mb-4">🎯 Goal Progress</div>
                    <div id="goalProgress">
                        <div class="mb-4">
                            <div class="flex justify-between mb-2">
                                <span>Weekly Tasks Goal</span>
                                <span>12/15</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 80%"></div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="flex justify-between mb-2">
                                <span>Focus Time Goal</span>
                                <span>18/25 hours</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 72%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Insights Panel -->
            <div class="card">
                <div class="card-title mb-4">🧠 AI Performance Insights</div>
                <div class="flex gap-4">
                    <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">📊 Pattern Analysis</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">You're 23% more productive on Tuesdays and Wednesdays. Consider scheduling important tasks on these days.</div>
                    </div>
                    <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">🎯 Optimization Tip</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Break large tasks into 45-minute blocks for 15% better completion rates based on your history.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Team Collaboration Tab -->
        <div id="collaboration" class="tab-content">
            <!-- Team Overview -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">👥 Team Collaboration</div>
                        <div class="card-subtitle">Shared workspaces and real-time collaboration</div>
                    </div>
                    <button class="btn btn-primary" onclick="createTeam()">➕ Create Team</button>
                </div>
                
                <div class="flex gap-4">
                    <div class="flex-1">
                        <div class="card-title mb-3">👥 Team Members</div>
                        <div id="teamMembers">
                            <div class="team-member">
                                <div class="member-avatar">JD</div>
                                <div class="member-info">
                                    <div class="member-name">John Doe</div>
                                    <div class="member-role">Project Manager</div>
                                </div>
                                <div class="member-status"></div>
                            </div>
                            <div class="team-member">
                                <div class="member-avatar">SM</div>
                                <div class="member-info">
                                    <div class="member-name">Sarah Miller</div>
                                    <div class="member-role">Developer</div>
                                </div>
                                <div class="member-status"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex-1">
                        <div class="card-title mb-3">📋 Shared Projects</div>
                        <div id="sharedProjects">
                            <div class="task-card">
                                <div class="task-header">
                                    <div class="task-title">Website Redesign</div>
                                    <div class="task-priority medium">Medium</div>
                                </div>
                                <div class="task-meta">
                                    <span>Due: Dec 15</span>
                                    <span>3 members</span>
                                </div>
                                <div class="task-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 65%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time Activity Feed -->
            <div class="card">
                <div class="card-title mb-4">📢 Activity Feed</div>
                <div id="activityFeed">
                    <div class="flex gap-3 mb-4 p-3" style="background: var(--bg-tertiary); border-radius: 8px;">
                        <div class="member-avatar" style="width: 32px; height: 32px; font-size: 12px;">SM</div>
                        <div class="flex-1">
                            <div style="font-weight: 600; font-size: 14px;">Sarah Miller completed "API Integration"</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">2 minutes ago</div>
                        </div>
                    </div>
                    <div class="flex gap-3 mb-4 p-3" style="background: var(--bg-tertiary); border-radius: 8px;">
                        <div class="member-avatar" style="width: 32px; height: 32px; font-size: 12px;">JD</div>
                        <div class="flex-1">
                            <div style="font-weight: 600; font-size: 14px;">John Doe added new task "User Testing"</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">15 minutes ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Integrations Tab -->
        <div id="integrations" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">🔗 Platform Integrations</div>
                        <div class="card-subtitle">Connect with your favorite tools and services</div>
                    </div>
                </div>
                
                <div class="flex gap-4 flex-col">
                    <!-- Calendar Integrations -->
                    <div>
                        <div class="card-title mb-3">📅 Calendar Sync</div>
                        <div class="flex gap-4">
                            <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div style="font-weight: 600;">Google Calendar</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Two-way sync with Google Calendar</div>
                                    </div>
                                    <button class="btn btn-primary btn-small" onclick="connectCalendar('google')">Connect</button>
                                </div>
                            </div>
                            <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div style="font-weight: 600;">Microsoft Outlook</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Sync with Office 365 calendar</div>
                                    </div>
                                    <button class="btn btn-primary btn-small" onclick="connectCalendar('outlook')">Connect</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Productivity Apps -->
                    <div>
                        <div class="card-title mb-3">⚡ Productivity Tools</div>
                        <div class="flex gap-4">
                            <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div style="font-weight: 600;">Notion</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Sync tasks with Notion databases</div>
                                    </div>
                                    <button class="btn btn-primary btn-small" onclick="connectApp('notion')">Connect</button>
                                </div>
                            </div>
                            <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div style="font-weight: 600;">Slack</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Create tasks from Slack messages</div>
                                    </div>
                                    <button class="btn btn-primary btn-small" onclick="connectApp('slack')">Connect</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cloud Storage -->
                    <div>
                        <div class="card-title mb-3">☁️ Cloud Storage</div>
                        <div class="flex gap-4">
                            <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div style="font-weight: 600;">Google Drive</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Access and organize project files</div>
                                    </div>
                                    <button class="btn btn-primary btn-small" onclick="connectStorage('gdrive')">Connect</button>
                                </div>
                            </div>
                            <div class="flex-1 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div style="font-weight: 600;">OneDrive</div>
                                        <div style="font-size: 14px; color: var(--text-secondary);">Microsoft 365 file integration</div>
                                    </div>
                                    <button class="btn btn-primary btn-small" onclick="connectStorage('onedrive')">Connect</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Assistant Tab -->
        <div id="ai-chat" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">🤖 AI Productivity Assistant</div>
                        <div class="card-subtitle">Natural language interaction for task management and productivity insights</div>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-secondary btn-small" onclick="clearChat()">Clear Chat</button>
                        <button class="btn btn-secondary btn-small" onclick="exportChat()">Export</button>
                    </div>
                </div>
                
                <!-- Chat Interface -->
                <div style="height: 500px; display: flex; flex-direction: column;">
                    <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-tertiary); border-radius: 12px; margin-bottom: 20px;">
                        <div style="text-align: center; color: var(--text-secondary); padding: 40px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">🤖</div>
                            <div>Hi! I'm your AI productivity assistant. I can help you:</div>
                            <div style="margin-top: 12px; font-size: 14px;">
                                • Create and organize tasks<br>
                                • Analyze your productivity patterns<br>
                                • Provide personalized recommendations<br>
                                • Schedule and prioritize work<br>
                                • Answer questions about task management
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Input -->
                    <div class="flex gap-3">
                        <input type="text" class="form-input flex-1" id="chatInput" placeholder="Ask me anything about your tasks, productivity, or schedule..." onkeypress="handleChatKeyPress(event)">
                        <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
                        <button class="btn btn-secondary" onclick="startVoiceInput()">🎤</button>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="flex gap-2 mt-3" style="flex-wrap: wrap;">
                        <button class="btn btn-secondary btn-small" onclick="quickChatAction('schedule')">📅 Show Schedule</button>
                        <button class="btn btn-secondary btn-small" onclick="quickChatAction('progress')">📊 My Progress</button>
                        <button class="btn btn-secondary btn-small" onclick="quickChatAction('tips')">💡 Productivity Tips</button>
                        <button class="btn btn-secondary btn-small" onclick="quickChatAction('focus')">🎯 Focus Session</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let currentTheme = 'light';
        let currentTab = 'dashboard';
        let currentTaskView = 'list';
        let tasks = [];
        let teams = [];
        let integrations = {};
        let analytics = {};
        let voiceRecognition = null;
        let isListening = false;

        // AI Assistant Engine
        class AIProductivityAssistant {
            constructor() {
                this.context = [];
                this.userPatterns = {};
                this.knowledge = {
                    productivity: {
                        techniques: ['Pomodoro', 'Time Blocking', 'Eisenhower Matrix', 'Getting Things Done'],
                        tips: [
                            'Break large tasks into smaller, manageable subtasks',
                            'Use the 2-minute rule: if it takes less than 2 minutes, do it now',
                            'Schedule your most important tasks during your peak energy hours',
                            'Batch similar tasks together to minimize context switching',
                            'Take regular breaks to maintain focus and avoid burnout'
                        ]
                    },
                    scheduling: {
                        algorithms: ['Priority-based', 'Deadline-driven', 'Energy-optimized'],
                        strategies: [
                            'Time block your calendar with specific tasks',
                            'Leave buffer time between meetings',
                            'Schedule demanding work during peak hours',
                            'Batch similar activities together'
                        ]
                    }
                };
            }

            async processMessage(message) {
                this.context.push({ message, timestamp: new Date() });
                
                const intent = this.analyzeIntent(message);
                
                switch (intent.type) {
                    case 'task_creation':
                        return await this.handleTaskCreation(intent.data);
                    case 'schedule_query':
                        return this.handleScheduleQuery(intent.data);
                    case 'progress_request':
                        return this.handleProgressRequest();
                    case 'productivity_tips':
                        return this.handleProductivityTips(intent.data);
                    case 'focus_session':
                        return this.handleFocusSession(intent.data);
                    default:
                        return this.handleGeneralQuery(message);
                }
            }

            analyzeIntent(message) {
                const lowerMessage = message.toLowerCase();
                
                // Task creation patterns
                if (lowerMessage.includes('create') || lowerMessage.includes('add') || lowerMessage.includes('task')) {
                    return { type: 'task_creation', data: this.extractTaskData(message) };
                }
                
                // Schedule queries
                if (lowerMessage.includes('schedule') || lowerMessage.includes('when') || lowerMessage.includes('today')) {
                    return { type: 'schedule_query', data: { period: 'today' } };
                }
                
                // Progress requests
                if (lowerMessage.includes('progress') || lowerMessage.includes('how am i doing') || lowerMessage.includes('stats')) {
                    return { type: 'progress_request', data: {} };
                }
                
                // Productivity tips
                if (lowerMessage.includes('tip') || lowerMessage.includes('advice') || lowerMessage.includes('productive')) {
                    return { type: 'productivity_tips', data: { category: 'general' } };
                }
                
                // Focus session
                if (lowerMessage.includes('focus') || lowerMessage.includes('concentrate') || lowerMessage.includes('work session')) {
                    return { type: 'focus_session', data: this.extractFocusData(message) };
                }
                
                return { type: 'general', data: {} };
            }

            extractTaskData(message) {
                // Simple extraction - in production, use more sophisticated NLP
                const timeMatch = message.match(/(\d{1,2}:\d{2}|\d{1,2}\s*(am|pm))/i);
                const durationMatch = message.match(/(\d+)\s*(min|hour|hours)/i);
                
                return {
                    title: message.replace(/create|add|task/gi, '').trim(),
                    time: timeMatch ? timeMatch[0] : null,
                    duration: durationMatch ? this.parseDuration(durationMatch[0]) : 60
                };
            }

            extractFocusData(message) {
                const durationMatch = message.match(/(\d+)\s*(min|hour|hours)/i);
                return {
                    duration: durationMatch ? this.parseDuration(durationMatch[0]) : 25
                };
            }

            parseDuration(durationStr) {
                const match = durationStr.match(/(\d+)\s*(min|hour|hours)/i);
                if (match) {
                    const value = parseInt(match[1]);
                    const unit = match[2].toLowerCase();
                    return unit.includes('hour') ? value * 60 : value;
                }
                return 60;
            }

            async handleTaskCreation(data) {
                if (data.title) {
                    const task = {
                        id: Date.now(),
                        title: data.title,
                        priority: 'medium',
                        dueDate: data.time ? this.parseTime(data.time) : null,
                        duration: data.duration,
                        status: 'todo',
                        createdAt: new Date(),
                        aiGenerated: true
                    };
                    
                    tasks.push(task);
                    updateTaskViews();
                    updateStats();
                    
                    return `✅ **Task Created Successfully!**\n\nI've added "${data.title}" to your task list${data.time ? ` scheduled for ${data.time}` : ''}. The estimated duration is ${data.duration} minutes.\n\n💡 **Tip:** I've automatically set this as medium priority. You can adjust the priority if needed!`;
                }
                
                return "I'd be happy to help you create a task! Please provide more details about what you'd like to add to your task list.";
            }

            handleScheduleQuery(data) {
                const todayTasks = tasks.filter(task => {
                    const taskDate = new Date(task.dueDate || task.createdAt);
                    const today = new Date();
                    return taskDate.toDateString() === today.toDateString();
                });

                if (todayTasks.length === 0) {
                    return "📅 **Today's Schedule**\n\nYou have no scheduled tasks for today. This could be a great opportunity to:\n\n• Plan tomorrow's priorities\n• Tackle any pending tasks\n• Focus on personal development\n• Take a well-deserved break!";
                }

                let response = "📅 **Today's Schedule**\n\n";
                todayTasks.forEach((task, index) => {
                    const priority = task.priority === 'high' ? '🔴' : task.priority === 'medium' ? '🟡' : '🟢';
                    response += `${index + 1}. ${priority} ${task.title}${task.dueDate ? ` (${new Date(task.dueDate).toLocaleTimeString()})` : ''}\n`;
                });

                response += `\n📊 **Summary:** ${todayTasks.length} tasks scheduled for today`;

                return response;
            }

            handleProgressRequest() {
                const totalTasks = tasks.length;
                const completedTasks = tasks.filter(task => task.status === 'completed').length;
                const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

                let response = "📊 **Your Progress Report**\n\n";
                response += `📝 **Tasks:** ${completedTasks}/${totalTasks} completed (${completionRate}%)\n`;
                response += `🎯 **Completion Rate:** ${this.getPerformanceMessage(completionRate)}\n`;
                response += `⏱️ **Productivity:** ${this.calculateProductivityScore()}% today\n\n`;

                // Add personalized insights
                if (completionRate >= 80) {
                    response += "🌟 **Outstanding work!** You're maintaining excellent productivity levels.";
                } else if (completionRate >= 60) {
                    response += "👍 **Good progress!** You're on track with your goals.";
                } else if (completionRate >= 40) {
                    response += "💪 **Keep going!** Small steps lead to big achievements.";
                } else {
                    response += "🚀 **Fresh start!** Every day is a new opportunity to achieve your goals.";
                }

                return response;
            }

            handleProductivityTips(data) {
                const tips = this.knowledge.productivity.tips;
                const randomTip = tips[Math.floor(Math.random() * tips.length)];
                
                let response = "💡 **Productivity Tip**\n\n";
                response += `${randomTip}\n\n`;
                response += "🎯 **Pro Tip:** Try implementing one productivity technique at a time for the best results!";

                return response;
            }

            handleFocusSession(data) {
                const duration = data.duration;
                
                let response = "🎯 **Focus Session Starting**\n\n";
                response += `⏱️ **Duration:** ${duration} minutes\n`;
                response += `🧠 **Technique:** Pomodoro-style focused work\n\n`;
                response += "**During your session:**\n";
                response += "• Turn off notifications\n";
                response += "• Close unnecessary browser tabs\n";
                response += "• Focus on one task at a time\n";
                response += "• Take a 5-minute break when done\n\n";
                response += "🚀 **You've got this! Stay focused and productive!**";

                // Start a focus timer (you can implement actual timer functionality)
                this.startFocusTimer(duration);

                return response;
            }

            handleGeneralQuery(message) {
                const responses = [
                    "I'm here to help you boost your productivity! I can assist with task management, scheduling, progress tracking, and providing personalized recommendations.",
                    "As your AI productivity assistant, I can help you organize tasks, analyze your work patterns, and suggest improvements to optimize your workflow.",
                    "Let me help you achieve your goals! I can create tasks, provide productivity insights, track your progress, and offer personalized coaching.",
                    "I'm equipped with advanced productivity knowledge and can help you with task management, time blocking, focus techniques, and performance analysis."
                ];

                return responses[Math.floor(Math.random() * responses.length)];
            }

            getPerformanceMessage(rate) {
                if (rate >= 90) return "Exceptional performance! 🌟";
                if (rate >= 80) return "Excellent work! 🎯";
                if (rate >= 70) return "Great progress! 👍";
                if (rate >= 60) return "Good momentum! 💪";
                if (rate >= 50) return "Steady progress! 📈";
                return "Building momentum! 🚀";
            }

            calculateProductivityScore() {
                // Simplified productivity calculation
                const completedToday = tasks.filter(task => {
                    const taskDate = new Date(task.createdAt);
                    const today = new Date();
                    return taskDate.toDateString() === today.toDateString() && task.status === 'completed';
                }).length;

                return Math.min(completedToday * 20, 100);
            }

            startFocusTimer(duration) {
                // Implementation for focus timer
                showNotification(`🎯 Focus session started for ${duration} minutes`, 'success');
                
                setTimeout(() => {
                    showNotification('⏰ Focus session complete! Time for a break.', 'success');
                }, duration * 60000);
            }

            parseTime(timeStr) {
                // Simple time parsing
                const now = new Date();
                const timeParts = timeStr.match(/(\d{1,2}):(\d{2})|(\d{1,2})\s*(am|pm)/i);
                
                if (timeParts) {
                    const hour = parseInt(timeParts[1] || timeParts[3]);
                    const minute = parseInt(timeParts[2] || 0);
                    const period = timeParts[4];
                    
                    let finalHour = hour;
                    if (period) {
                        if (period.toLowerCase() === 'pm' && hour !== 12) finalHour += 12;
                        if (period.toLowerCase() === 'am' && hour === 12) finalHour = 0;
                    }
                    
                    const taskDate = new Date();
                    taskDate.setHours(finalHour, minute, 0, 0);
                    
                    return taskDate;
                }
                
                return null;
            }
        }

        // Document Processing Engine
        class DocumentProcessor {
            constructor() {
                this.supportedFormats = ['.pdf', '.xlsx', '.xls', '.csv', '.jpg', '.png'];
            }

            async processFile(file) {
                const extension = this.getFileExtension(file.name);
                
                switch (extension) {
                    case '.pdf':
                        return await this.processPDF(file);
                    case '.xlsx':
                    case '.xls':
                        return await this.processExcel(file);
                    case '.csv':
                        return await this.processCSV(file);
                    case '.jpg':
                    case '.png':
                        return await this.processImage(file);
                    default:
                        throw new Error('Unsupported file format');
                }
            }

            async processPDF(file) {
                // Simulated PDF processing
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            tasks: [
                                { title: 'Complete Chapter 3 Reading', dueDate: '2024-01-15', priority: 'medium' },
                                { title: 'Submit Assignment 2', dueDate: '2024-01-20', priority: 'high' },
                                { title: 'Prepare for Midterm Exam', dueDate: '2024-01-25', priority: 'high' }
                            ],
                            source: 'PDF Syllabus'
                        });
                    }, 2000);
                });
            }

            async processExcel(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            
                            const tasks = jsonData.map((row, index) => ({
                                title: row.Task || row.Title || row.Description || `Task ${index + 1}`,
                                dueDate: row.DueDate || row.Deadline || null,
                                priority: row.Priority || 'medium',
                                duration: row.Duration || 60
                            }));
                            
                            resolve({ tasks, source: 'Excel Spreadsheet' });
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                });
            }

            async processCSV(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const headers = lines[0].split(',');
                        
                        const tasks = lines.slice(1).filter(line => line.trim()).map((line, index) => {
                            const values = line.split(',');
                            return {
                                title: values[0] || `Task ${index + 1}`,
                                dueDate: values[1] || null,
                                priority: values[2] || 'medium',
                                duration: parseInt(values[3]) || 60
                            };
                        });
                        
                        resolve({ tasks, source: 'CSV File' });
                    };
                    reader.readAsText(file);
                });
            }

            async processImage(file) {
                // Simulated OCR processing
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            tasks: [
                                { title: 'Review handwritten notes', dueDate: null, priority: 'low' },
                                { title: 'Follow up on meeting action items', dueDate: null, priority: 'medium' }
                            ],
                            source: 'OCR from Image'
                        });
                    }, 3000);
                });
            }

            getFileExtension(filename) {
                return filename.toLowerCase().substring(filename.lastIndexOf('.'));
            }
        }

        // Voice Recognition Manager
        class VoiceManager {
            constructor() {
                this.initializeVoiceRecognition();
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        isListening = true;
                        document.getElementById('voiceBtn').classList.add('listening');
                    };

                    this.recognition.onend = () => {
                        isListening = false;
                        document.getElementById('voiceBtn').classList.remove('listening');
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processVoiceCommand(transcript);
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        showNotification('Voice recognition error. Please try again.', 'error');
                    };
                }
            }

            startListening() {
                if (this.recognition && !isListening) {
                    this.recognition.start();
                }
            }

            processVoiceCommand(transcript) {
                console.log('Voice command:', transcript);
                
                // Add to chat if on AI chat tab
                if (currentTab === 'ai-chat') {
                    document.getElementById('chatInput').value = transcript;
                    sendChatMessage();
                } else {
                    // Process as general command
                    aiAssistant.processMessage(transcript).then(response => {
                        showNotification(response.substring(0, 100) + '...', 'success');
                    });
                }
            }

            speak(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    speechSynthesis.speak(utterance);
                }
            }
        }

        // Initialize Managers
        const aiAssistant = new AIProductivityAssistant();
        const documentProcessor = new DocumentProcessor();
        const voiceManager = new VoiceManager();

        // UI Functions
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            // Load tab-specific data
            if (tabName === 'analytics') {
                loadAnalytics();
            }
        }

        function setTheme(themeName) {
            currentTheme = themeName;
            document.body.setAttribute('data-theme', themeName);
            
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.trim() === themeName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            showNotification(`Theme changed to ${themeName}`, 'success');
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 4px;">${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'} Notification</div>
                <div style="font-size: 14px;">${message}</div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // File Upload Handling
        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            processFiles(files);
        }

        async function processFiles(files) {
            const processingStatus = document.getElementById('processingStatus');
            const processingText = document.getElementById('processingText');
            const parsedResults = document.getElementById('parsedResults');
            
            processingStatus.classList.remove('hidden');
            parsedResults.classList.add('hidden');
            
            try {
                const allTasks = [];
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    processingText.textContent = `Processing ${file.name}... (${i + 1}/${files.length})`;
                    
                    const result = await documentProcessor.processFile(file);
                    allTasks.push(...result.tasks);
                }
                
                displayExtractedTasks(allTasks);
                processingStatus.classList.add('hidden');
                parsedResults.classList.remove('hidden');
                
            } catch (error) {
                showNotification(`Error processing files: ${error.message}`, 'error');
                processingStatus.classList.add('hidden');
            }
        }

        function displayExtractedTasks(extractedTasks) {
            const container = document.getElementById('extractedTasks');
            container.innerHTML = '';
            
            extractedTasks.forEach((task, index) => {
                const taskElement = document.createElement('div');
                taskElement.className = 'task-card';
                taskElement.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <div class="task-priority ${task.priority}">${task.priority}</div>
                    </div>
                    <div class="task-meta">
                        ${task.dueDate ? `<span>Due: ${task.dueDate}</span>` : ''}
                        <span>Duration: ${task.duration || 60} min</span>
                    </div>
                `;
                container.appendChild(taskElement);
            });
            
            // Store extracted tasks for import
            window.extractedTasks = extractedTasks;
        }

        function importAllTasks() {
            if (window.extractedTasks) {
                window.extractedTasks.forEach(task => {
                    tasks.push({
                        id: Date.now() + Math.random(),
                        title: task.title,
                        priority: task.priority,
                        dueDate: task.dueDate,
                        duration: task.duration || 60,
                        status: 'todo',
                        createdAt: new Date(),
                        imported: true
                    });
                });
                
                updateTaskViews();
                updateStats();
                showNotification(`Imported ${window.extractedTasks.length} tasks successfully!`, 'success');
                
                // Clear extracted tasks
                window.extractedTasks = null;
                document.getElementById('parsedResults').classList.add('hidden');
            }
        }

        // Text Analysis
        async function analyzeText() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            
            if (!text) {
                showNotification('Please enter some text to analyze', 'error');
                return;
            }
            
            const analysisResults = document.getElementById('analysisResults');
            const analysisContent = document.getElementById('analysisContent');
            
            analysisContent.innerHTML = `
                <div class="flex items-center gap-3 p-4" style="background: var(--bg-tertiary); border-radius: 8px;">
                    <div style="width: 20px; height: 20px; border: 2px solid var(--primary-color); border-top: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <div>Analyzing text with AI...</div>
                </div>
            `;
            analysisResults.classList.remove('hidden');
            
            // Simulate AI analysis
            setTimeout(() => {
                const analyzedTasks = [
                    { title: 'Review course syllabus', priority: 'medium', dueDate: null },
                    { title: 'Prepare for upcoming exam', priority: 'high', dueDate: null },
                    { title: 'Complete reading assignments', priority: 'medium', dueDate: null }
                ];
                
                analysisContent.innerHTML = '';
                analyzedTasks.forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = 'task-card';
                    taskElement.innerHTML = `
                        <div class="task-header">
                            <div class="task-title">${task.title}</div>
                            <div class="task-priority ${task.priority}">${task.priority}</div>
                        </div>
                        <div class="task-meta">
                            <span>AI-extracted from text</span>
                        </div>
                    `;
                    analysisContent.appendChild(taskElement);
                });
                
                // Store for import
                window.extractedTasks = analyzedTasks;
                
                // Add import button
                const importButton = document.createElement('button');
                importButton.className = 'btn btn-primary mt-4';
                importButton.textContent = 'Import These Tasks';
                importButton.onclick = importAllTasks;
                analysisContent.appendChild(importButton);
                
            }, 2000);
        }

        function clearText() {
            document.getElementById('textInput').value = '';
            document.getElementById('analysisResults').classList.add('hidden');
        }

        // Task Management
        function createIntelligentTask() {
            const title = document.getElementById('newTaskTitle').value.trim();
            const dueDate = document.getElementById('newTaskDue').value;
            const priority = document.getElementById('newTaskPriority').value;
            const duration = document.getElementById('newTaskDuration').value;
            
            if (!title) {
                showNotification('Please enter a task title', 'error');
                return;
            }
            
            const task = {
                id: Date.now(),
                title: title,
                priority: priority,
                dueDate: dueDate || null,
                duration: duration === 'custom' ? 60 : parseInt(duration),
                status: 'todo',
                createdAt: new Date(),
                aiEnhanced: true
            };
            
            // AI enhancement
            task.subtasks = generateSubtasks(title);
            task.estimatedDifficulty = calculateDifficulty(title);
            
            tasks.push(task);
            
            // Clear form
            document.getElementById('newTaskTitle').value = '';
            document.getElementById('newTaskDue').value = '';
            
            updateTaskViews();
            updateStats();
            showNotification(`Task "${title}" created with AI enhancements!`, 'success');
        }

        function generateSubtasks(title) {
            // Simple AI-like subtask generation
            const commonSubtasks = {
                'research': ['Gather sources', 'Take notes', 'Organize findings'],
                'write': ['Create outline', 'Write draft', 'Edit and revise'],
                'study': ['Review materials', 'Create study guide', 'Practice problems'],
                'project': ['Plan approach', 'Execute tasks', 'Review results']
            };
            
            const lowerTitle = title.toLowerCase();
            for (const [key, subtasks] of Object.entries(commonSubtasks)) {
                if (lowerTitle.includes(key)) {
                    return subtasks;
                }
            }
            
            return ['Start task', 'Work on main components', 'Complete and review'];
        }

        function calculateDifficulty(title) {
            // Simple difficulty estimation
            const complexWords = ['research', 'analyze', 'develop', 'create', 'design', 'implement'];
            const lowerTitle = title.toLowerCase();
            
            let difficulty = 1;
            complexWords.forEach(word => {
                if (lowerTitle.includes(word)) difficulty++;
            });
            
            return Math.min(difficulty, 5);
        }

        function setTaskView(viewType) {
            currentTaskView = viewType;
            
            // Update button states
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.id === `${viewType}ViewBtn`) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Show/hide views
            document.querySelectorAll('.task-view').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(`${viewType}View`).classList.remove('hidden');
            
            updateTaskViews();
        }

        function updateTaskViews() {
            updateListView();
            updateKanbanView();
            updateStats();
        }

        function updateListView() {
            const container = document.getElementById('taskList');
            container.innerHTML = '';
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-4" style="color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px;">📝</div>
                        <div>No tasks yet. Create your first task above!</div>
                    </div>
                `;
                return;
            }
            
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-card priority-${task.priority}`;
                taskElement.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <div class="task-priority ${task.priority}">${task.priority}</div>
                    </div>
                    <div class="task-meta">
                        ${task.dueDate ? `<span>Due: ${new Date(task.dueDate).toLocaleDateString()}</span>` : ''}
                        <span>Duration: ${task.duration} min</span>
                        <span>Status: ${task.status}</span>
                    </div>
                    ${task.subtasks ? `
                        <div style="margin-top: 12px;">
                            <div style="font-weight: 600; margin-bottom: 6px;">Subtasks:</div>
                            ${task.subtasks.map(subtask => `<div style="font-size: 12px; color: var(--text-secondary);">• ${subtask}</div>`).join('')}
                        </div>
                    ` : ''}
                    <div class="flex gap-2 mt-3">
                        <button class="btn btn-secondary btn-small" onclick="updateTaskStatus(${task.id}, '${task.status === 'todo' ? 'in-progress' : task.status === 'in-progress' ? 'completed' : 'todo'}')">
                            ${task.status === 'todo' ? 'Start' : task.status === 'in-progress' ? 'Complete' : 'Reopen'}
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="deleteTask(${task.id})">Delete</button>
                    </div>
                `;
                container.appendChild(taskElement);
            });
        }

        function updateKanbanView() {
            const todoColumn = document.getElementById('todoColumn');
            const progressColumn = document.getElementById('progressColumn');
            const completedColumn = document.getElementById('completedColumn');
            
            todoColumn.innerHTML = '';
            progressColumn.innerHTML = '';
            completedColumn.innerHTML = '';
            
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-card priority-${task.priority}`;
                taskElement.style.marginBottom = '12px';
                taskElement.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <div class="task-priority ${task.priority}">${task.priority}</div>
                    </div>
                    <div class="task-meta">
                        ${task.dueDate ? `<span>Due: ${new Date(task.dueDate).toLocaleDateString()}</span>` : ''}
                        <span>${task.duration} min</span>
                    </div>
                `;
                
                if (task.status === 'todo') {
                    todoColumn.appendChild(taskElement);
                } else if (task.status === 'in-progress') {
                    progressColumn.appendChild(taskElement);
                } else if (task.status === 'completed') {
                    completedColumn.appendChild(taskElement);
                }
            });
        }

        function updateTaskStatus(taskId, newStatus) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = newStatus;
                if (newStatus === 'completed') {
                    task.completedAt = new Date();
                    showNotification(`Task "${task.title}" completed! 🎉`, 'success');
                    voiceManager.speak(`Congratulations! You completed ${task.title}. Great work!`);
                }
                updateTaskViews();
            }
        }

        function deleteTask(taskId) {
            tasks = tasks.filter(t => t.id !== taskId);
            updateTaskViews();
            showNotification('Task deleted', 'success');
        }

        function updateStats() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('productivityScore').textContent = `${completionRate}%`;
            document.getElementById('weeklyStreak').textContent = calculateStreak();
            
            updateDashboardPriorityTasks();
        }

        function updateDashboardPriorityTasks() {
            const container = document.getElementById('priorityTasks');
            const highPriorityTasks = tasks.filter(t => t.priority === 'high' && t.status !== 'completed').slice(0, 5);
            
            if (highPriorityTasks.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-4" style="color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px;">🎯</div>
                        <div>No high-priority tasks. Great job staying on top of things!</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            highPriorityTasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-card priority-${task.priority}`;
                taskElement.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <div class="task-priority ${task.priority}">${task.priority}</div>
                    </div>
                    <div class="task-meta">
                        ${task.dueDate ? `<span>Due: ${new Date(task.dueDate).toLocaleDateString()}</span>` : ''}
                        <span>Duration: ${task.duration} min</span>
                    </div>
                `;
                container.appendChild(taskElement);
            });
        }

        function calculateStreak() {
            // Simplified streak calculation
            const today = new Date();
            const completedToday = tasks.filter(task => {
                if (task.status === 'completed' && task.completedAt) {
                    const completedDate = new Date(task.completedAt);
                    return completedDate.toDateString() === today.toDateString();
                }
                return false;
            }).length;
            
            return completedToday;
        }

        // Voice Functions
        function toggleVoiceRecognition() {
            if (isListening) {
                voiceManager.recognition.stop();
            } else {
                voiceManager.startListening();
            }
        }

        function startVoiceInput() {
            voiceManager.startListening();
        }

        // Chat Functions
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            addChatMessage('AI is thinking...', 'typing');
            
            // Process with AI
            aiAssistant.processMessage(message).then(response => {
                removeChatMessage('typing');
                addChatMessage(response, 'ai');
                voiceManager.speak(response.substring(0, 200)); // Speak first part of response
            });
        }

        function addChatMessage(message, sender) {
            const container = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.className = `message-${sender}`;
            messageElement.style.cssText = `
                margin-bottom: 16px;
                padding: 12px 16px;
                border-radius: 18px;
                max-width: 85%;
                word-wrap: break-word;
                ${sender === 'user' ? 'background: var(--primary-color); color: white; margin-left: auto; text-align: right;' : 
                  sender === 'typing' ? 'background: var(--bg-tertiary); color: var(--text-secondary); margin-right: auto; font-style: italic;' :
                  'background: var(--card-bg); color: var(--text-primary); border: 1px solid var(--border-color); margin-right: auto;'}
            `;
            
            if (sender === 'ai') {
                messageElement.innerHTML = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            } else {
                messageElement.textContent = message;
            }
            
            container.appendChild(messageElement);
            container.scrollTop = container.scrollHeight;
        }

        function removeChatMessage(sender) {
            const container = document.getElementById('chatMessages');
            const elements = container.querySelectorAll(`.message-${sender}`);
            elements.forEach(el => el.remove());
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function quickChatAction(action) {
            const actions = {
                'schedule': 'Show me my schedule for today',
                'progress': 'How am I doing with my tasks?',
                'tips': 'Give me a productivity tip',
                'focus': 'Start a 25-minute focus session'
            };
            
            document.getElementById('chatInput').value = actions[action];
            sendChat
