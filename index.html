<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowState Pro - Student Productivity</title>
    <meta name="description" content="A free, modern productivity app for students with tasks, AI chat, and focus timer">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <meta name="theme-color" content="#007AFF">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            --bg-primary: #E8ECEF;
            --bg-secondary: #F8FAFC;
            --text-primary: #1A1A1E;
            --text-secondary: #5C5C66;
            --primary-color: #007AFF;
            --success-color: #28A745;
            --danger-color: #FF3B30;
            --border-color: rgba(0, 0, 0, 0.08);
            --shadow: 6px 6px 12px rgba(0, 0, 0, 0.05), -6px -6px 12px rgba(255, 255, 255, 0.9);
            --card-bg: #F8FAFC;
            --sidebar-bg: #F8FAFC;
        }

        [data-theme="dark"] {
            --bg-primary: #1A1A1E;
            --bg-secondary: #2A2A2E;
            --text-primary: #E6E6E6;
            --text-secondary: #A0A0A8;
            --primary-color: #40C4FF;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow: 6px 6px 12px rgba(0, 0, 0, 0.2), -6px -6px 12px rgba(255, 255, 255, 0.05);
            --card-bg: #2A2A2E;
            --sidebar-bg: #2A2A2E;
        }

        [data-theme="vibrant"] {
            --bg-primary: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --text-primary: #FFFFFF;
            --text-secondary: #E0E0E6;
            --primary-color: #FF6B6B;
            --border-color: rgba(255, 255, 255, 0.15);
            --shadow: 6px 6px 12px rgba(0, 0, 0, 0.1), -6px -6px 12px rgba(255, 255, 255, 0.3);
            --card-bg: rgba(255, 255, 255, 0.95);
            --sidebar-bg: rgba(255, 255, 255, 0.95);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.2s ease;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            max-width: 1400px;
            margin: 24px auto;
            gap: 24px;
            padding: 0 16px;
        }

        .sidebar {
            width: 250px;
            background: var(--sidebar-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 24px;
            height: calc(100vh - 48px);
            overflow-y: auto;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .app-logo {
            width: 36px;
            height: 36px;
            background: var(--primary-color);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 700;
            box-shadow: var(--shadow);
        }

        .app-name {
            font-size: 20px;
            font-weight: 600;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .nav-item {
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            color: var(--text-primary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--primary-color);
            color: white;
            transform: translateX(4px);
            box-shadow: var(--shadow);
        }

        .main-content {
            flex: 1;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.1), -8px -8px 16px rgba(255, 255, 255, 0.9);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .card-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-modal.hidden {
            display: none;
        }

        .auth-content {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .auth-input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
            box-shadow: inset var(--shadow);
        }

        .auth-btn {
            padding: 10px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-btn:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow);
        }

        .auth-error {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 6px;
            min-height: 18px;
        }

        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
            border-color: transparent;
        }

        .chat-messages {
            height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            box-shadow: inset var(--shadow);
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 10px;
            border-radius: 8px;
            max-width: 80%;
            font-size: 13px;
            line-height: 1.4;
        }

        .message.user {
            background: var(--primary-color);
            color: white;
            margin-left: auto;
        }

        .message.ai {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
        }

        .voice-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 14px;
            box-shadow: var(--shadow);
        }

        .voice-btn.listening {
            background: var(--danger-color);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .integrations-section {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .integration-btn {
            padding: 6px 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow);
        }

        .integration-btn.connected {
            background: var(--success-color);
            color: white;
            border-color: transparent;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: inset var(--shadow);
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
        }

        .timer-btn {
            padding: 6px 14px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            box-shadow: var(--shadow);
        }

        .timer-btn.active {
            background: var(--danger-color);
        }

        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 1000;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                top: 0;
                left: -100%;
                transition: left 0.3s ease;
                z-index: 999;
            }
            .sidebar.active {
                left: 0;
            }
            .sidebar-toggle {
                display: block;
            }
            .main-content {
                margin-top: 60px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 12px;
            }
            .card {
                padding: 12px;
            }
            .app-container {
                margin: 12px;
            }
        }
    </style>
</head>
<body data-theme="light">
    <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>

    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <h2 id="authTitle">Welcome to FlowState Pro</h2>
            <p id="authSubtitle">Sign in to your account</p>
            <form class="auth-form" id="authActor">
                <input type="text" class="auth-input" id="nameInput" placeholder="Full Name" style="display: none;">
                <input type="email" class="auth-input" id="emailInput" placeholder="Email Address" required>
                <input type="password" class="auth-input" id="passwordInput" placeholder="Password" required>
                <input type="password" class="auth-input" id="confirmPasswordInput" placeholder="Confirm Password" style="display: none;">
                <button type="submit" class="auth-btn" id="authSubmitBtn">Sign In</button>
                <div class="auth-error" id="authError"></div>
            </form>
            <p style="margin-top: 12px; font-size: 12px;">
                <span id="authSwitchText">Don't have an account?</span>
                <a href="#" id="authSwitchLink" onclick="toggleAuthMode()">Sign Up</a>
            </p>
        </div>
    </div>

    <div class="app-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="app-logo">FS</div>
                <div class="app-name">FlowState Pro</div>
            </div>
            <div class="sidebar-nav">
                <div class="nav-item active" data-section="dashboard">📊 Dashboard</div>
                <div class="nav-item" data-section="tasks">📋 Tasks</div>
                <div class="nav-item" data-section="assistant">🧠 AI Study Buddy</div>
                <div class="nav-item" data-section="focus">⏰ Focus Timer</div>
                <div class="nav-item" data-section="integrations">🔗 Integrations</div>
                <div class="nav-item" data-section="settings">⚙️ Settings</div>
                <div class="nav-item" onclick="userManager.logout()">🚪 Sign Out</div>
            </div>
            <div class="user-profile" style="margin-top: auto; padding: 10px; background: var(--bg-secondary); border-radius: 8px; box-shadow: var(--shadow);">
                <div class="user-avatar" id="userAvatar" style="width: 24px; height: 24px; background: var(--primary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px;">U</div>
                <div id="userName" style="font-size: 14px;">User</div>
            </div>
        </div>

        <div class="main-content">
            <div class="section" id="dashboard-section">
                <div class="card">
                    <div class="card-title">Welcome, <span id="welcomeName">User</span>!</div>
                    <div class="card-subtitle">Your student productivity companion</div>
                    <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px; margin-bottom: 12px; box-shadow: var(--shadow);">
                        <div style="font-style: italic; font-size: 14px; margin-bottom: 6px;" id="quoteText">"The way to get started is to quit talking and begin doing."</div>
                        <div style="font-weight: 500; color: var(--primary-color);" id="quoteAuthor">— Walt Disney</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Daily Progress</div>
                        <div style="text-align: center; padding: 12px;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                            </div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--primary-color);" id="progressPercent">0%</div>
                            <div style="font-size: 11px; color: var(--text-secondary);">Complete</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section hidden" id="tasks-section">
                <div class="card">
                    <div class="card-title">Smart Task Creator</div>
                    <div class="card-subtitle">Add tasks with AI or voice</div>
                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                        <input type="text" class="auth-input" id="taskInput" placeholder="e.g., Study Math - 7:00 PM">
                        <button class="btn btn-primary" onclick="createTask()">Create</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">Today's Tasks</div>
                    <div class="card-subtitle" id="tasksSummary">No tasks yet</div>
                    <div id="tasksList"></div>
                </div>
            </div>

            <div class="section hidden" id="assistant-section">
                <div class="card">
                    <div class="card-title">AI Study Buddy</div>
                    <div class="card-subtitle">Your personal study coach</div>
                    <div class="voice-controls">
                        <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">🎤</button>
                        <select id="voiceGender" onchange="updateVoice()" style="padding: 6px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                            <option value="female">Female Voice</option>
                            <option value="male">Male Voice</option>
                        </select>
                        <div id="voiceStatus" style="font-size: 12px;">Voice ready</div>
                    </div>
                    <div class="chat-messages" id="chatMessages"></div>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" class="auth-input" id="chatInput" placeholder="Ask me anything...">
                        <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="quickAction('progress')">📊 Progress</button>
                        <button class="btn btn-secondary" onclick="quickAction('tips')">💡 Study Tips</button>
                        <button class="btn btn-secondary" onclick="quickAction('motivation')">🚀 Motivate</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">Ask Your Doubts</div>
                    <div class="card-subtitle">Get instant study help</div>
                    <textarea class="auth-input" id="doubtInput" placeholder="e.g., How to solve quadratic equations?..." style="height: 70px; resize: vertical;"></textarea>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary" onclick="resolveDoubt()">🧠 Get AI Help</button>
                    </div>
                    <div id="doubtResponse" style="margin-top: 10px; padding: 10px; background: var(--bg-secondary); border-radius: 8px; box-shadow: var(--shadow); display: none;"></div>
                </div>
            </div>

            <div class="section hidden" id="focus-section">
                <div class="card">
                    <div class="card-title">Focus Timer</div>
                    <div class="card-subtitle">Boost productivity with Pomodoro</div>
                    <div class="timer-controls">
                        <div style="font-size: 22px; font-weight: 600;" id="timerDisplay">25:00</div>
                        <button class="timer-btn" id="timerStartBtn" onclick="toggleTimer()">Start</button>
                        <button class="btn btn-secondary" onclick="resetTimer()">Reset</button>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Work for 25 minutes, then take a 5-minute break!</div>
                </div>
            </div>

            <div class="section hidden" id="integrations-section">
                <div class="card">
                    <div class="card-title">App Integrations</div>
                    <div class="card-subtitle">Connect your study tools</div>
                    <div class="integrations-section">
                        <button class="integration-btn" id="zoomBtn" onclick="connectApp('zoom')">📹 Zoom</button>
                        <button class="integration-btn" id="teamsBtn" onclick="connectApp('teams')">💬 Teams</button>
                        <button class="integration-btn" id="googleCalendarBtn" onclick="connectApp('googleCalendar')">📅 Google Calendar</button>
                        <button class="integration-btn" id="outlookBtn" onclick="connectApp('outlook')">📧 Outlook</button>
                        <button class="integration-btn" id="slackBtn" onclick="connectApp('slack')">📢 Slack</button>
                    </div>
                    <div id="integrationStatus" style="margin-top: 10px; font-size: 12px; color: var(--text-secondary);"></div>
                </div>
            </div>

            <div class="section hidden" id="settings-section">
                <div class="card">
                    <div class="card-title">Settings</div>
                    <div class="card-subtitle">Customize your experience</div>
                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                        <button class="btn btn-secondary active" onclick="setTheme('light')">Light</button>
                        <button class="btn btn-secondary" onclick="setTheme('dark')">Dark</button>
                        <button class="btn btn-secondary" onclick="setTheme('vibrant')">Vibrant</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let tasks = [];
        let isLoggedIn = false;
        let isListening = false;
        let selectedVoice = null;
        let recognition = null;
        let timerInterval = null;
        let timerSeconds = 25 * 60;
        let isTimerRunning = false;
        let integrations = {
            zoom: false,
            teams: false,
            googleCalendar: false,
            outlook: false,
            slack: false
        };

        const quotes = {
            motivation: [
                { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
                { text: "Study hard, dream big, and never give up!", author: "Student Proverb" },
                { text: "Every small step in your studies is a leap toward your future.", author: "Anonymous" }
            ],
            superhero: [
                { text: "With great knowledge comes great responsibility.", author: "Inspired by Spider-Man" },
                { text: "Be the hero of your own study journey!", author: "FlowState Pro" }
            ]
        };

        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        class UserManager {
            constructor() {
                this.currentUser = null;
                const storedUser = localStorage.getItem('currentUser');
                if (storedUser) {
                    this.currentUser = JSON.parse(storedUser);
                    this.login(this.currentUser);
                } else {
                    this.showAuth();
                }
            }

            showAuth() {
                document.getElementById('authModal').classList.remove('hidden');
                document.getElementById('authError').textContent = '';
            }

            hideAuth() {
                document.getElementById('authModal').classList.add('hidden');
            }

            async loginWithEmail(email, password) {
                if (!email || !password) {
                    document.getElementById('authError').textContent = 'Please enter both email and password.';
                    return;
                }
                const hashedPassword = await hashPassword(password);
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                const user = users[email];
                if (!user) {
                    document.getElementById('authError').textContent = 'No account found with this email.';
                    return;
                }
                if (user.password !== hashedPassword) {
                    document.getElementById('authError').textContent = 'Incorrect password.';
                    return;
                }
                this.login({
                    id: email,
                    name: user.name,
                    email: email,
                    tasks: user.tasks || [],
                    preferences: user.preferences || { theme: 'light', voice: 'female' }
                });
            }

            async register(name, email, password, confirmPassword) {
                if (!name || !email || !password) {
                    document.getElementById('authError').textContent = 'Please fill in all fields.';
                    return;
                }
                if (password !== confirmPassword) {
                    document.getElementById('authError').textContent = 'Passwords do not match.';
                    return;
                }
                if (password.length < 6) {
                    document.getElementById('authError').textContent = 'Password must be at least 6 characters.';
                    return;
                }
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                if (users[email]) {
                    document.getElementById('authError').textContent = 'Email already in use.';
                    return;
                }
                const hashedPassword = await hashPassword(password);
                users[email] = {
                    name,
                    password: hashedPassword,
                    tasks: [],
                    preferences: { theme: 'light', voice: 'female' }
                };
                localStorage.setItem('users', JSON.stringify(users));
                this.login({
                    id: email,
                    name,
                    email,
                    tasks: [],
                    preferences: { theme: 'light', voice: 'female' }
                });
            }

            login(user) {
                this.currentUser = user;
                currentUser = user;
                isLoggedIn = true;
                tasks = user.tasks || [];
                localStorage.setItem('currentUser', JSON.stringify(user));
                document.getElementById('userName').textContent = user.name;
                document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
                document.getElementById('welcomeName').textContent = user.name;
                this.hideAuth();
                renderTasks();
                setTheme(user.preferences.theme);
                document.getElementById('voiceGender').value = user.preferences.voice;
                updateVoice();
                addChatMessage(`Welcome, ${user.name}! Let's ace your studies today!`, 'ai');
                speakText(`Welcome back, ${user.name}! Ready to crush your studies?`);
            }

            logout() {
                localStorage.removeItem('currentUser');
                this.saveData();
                window.location.reload();
            }

            saveData() {
                if (this.currentUser) {
                    const users = JSON.parse(localStorage.getItem('users') || '{}');
                    users[this.currentUser.email] = {
                        ...users[this.currentUser.email],
                        tasks,
                        preferences: this.currentUser.preferences
                    };
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                }
            }
        }

        const userManager = new UserManager();

        function initVoice() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.onstart = () => {
                    isListening = true;
                    document.getElementById('voiceBtn').classList.add('listening');
                    document.getElementById('voiceStatus').textContent = 'Listening...';
                };
                recognition.onend = () => {
                    isListening = false;
                    document.getElementById('voiceBtn').classList.remove('listening');
                    document.getElementById('voiceStatus').textContent = 'Voice ready';
                };
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    processVoiceCommand(transcript);
                };
                recognition.onerror = (event) => {
                    document.getElementById('voiceStatus').textContent = 'Voice recognition error';
                    console.error(event.error);
                };
            }
            if ('speechSynthesis' in window) {
                speechSynthesis.onvoiceschanged = updateVoiceOptions;
                updateVoiceOptions();
            }
        }

        function updateVoiceOptions() {
            const voices = speechSynthesis.getVoices();
            const genderPref = document.getElementById('voiceGender').value;
            selectedVoice = voices.find(voice => {
                const name = voice.name.toLowerCase();
                return genderPref === 'female' ? 
                    name.includes('female') || name.includes('samantha') || name.includes('karen') :
                    name.includes('male') || name.includes('daniel') || name.includes('alex');
            }) || voices[0];
        }

        function speakText(text) {
            if ('speechSynthesis' in window && selectedVoice) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = selectedVoice;
                utterance.rate = 0.9;
                speechSynthesis.speak(utterance);
            }
        }

        function toggleVoice() {
            if (!recognition) {
                document.getElementById('voiceStatus').textContent = 'Voice not supported';
                return;
            }
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function processVoiceCommand(command) {
            document.getElementById('voiceStatus').textContent = `Heard: "${command}"`;
            if (command.toLowerCase().includes('create') || command.toLowerCase().includes('task')) {
                document.getElementById('taskInput').value = command;
                createTask();
            } else if (command.toLowerCase().includes('progress')) {
                quickAction('progress');
            } else if (command.toLowerCase().includes('start timer')) {
                toggleTimer();
            } else {
                document.getElementById('chatInput').value = command;
                sendMessage();
            }
        }

        function updateVoice() {
            updateVoiceOptions();
            if (currentUser) {
                currentUser.preferences.voice = document.getElementById('voiceGender').value;
                userManager.saveData();
            }
        }

        function toggleTimer() {
            if ( isTimerRunning) {
                clearInterval(timerInterval);
                document.getElementById('timerStartBtn').textContent = 'Start';
                document.getElementById('timerStartBtn').classList.remove('active');
                isTimerRunning = false;
                speakText('Timer
