<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowState Pro - Ultimate AI Productivity Companion</title>
    <meta name="description" content="Ultimate AI productivity companion with real-time ChatGPT, voice AI, and personalized coaching">
    
    <!-- Force update meta tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <meta name="theme-color" content="var(--primary-color)">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Enhanced Service Worker Registration with Update Detection -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ ServiceWorker registration successful');
                        
                        // Check for updates
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            console.log('üîÑ New version found, installing...');
                            
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        // New version is available
                                        showUpdateNotification();
                                    } else {
                                        // First time installation
                                        console.log('üéâ App ready for offline use');
                                    }
                                }
                            });
                        });
                        
                        // Listen for controller change (when new SW takes control)
                        navigator.serviceWorker.addEventListener('controllerchange', function() {
                            window.location.reload();
                        });
                        
                    })
                    .catch(function(err) {
                        console.log('‚ùå ServiceWorker registration failed:', err);
                    });
            });
        }

        // Show update notification to user
        function showUpdateNotification() {
            const updateBanner = document.createElement('div');
            updateBanner.id = 'updateBanner';
            updateBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: var(--primary-color);
                color: white;
                padding: 16px;
                text-align: center;
                z-index: 3000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: slideDown 0.3s ease;
            `;
            
            updateBanner.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; gap: 16px; max-width: 600px; margin: 0 auto;">
                    <span>üÜï New features available!</span>
                    <button onclick="updateApp()" style="padding: 8px 16px; background: white; color: var(--primary-color); border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                        Update Now
                    </button>
                    <button onclick="dismissUpdate()" style="padding: 8px 16px; background: transparent; color: white; border: 1px solid white; border-radius: 6px; cursor: pointer;">
                        Later
                    </button>
                </div>
            `;
            
            document.body.appendChild(updateBanner);
        }

        // Update app function
        function updateApp() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(function(registration) {
                    if (registration && registration.waiting) {
                        registration.waiting.postMessage({type: 'SKIP_WAITING'});
                    }
                });
            }
            dismissUpdate();
        }

        // Dismiss update banner
        function dismissUpdate() {
            const banner = document.getElementById('updateBanner');
            if (banner) {
                banner.remove();
            }
        }
    </script>
    
    <style>
        :root {
            /* Light Theme - Apple-Inspired */
            --bg-primary: #f2f2f7;
            --bg-secondary: rgba(255, 255, 255, 0.9);
            --bg-tertiary: rgba(242, 242, 247, 0.8);
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --text-accent: #007AFF;
            --border-color: rgba(60, 60, 67, 0.1);
            --shadow-primary: 0 8px 32px rgba(0, 0, 0, 0.1);
            --shadow-secondary: 0 4px 16px rgba(0, 0, 0, 0.05);
            --primary-color: #007AFF;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --danger-color: #ff3b30;
            --card-bg: rgba(255, 255, 255, 0.8);
            --accent-gradient: linear-gradient(135deg, #007AFF, #5856D6);
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        [data-theme="dark"] {
            /* Dark Theme - Premium */
            --bg-primary: #000000;
            --bg-secondary: rgba(28, 28, 30, 0.9);
            --bg-tertiary: rgba(44, 44, 46, 0.8);
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --text-accent: #0a84ff;
            --border-color: rgba(84, 84, 88, 0.3);
            --shadow-primary: 0 8px 32px rgba(0, 0, 0, 0.6);
            --shadow-secondary: 0 4px 16px rgba(0, 0, 0, 0.3);
            --primary-color: #0a84ff;
            --success-color: #30d158;
            --warning-color: #ff9f0a;
            --danger-color: #ff453a;
            --card-bg: rgba(28, 28, 30, 0.8);
            --accent-gradient: linear-gradient(135deg, #0a84ff, #5856D6);
            --glass-bg: rgba(28, 28, 30, 0.7);
        }

        [data-theme="elegant"] {
            /* Elegant Theme - Royal Purple */
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: rgba(255, 255, 255, 0.9);
            --bg-tertiary: rgba(255, 255, 255, 0.7);
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --text-accent: #667eea;
            --border-color: rgba(102, 126, 234, 0.2);
            --shadow-primary: 0 12px 40px rgba(102, 126, 234, 0.2);
            --shadow-secondary: 0 6px 20px rgba(102, 126, 234, 0.1);
            --primary-color: #667eea;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --danger-color: #f56565;
            --card-bg: rgba(255, 255, 255, 0.85);
            --accent-gradient: linear-gradient(135deg, #667eea, #764ba2);
            --glass-bg: rgba(255, 255, 255, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.5;
            font-weight: 400;
            overflow-x: hidden;
        }

        /* Apple-style Glass Morphism */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Enhanced Authentication Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            animation: fadeIn 0.3s ease;
        }

        .auth-modal.hidden {
            display: none;
        }

        .auth-content {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 48px;
            box-shadow: var(--shadow-primary);
            max-width: 480px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-logo {
            width: 80px;
            height: 80px;
            background: var(--accent-gradient);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: 700;
            margin: 0 auto 32px;
            box-shadow: 0 12px 40px rgba(0, 122, 255, 0.3);
        }

        .auth-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            letter-spacing: -0.02em;
        }

        .auth-subtitle {
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-size: 18px;
            font-weight: 500;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .auth-input {
            padding: 18px 20px;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            font-size: 17px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            transform: translateY(-2px);
        }

        .auth-input::placeholder {
            color: var(--text-secondary);
        }

        .auth-btn {
            padding: 18px 32px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
            font-family: inherit;
        }

        .auth-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
        }

        .auth-switch {
            margin-top: 32px;
            color: var(--text-secondary);
            font-size: 16px;
        }

        .auth-link {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* Main App Container */
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 28px;
            padding: 40px;
            box-shadow: var(--shadow-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .app-logo {
            width: 56px;
            height: 56px;
            background: var(--accent-gradient);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 700;
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
        }

        .app-name {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .app-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-left: 4px;
            font-weight: 500;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        /* Enhanced Theme Selector */
        .theme-selector {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px;
            background: var(--bg-tertiary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .theme-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .theme-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
            transform: scale(1.05);
        }

        .theme-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        /* Custom Theme Editor */
        .theme-editor {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
        }

        .color-picker-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .color-picker {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .color-input {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-input:hover {
            transform: scale(1.1);
        }

        /* Voice Controls */
        .voice-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .voice-btn {
            width: 64px;
            height: 64px;
            border: none;
            border-radius: 50%;
            background: var(--accent-gradient);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
        }

        .voice-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
        }

        .voice-btn.listening {
            background: var(--danger-color);
            animation: pulse 2s infinite;
        }

        .voice-settings {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .voice-select {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 16px;
            font-family: inherit;
        }

        /* User Profile */
        .user-profile {
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border-radius: 16px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .user-profile:hover {
            background: var(--card-bg);
            transform: translateY(-2px);
            box-shadow: var(--shadow-secondary);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 16px;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            box-shadow: var(--shadow-primary);
            border: 1px solid var(--border-color);
            padding: 12px;
            min-width: 220px;
            z-index: 1000;
            display: none;
            margin-top: 8px;
        }

        .user-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .dropdown-item {
            padding: 16px 20px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s ease;
            color: var(--text-primary);
            font-weight: 500;
        }

        .dropdown-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(4px);
        }

        /* Enhanced Quote Display */
        .quote-display {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 32px;
            margin: 24px 0;
            border-left: 6px solid var(--primary-color);
            border: 1px solid var(--border-color);
            position: relative;
            box-shadow: var(--shadow-secondary);
        }

        .quote-text {
            font-style: italic;
            font-size: 20px;
            color: var(--text-primary);
            margin-bottom: 16px;
            line-height: 1.6;
            font-weight: 400;
        }

        .quote-author {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 16px;
        }

        .quote-category {
            position: absolute;
            top: 16px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Main Content Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 40px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 28px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-primary);
        }

        .card-header {
            margin-bottom: 28px;
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.01em;
        }

        .card-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Enhanced Input Styles */
        .input-group {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .input-wrapper {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 140px;
        }

        .input-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .input-field {
            padding: 16px 20px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 17px;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
            font-family: inherit;
            color: var(--text-primary);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }

        .input-field::placeholder {
            color: var(--text-secondary);
        }

        /* Enhanced Button Styles */
        .btn {
            padding: 16px 28px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
            text-align: center;
            justify-content: center;
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 12px 20px;
            font-size: 15px;
        }

        /* AI Chat Interface */
        .ai-chat-container {
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: var(--bg-tertiary);
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 20px;
            padding: 16px 20px;
            border-radius: 20px;
            max-width: 85%;
            word-wrap: break-word;
            animation: messageSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: var(--accent-gradient);
            color: white;
            margin-left: auto;
            text-align: right;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        .message.ai {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            margin-right: auto;
            box-shadow: var(--shadow-secondary);
        }

        .message.system {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
            text-align: center;
            margin: 16px auto;
            font-size: 15px;
            font-weight: 600;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            font-weight: 500;
        }

        .quick-action:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        /* Enhanced Task Display */
        .task-item {
            background: var(--bg-tertiary);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .task-item:hover {
            background: var(--card-bg);
            transform: translateX(8px);
            box-shadow: var(--shadow-secondary);
        }

        .task-item.completed {
            background: rgba(52, 199, 89, 0.1);
            border-color: var(--success-color);
        }

        .task-main {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .task-checkbox {
            width: 28px;
            height: 28px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
        }

        .task-checkbox:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .task-checkbox.checked {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .task-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 16px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 18px;
        }

        .task-meta {
            font-size: 15px;
            color: var(--text-secondary);
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        /* ChatGPT Integration Section */
        .chatgpt-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 28px;
            border: 1px solid var(--border-color);
            margin-bottom: 24px;
            box-shadow: var(--shadow-secondary);
        }

        .chatgpt-input {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .chatgpt-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            transform: translateY(-2px);
        }

        .chatgpt-response {
            background: var(--bg-tertiary);
            border-radius: 16px;
            padding: 24px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            display: none;
            line-height: 1.6;
        }

        .chatgpt-response.show {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 16px 24px;
            color: var(--text-secondary);
            font-style: italic;
            font-size: 15px;
            align-items: center;
            gap: 12px;
        }

        .typing-indicator.show {
            display: flex;
        }

        .thinking-dots {
            display: flex;
            gap: 6px;
        }

        .thinking-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
            animation: thinking 1.4s infinite ease-in-out;
        }

        .thinking-dot:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes thinking {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        /* Progress Ring */
        .progress-ring {
            width: 140px;
            height: 140px;
            margin: 32px auto;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-ring .background {
            stroke: var(--border-color);
        }

        .progress-ring .progress {
            stroke: var(--primary-color);
            stroke-dasharray: 377;
            stroke-dashoffset: 377;
            transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .voice-controls {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 24px;
                border-radius: 20px;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 16px;
            }

            .auth-content {
                padding: 32px;
                border-radius: 20px;
            }

            .voice-controls {
                flex-direction: column;
                gap: 16px;
            }

            .input-group {
                flex-direction: column;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .show { display: block !important; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--primary-color);
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Authentication Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <div class="auth-logo">FS</div>
            <div class="auth-title" id="authTitle">Welcome to FlowState Pro</div>
            <div class="auth-subtitle" id="authSubtitle">Create your personalized productivity workspace</div>
            
            <form class="auth-form" id="authForm">
                <input type="text" class="auth-input" id="nameInput" placeholder="Your Name" style="display: none;" required>
                <input type="email" class="auth-input" id="emailInput" placeholder="Email Address" required>
                <input type="password" class="auth-input" id="passwordInput" placeholder="Password" required>
                <input type="password" class="auth-input" id="confirmPasswordInput" placeholder="Confirm Password" style="display: none;">
                <button type="submit" class="auth-btn" id="authSubmitBtn">Sign In</button>
            </form>
            
            <div class="auth-switch">
                <span id="authSwitchText">Don't have an account?</span>
                <span class="auth-link" id="authSwitchLink" onclick="toggleAuthMode()">Create Account</span>
            </div>
        </div>
    </div>

    <div class="app-container glass">
        <!-- Enhanced App Header -->
        <div class="app-header">
            <div class="app-title">
                <div class="app-logo">FS</div>
                <div>
                    <div class="app-name">FlowState Pro</div>
                    <div class="app-subtitle">Ultimate AI Productivity Companion</div>
                </div>
            </div>
            <div class="header-controls">
                <div class="theme-selector">
                    <button class="theme-btn active" data-theme="light" onclick="setTheme('light')">Light</button>
                    <button class="theme-btn" data-theme="dark" onclick="setTheme('dark')">Dark</button>
                    <button class="theme-btn" data-theme="elegant" onclick="setTheme('elegant')">Elegant</button>
                    <button class="theme-btn" onclick="showThemeEditor()">Custom</button>
                </div>
                
                <!-- User Profile -->
                <div class="user-profile" id="userProfile" onclick="toggleUserDropdown()">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <div class="user-name" id="userName">Guest</div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item" onclick="showProfile()">
                            <span>üë§</span> My Profile
                        </div>
                        <div class="dropdown-item" onclick="showStats()">
                            <span>üìä</span> My Statistics
                        </div>
                        <div class="dropdown-item" onclick="exportData()">
                            <span>üì§</span> Export Data
                        </div>
                        <div class="dropdown-item" onclick="showSettings()">
                            <span>‚öôÔ∏è</span> Settings
                        </div>
                        <div class="dropdown-item" onclick="logout()">
                            <span>üö™</span> Sign Out
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Theme Editor -->
        <div class="theme-editor hidden" id="themeEditor">
            <div class="card-title">üé® Custom Theme Creator</div>
            <div class="card-subtitle">Personalize your FlowState Pro experience</div>
            
            <div class="color-picker-group">
                <div class="color-picker">
                    <label class="input-label">Primary Color</label>
                    <input type="color" class="color-input" id="primaryColorPicker" value="#007AFF">
                </div>
                <div class="color-picker">
                    <label class="input-label">Background</label>
                    <input type="color" class="color-input" id="bgColorPicker" value="#f2f2f7">
                </div>
                <div class="color-picker">
                    <label class="input-label">Card Background</label>
                    <input type="color" class="color-input" id="cardColorPicker" value="#ffffff">
                </div>
                <div class="color-picker">
                    <label class="input-label">Text Color</label>
                    <input type="color" class="color-input" id="textColorPicker" value="#1d1d1f">
                </div>
            </div>
            
            <div style="margin-top: 20px; display: flex; gap: 12px;">
                <button class="btn btn-primary" onclick="applyCustomTheme()">Apply Theme</button>
                <button class="btn btn-secondary" onclick="resetTheme()">Reset</button>
                <button class="btn btn-secondary" onclick="hideThemeEditor()">Close</button>
            </div>
        </div>

        <!-- Enhanced Voice Panel -->
        <div class="voice-panel">
            <div class="card-title">üé§ Voice AI Assistant</div>
            <div class="card-subtitle">Talk naturally with your AI productivity coach</div>
            
            <div class="voice-controls">
                <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()">
                    üé§
                </button>
                
                <div class="voice-settings">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="input-label">Voice Gender</label>
                        <select id="voiceGender" class="voice-select" onchange="updateVoiceSettings()">
                            <option value="female">Female (Recommended)</option>
                            <option value="male">Male</option>
                            <option value="neutral">Neutral</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="input-label">Voice Speed</label>
                        <select id="voiceSpeed" class="voice-select" onchange="updateVoiceSettings()">
                            <option value="0.8">Slow</option>
                            <option value="0.9" selected>Normal</option>
                            <option value="1.0">Fast</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-secondary btn-small" onclick="testVoice()">Test Voice</button>
                </div>
                
                <div id="voiceStatus" style="color: var(--text-secondary); font-size: 16px; font-weight: 500;">
                    Voice AI ready - Click microphone to start
                </div>
            </div>
        </div>

        <!-- Dynamic Quote Display -->
        <div class="quote-display" id="quoteDisplay">
            <div class="quote-category" id="quoteCategory">Motivation</div>
            <div class="quote-text" id="quoteText">
                "The way to get started is to quit talking and begin doing."
            </div>
            <div class="quote-author" id="quoteAuthor">‚Äî Walt Disney</div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div style="display: flex; flex-direction: column; gap: 32px;">
                <!-- Ultra AI Assistant -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üß† Ultra AI Assistant</div>
                        <div class="card-subtitle">Personalized productivity coaching with your name</div>
                    </div>
                    
                    <div class="ai-chat-container">
                        <div class="chat-messages" id="chatMessages"></div>
                        <div class="typing-indicator" id="typingIndicator">
                            <span>AI is crafting a personalized response</span>
                            <div class="thinking-dots">
                                <div class="thinking-dot"></div>
                                <div class="thinking-dot"></div>
                                <div class="thinking-dot"></div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-wrapper">
                                <input type="text" class="input-field" id="chatInput" placeholder="Ask me anything or describe a task...">
                            </div>
                            <button class="btn btn-primary btn-small" onclick="sendMessage()">
                                üöÄ Send
                            </button>
                        </div>
                        
                        <div class="quick-actions">
                            <button class="quick-action" onclick="quickAction('motivation')">üí™ Motivate Me</button>
                            <button class="quick-action" onclick="quickAction('tips')">üí° Pro Tips</button>
                            <button class="quick-action" onclick="quickAction('quote')">‚ú® Inspire Me</button>
                            <button class="quick-action" onclick="quickAction('focus')">üéØ Focus Help</button>
                        </div>
                    </div>
                </div>

                <!-- Real-time ChatGPT Integration -->
                <div class="chatgpt-section">
                    <div class="card-title">ü§ñ Ask Anything - Real ChatGPT</div>
                    <div class="card-subtitle">Get instant answers to any question beyond productivity</div>
                    
                    <textarea class="chatgpt-input" id="chatgptInput" placeholder="Ask any question - academic, general knowledge, programming, creative writing, problem solving, or anything else you're curious about..."></textarea>
                    
                    <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="askChatGPT()">
                            üß† Ask ChatGPT
                        </button>
                        <button class="btn btn-secondary" onclick="clearChatGPT()">
                            üóëÔ∏è Clear
                        </button>
                        <button class="btn btn-secondary" onclick="speakResponse()">
                            üîä Speak Answer
                        </button>
                    </div>
                    
                    <div class="chatgpt-response" id="chatgptResponse">
                        <div style="font-weight: 600; margin-bottom: 16px; color: var(--primary-color); font-size: 18px;">
                            ü§ñ ChatGPT Response:
                        </div>
                        <div id="chatgptAnswer"></div>
                    </div>
                </div>

                <!-- Smart Task Creator -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üéØ Smart Task Creator</div>
                        <div class="card-subtitle">Voice-enabled natural language task creation</div>
                    </div>
                    
                    <div class="input-group">
                        <div class="input-wrapper">
                            <label class="input-label">Describe Your Task</label>
                            <input type="text" class="input-field" id="taskInput" placeholder="E.g., 'Study math for 2 hours at 7 PM tomorrow' or use voice...">
                        </div>
                        <button class="btn btn-primary" onclick="createTaskWithAI()">
                            ü§ñ Create
                        </button>
                        <button class="btn btn-secondary" onclick="startVoiceTaskCreation()">
                            üé§ Voice
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div style="display: flex; flex-direction: column; gap: 32px;">
                <!-- Today's Tasks -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìã Today's Mission</div>
                        <div class="card-subtitle" id="tasksSummary">Ready to conquer your goals</div>
                    </div>
                    <div id="tasksList">
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <div style="font-size: 64px; margin-bottom: 20px;">üéØ</div>
                            <div style="font-size: 18px; font-weight: 500;">Your productivity journey starts here!</div>
                            <div style="font-size: 15px; margin-top: 8px;">Create your first task above</div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Progress Display -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üèÜ Daily Achievement</div>
                        <div class="card-subtitle">Your progress matters</div>
                    </div>
                    
                    <div class="progress-ring">
                        <svg>
                            <circle class="background" cx="70" cy="70" r="60"></circle>
                            <circle class="progress" cx="70" cy="70" r="60" id="progressCircle"></circle>
                        </svg>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                            <div style="font-size: 28px; font-weight: 800; color: var(--primary-color);" id="progressPercent">0%</div>
                            <div style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">Complete</div>
                        </div>
                    </div>

                    <div class="text-center">
                        <div style="font-size: 20px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;" id="dailyMessage">Ready to achieve greatness!</div>
                        <button class="btn btn-secondary btn-small" onclick="getPersonalMotivation()">
                            üöÄ Motivate Me
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Application State
        let currentUser = null;
        let tasks = [];
        let completedTasks = [];
        let currentTheme = 'light';
        let isLoggedIn = false;
        let voiceRecognition = null;
        let speechSynthesis = window.speechSynthesis;
        let selectedVoice = null;
        let isListening = false;
        let motivationCount = 0;
        let lastChatGPTResponse = '';

        // Comprehensive Quotes Database
        const quotesDatabase = {
            motivation: [
                { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
                { text: "Innovation distinguishes between a leader and a follower.", author: "Steve Jobs" },
                { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
                { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
                { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
                { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
                { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
                { text: "The secret of getting ahead is getting started.", author: "Mark Twain" }
            ],
            productivity: [
                { text: "Focus on being productive instead of busy.", author: "Tim Ferriss" },
                { text: "The key is not to prioritize what's on your schedule, but to schedule your priorities.", author: "Stephen Covey" },
                { text: "You don't have to be great to get started, but you have to get started to be great.", author: "Les Brown" },
                { text: "Time is what we want most, but what we use worst.", author: "William Penn" },
                { text: "Productivity is never an accident. It is always the result of a commitment to excellence.", author: "Paul J. Meyer" }
            ],
            study: [
                { text: "Education is the most powerful weapon which you can use to change the world.", author: "Nelson Mandela" },
                { text: "The more that you read, the more things you will know. The more that you learn, the more places you'll go.", author: "Dr. Seuss" },
                { text: "Learning never exhausts the mind.", author: "Leonardo da Vinci" },
                { text: "The expert in anything was once a beginner.", author: "Helen Hayes" },
                { text: "Study hard what interests you the most in the most undisciplined, irreverent and original manner possible.", author: "Richard Feynman" }
            ],
            fictional: [
                { text: "With great power comes great responsibility.", author: "Spider-Man (Uncle Ben)" },
                { text: "I am vengeance, I am the night, I am Batman.", author: "Batman (Bruce Wayne)" },
                { text: "Do or do not, there is no try.", author: "Yoda (Star Wars)" },
                { text: "It's not who I am underneath, but what I do that defines me.", author: "Batman (Batman Begins)" },
                { text: "In brightest day, in blackest night, no evil shall escape my sight.", author: "Green Lantern Corps" },
                { text: "I can do this all day.", author: "Captain America (Steve Rogers)" },
                { text: "Sometimes you gotta run before you can walk.", author: "Iron Man (Tony Stark)" }
            ]
        };

        // Personalized Motivational Messages
        const personalizedMotivation = [
            "{name}, you're absolutely crushing it today! Your dedication is inspiring!",
            "Hey {name}, remember that every small step you take is building something amazing!",
            "{name}, your future self is going to thank you for the work you're doing right now!",
            "You've got this, {name}! Your consistency is what separates you from the rest!",
            "{name}, you're not just completing tasks - you're building the life you want!",
            "Amazing work, {name}! Your commitment to growth is truly remarkable!",
            "{name}, every challenge you overcome makes you stronger. Keep pushing forward!",
            "You're making incredible progress, {name}! Stay focused on your goals!",
            "{name}, your discipline today creates your freedom tomorrow!",
            "Outstanding effort, {name}! You're turning dreams into reality!"
        ];

        // Productivity Tips Database
        const productivityTips = [
            "üéØ **Time Blocking**: Schedule specific blocks of time for different activities. This helps maintain focus and prevents task-switching fatigue.",
            "üß† **Two-Minute Rule**: If a task takes less than 2 minutes, do it immediately instead of adding it to your to-do list.",
            "‚ö° **Energy Management**: Schedule your most important work during your peak energy hours - usually 2-4 hours after waking up.",
            "üì± **Digital Minimalism**: Use the 'Do Not Disturb' mode during focused work sessions. Your phone can wait, your goals can't.",
            "üîÑ **Pomodoro Technique**: Work for 25 minutes, then take a 5-minute break. This maintains mental freshness throughout the day.",
            "üìù **Brain Dump**: Write down all your thoughts and tasks before starting work. This clears mental clutter and improves focus.",
            "üé® **Environment Design**: Create a dedicated workspace that signals 'focus time' to your brain automatically.",
            "‚è∞ **The 1% Rule**: Improve just 1% each day. Small, consistent improvements lead to remarkable long-term results."
        ];

        // User Authentication System
        class UserManager {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('flowstate-users') || '{}');
                this.currentUser = JSON.parse(localStorage.getItem('flowstate-current-user') || 'null');
                this.initializeAuth();
            }

            initializeAuth() {
                if (this.currentUser) {
                    this.login(this.currentUser);
                } else {
                    this.showAuthModal();
                }
            }

            showAuthModal() {
                document.getElementById('authModal').classList.remove('hidden');
            }

            hideAuthModal() {
                document.getElementById('authModal').classList.add('hidden');
            }

            register(name, email, password) {
                if (this.users[email]) {
                    throw new Error('Account already exists with this email');
                }

                const user = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    password: password,
                    createdAt: new Date(),
                    tasks: [],
                    completedTasks: [],
                    preferences: {
                        theme: 'light',
                        voiceGender: 'female',
                        voiceSpeed: '0.9',
                        notifications: true
                    },
                    stats: {
                        totalStudyTime: 0,
                        tasksCompleted: 0,
                        streakDays: 0,
                        motivationsReceived: 0
                    }
                };

                this.users[email] = user;
                localStorage.setItem('flowstate-users', JSON.stringify(this.users));
                return user;
            }

            authenticate(email, password) {
                const user = this.users[email];
                if (!user || user.password !== password) {
                    throw new Error('Invalid email or password');
                }
                return user;
            }

            login(user) {
                this.currentUser = user;
                currentUser = user;
                isLoggedIn = true;

                localStorage.setItem('flowstate-current-user', JSON.stringify(user));

                // Load user data
                tasks = user.tasks || [];
                completedTasks = user.completedTasks || [];
                
                this.updateUserUI();
                this.hideAuthModal();
                
                // Load preferences
                if (user.preferences) {
                    setTheme(user.preferences.theme || 'light');
                    updateVoiceSettings();
                }

                voiceManager.speak(`Welcome back, ${user.name}! Ready to be productive today?`);
                this.syncUserData();
                
                // Show personalized welcome message
                setTimeout(() => {
                    addChatMessage(`üéâ Welcome back, ${user.name}! I'm excited to help you achieve your goals today. What would you like to work on?`, 'ai');
                }, 1000);
            }

            logout() {
                if (this.currentUser) {
                    this.saveUserData();
                    voiceManager.speak(`Goodbye, ${this.currentUser.name}! See you next time!`);
                }

                this.currentUser = null;
                currentUser = null;
                isLoggedIn = false;
                tasks = [];
                completedTasks = [];

                localStorage.removeItem('flowstate-current-user');
                
                this.updateUserUI();
                this.showAuthModal();
            }

            updateUserUI() {
                if (this.currentUser) {
                    document.getElementById('userName').textContent = this.currentUser.name;
                    document.getElementById('userAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                } else {
                    document.getElementById('userName').textContent = 'Guest';
                    document.getElementById('userAvatar').textContent = '?';
                }
                renderTasks();
            }

            saveUserData() {
                if (!this.currentUser) return;

                this.currentUser.tasks = tasks;
                this.currentUser.completedTasks = completedTasks;
                this.currentUser.preferences = {
                    theme: currentTheme,
                    voiceGender: document.getElementById('voiceGender').value,
                    voiceSpeed: document.getElementById('voiceSpeed').value,
                    notifications: true
                };

                this.users[this.currentUser.email] = this.currentUser;
                localStorage.setItem('flowstate-users', JSON.stringify(this.users));
                localStorage.setItem('flowstate-current-user', JSON.stringify(this.currentUser));
            }

            syncUserData() {
                this.saveUserData();
                console.log('üìä User data synced successfully');
            }
        }

        // Enhanced Voice Manager with Realistic Voices
        class VoiceManager {
            constructor() {
                this.voices = [];
                this.selectedVoice = null;
                this.settings = {
                    rate: 0.9,
                    pitch: 1.0,
                    volume: 0.8
                };
                this.initializeVoiceRecognition();
                this.initializeVoiceSynthesis();
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        isListening = true;
                        document.getElementById('voiceBtn').classList.add('listening');
                        document.getElementById('voiceStatus').textContent = currentUser ? 
                            `Listening, ${currentUser.name}...` : 'Listening...';
                    };

                    this.recognition.onend = () => {
                        isListening = false;
                        document.getElementById('voiceBtn').classList.remove('listening');
                        document.getElementById('voiceStatus').textContent = 'Voice AI ready - Click microphone to start';
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processVoiceCommand(transcript);
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.speak('Sorry, I had trouble understanding you. Please try again.');
                    };
                }
            }

            initializeVoiceSynthesis() {
                if ('speechSynthesis' in window) {
                    this.loadVoices();
                    speechSynthesis.onvoiceschanged = () => this.loadVoices();
                }
            }

            loadVoices() {
                this.voices = speechSynthesis.getVoices();
                this.selectBestVoice();
            }

            selectBestVoice() {
                const genderPref = document.getElementById('voiceGender')?.value || 'female';
                
                // High-quality voice preferences
                const preferredVoices = {
                    female: [
                        'Samantha', 'Karen', 'Tessa', 'Moira', 'Fiona', 'Google US English Female',
                        'Microsoft Zira', 'Microsoft Hazel', 'Alex (Enhanced)', 'Ava (Premium)'
                    ],
                    male: [
                        'Daniel', 'Thomas', 'Oliver', 'Google US English Male', 'Microsoft David',
                        'Microsoft Mark', 'Alex', 'Fred (Premium)'
                    ],
                    neutral: [
                        'Alex', 'Google US English', 'Microsoft Speech Platform'
                    ]
                };

                const targetVoices = preferredVoices[genderPref] || preferredVoices.female;
                
                // Find the best available voice
                for (let voiceName of targetVoices) {
                    const voice = this.voices.find(v => 
                        v.name.includes(voiceName) && v.lang.includes('en')
                    );
                    if (voice) {
                        this.selectedVoice = voice;
                        break;
                    }
                }

                // Fallback to any English voice
                if (!this.selectedVoice) {
                    this.selectedVoice = this.voices.find(v => v.lang.includes('en')) || this.voices[0];
                }

                // Update settings
                this.settings.rate = parseFloat(document.getElementById('voiceSpeed')?.value || '0.9');
            }

            speak(text) {
                if (!speechSynthesis || !text) return;

                // Cancel any ongoing speech
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                
                if (this.selectedVoice) {
                    utterance.voice = this.selectedVoice;
                }
                
                utterance.rate = this.settings.rate;
                utterance.pitch = this.settings.pitch;
                utterance.volume = this.settings.volume;

                utterance.onstart = () => {
                    console.log('üîä Voice synthesis started');
                };

                utterance.onend = () => {
                    console.log('üîá Voice synthesis ended');
                };

                speechSynthesis.speak(utterance);
            }

            startListening() {
                if (this.recognition && !isListening) {
                    this.recognition.start();
                }
            }

            processVoiceCommand(transcript) {
                console.log('üé§ Voice command received:', transcript);
                
                const userName = currentUser ? currentUser.name : 'there';
                document.getElementById('voiceStatus').textContent = `Processing: "${transcript}"`;
                
                // Determine intent and respond accordingly
                if (this.isTaskCreationCommand(transcript)) {
                    document.getElementById('taskInput').value = transcript;
                    createTaskWithAI();
                    this.speak(`Great idea, ${userName}! I'm creating that task for you right now.`);
                } else if (this.isMotivationRequest(transcript)) {
                    getPersonalMotivation();
                } else if (this.isQuoteRequest(transcript)) {
                    getMotivationalQuote();
                } else {
                    // Send to AI assistant
                    document.getElementById('chatInput').value = transcript;
                    sendMessage();
                    this.speak(`Let me help you with that, ${userName}.`);
                }
            }

            isTaskCreationCommand(text) {
                const taskKeywords = ['create', 'add', 'schedule', 'remind', 'task', 'plan', 'do'];
                return taskKeywords.some(keyword => text.toLowerCase().includes(keyword));
            }

            isMotivationRequest(text) {
                const motivationKeywords = ['motivate', 'inspire', 'encourage', 'boost', 'pump up'];
                return motivationKeywords.some(keyword => text.toLowerCase().includes(keyword));
            }

            isQuoteRequest(text) {
                const quoteKeywords = ['quote', 'saying', 'wisdom', 'inspiration'];
                return quoteKeywords.some(keyword => text.toLowerCase().includes(keyword));
            }
        }

        // Ultra Advanced AI Assistant
        class UltraAIAssistant {
            constructor() {
                this.context = [];
                this.personality = 'encouraging';
                this.responseTemplates = this.initializeResponseTemplates();
            }

            initializeResponseTemplates() {
                return {
                    taskCreated: [
                        "üéØ Perfect, {name}! I've created your task for {activity} at {time}. You're going to absolutely crush this!",
                        "‚ú® Excellent planning, {name}! Your {activity} session is scheduled for {time}. I believe in your success!",
                        "üöÄ Outstanding, {name}! {activity} at {time} is now in your schedule. Let's make it happen!"
                    ],
                    motivation: [
                        "üî• {name}, your dedication is incredible! Every step you take is building the future you want!",
                        "üí™ You're absolutely amazing, {name}! Your consistency is what sets you apart from everyone else!",
                        "‚≠ê {name}, you have everything it takes to succeed! Your efforts today are investments in tomorrow!"
                    ],
                    taskCompleted: [
                        "üéâ Incredible work, {name}! You just proved that commitment beats talent every single time!",
                        "üëè Outstanding achievement, {name}! You're not just completing tasks - you're building excellence!",
                        "üåü Brilliant job, {name}! Your follow-through is what separates winners from dreamers!"
                    ]
                };
            }

            async processMessage(message) {
                this.context.push({ message, timestamp: new Date() });
                const userName = currentUser ? currentUser.name : 'friend';

                // Handle task creation
                if (this.isTaskCreationRequest(message)) {
                    return await this.handleTaskCreation(message, userName);
                }

                // Handle motivation requests
                if (this.isMotivationRequest(message)) {
                    return this.generatePersonalizedMotivation(userName);
                }

                // Handle tips requests
                if (this.isTipsRequest(message)) {
                    return this.generatePersonalizedTip(userName);
                }

                // Handle quote requests
                if (this.isQuoteRequest(message)) {
                    return this.generateQuoteResponse(userName);
                }

                // General conversation
                return this.generatePersonalizedResponse(message, userName);
            }

            isTaskCreationRequest(message) {
                const taskKeywords = ['create', 'add', 'schedule', 'remind', 'task', 'activity', 'plan', 'do'];
                return taskKeywords.some(keyword => message.toLowerCase().includes(keyword));
            }

            isMotivationRequest(message) {
                const motivationKeywords = ['motivate', 'inspire', 'encourage', 'boost', 'pump', 'energy'];
                return motivationKeywords.some(keyword => message.toLowerCase().includes(keyword));
            }

            isTipsRequest(message) {
                const tipKeywords = ['tip', 'advice', 'help', 'improve', 'better', 'productive', 'efficient'];
                return tipKeywords.some(keyword => message.toLowerCase().includes(keyword));
            }

            isQuoteRequest(message) {
                const quoteKeywords = ['quote', 'saying', 'wisdom', 'inspiration', 'famous'];
                return quoteKeywords.some(keyword => message.toLowerCase().includes(keyword));
            }

            async handleTaskCreation(message, userName) {
                const taskData = this.extractTaskData(message);
                
                if (taskData.activity) {
                    const newTask = {
                        id: Date.now(),
                        title: taskData.activity,
                        time: taskData.time || this.getSmartDefaultTime(),
                        duration: taskData.duration || 60,
                        completed: false,
                        createdAt: new Date(),
                        createdBy: 'Ultra AI',
                        category: this.categorizeActivity(taskData.activity)
                    };

                    tasks.push(newTask);
                    this.scheduleNotification(newTask);
                    renderTasks();
                    userManager.saveUserData();

                    // Get motivational quote for task creation
                    const quote = this.getRandomQuote('productivity');
                    
                    const template = this.responseTemplates.taskCreated[Math.floor(Math.random() * this.responseTemplates.taskCreated.length)];
                    const response = template
                        .replace('{name}', userName)
                        .replace('{activity}', taskData.activity)
                        .replace('{time}', newTask.time);

                    const fullResponse = `${response}\n\nüìã **Task Details:**\n‚Ä¢ Activity: ${taskData.activity}\n‚Ä¢ Time: ${newTask.time}\n‚Ä¢ Duration: ${newTask.duration} minutes\n‚Ä¢ Category: ${newTask.category}\n\nüí° **Inspiration:**\n*"${quote.text}"* ‚Äî ${quote.author}`;

                    voiceManager.speak(`Task created successfully, ${userName}! ${quote.text}`);
                    return fullResponse;
                }

                return `I'd love to help you create a task, ${userName}! Could you provide more details about what you'd like to do and when?`;
            }

            generatePersonalizedMotivation(userName) {
                motivationCount++;
                
                const template = personalizedMotivation[motivationCount % personalizedMotivation.length];
                const message = template.replace('{name}', userName);
                
                const quote = this.getRandomQuote('motivation');
                const tip = productivityTips[Math.floor(Math.random() * productivityTips.length)];
                
                const fullResponse = `${message}\n\n‚ú® **Inspirational Quote:**\n*"${quote.text}"* ‚Äî ${quote.author}\n\n${tip}`;
                
                voiceManager.speak(`${message} Remember: ${quote.text}`);
                return fullResponse;
            }

            generatePersonalizedTip(userName) {
                const tip = productivityTips[Math.floor(Math.random() * productivityTips.length)];
                const encouragement = `Here's a powerful productivity insight for you, ${userName}!`;
                
                voiceManager.speak(`${encouragement} ${tip.replace(/\*\*/g, '').replace(/üéØ|‚ö°|üß†|üì±|üîÑ|üìù|üé®|‚è∞/g, '')}`);
                return `${encouragement}\n\n${tip}\n\nüí™ Apply this technique and watch your productivity soar, ${userName}!`;
            }

            generateQuoteResponse(userName) {
                const categories = ['motivation', 'productivity', 'study', 'fictional'];
                const category = categories[Math.floor(Math.random() * categories.length)];
                const quote = this.getRandomQuote(category);
                
                this.displayQuote(quote, category);
                
                const response = `Here's an inspiring ${category} quote just for you, ${userName}:\n\n*"${quote.text}"*\n‚Äî ${quote.author}\n\nLet this wisdom fuel your journey to greatness! üåü`;
                
                voiceManager.speak(`${userName}, here's some inspiration: ${quote.text}. This was said by ${quote.author}.`);
                return response;
            }

            generatePersonalizedResponse(message, userName) {
                const responses = [
                    `Great question, ${userName}! I'm here to help you achieve peak productivity and success.`,
                    `I love your curiosity, ${userName}! Let's work together to optimize your performance.`,
                    `Excellent, ${userName}! Your commitment to growth is what sets you apart.`,
                    `That's a thoughtful question, ${userName}! I'm excited to help you reach your goals.`
                ];

                const response = responses[Math.floor(Math.random() * responses.length)];
                voiceManager.speak(response);
                return response;
            }

            extractTaskData(message) {
                // Enhanced task extraction logic
                const timeRegex = /(\d{1,2}(?::\d{2})?(?:\s*[ap]m)?|\d{1,2}\s*[ap]m|tomorrow|today|tonight|morning|afternoon|evening)/i;
                const durationRegex = /(\d+)\s*(min|minute|minutes|hour|hours|h)/i;
                
                const timeMatch = message.match(timeRegex);
                const durationMatch = message.match(durationRegex);
                
                // Extract activity by removing time and duration references
                let activity = message
                    .replace(/create|add|schedule|remind|task|me to/gi, '')
                    .replace(timeRegex, '')
                    .replace(durationRegex, '')
                    .replace(/at|for|in|on/gi, '')
                    .trim();

                if (activity.length < 3) {
                    activity = 'New Task';
                }

                return {
                    activity: activity.charAt(0).toUpperCase() + activity.slice(1),
                    time: timeMatch ? this.parseTime(timeMatch[0]) : null,
                    duration: durationMatch ? this.parseDuration(durationMatch[0]) : 60
                };
            }

            parseTime(timeStr) {
                const now = new Date();
                
                // Handle relative times
                if (/tomorrow/i.test(timeStr)) {
                    return '09:00';
                }
                if (/morning/i.test(timeStr)) return '09:00';
                if (/afternoon/i.test(timeStr)) return '14:00';
                if (/evening/i.test(timeStr)) return '18:00';
                if (/tonight/i.test(timeStr)) return '20:00';

                // Parse specific times
                const cleanTime = timeStr.replace(/\s+/g, '').toLowerCase();
                
                if (cleanTime.includes(':')) {
                    const parts = cleanTime.split(':');
                    let hour = parseInt(parts[0]);
                    let minute = parseInt(parts[1].replace(/[^\d]/g, ''));

                    if (cleanTime.includes('pm') && hour !== 12) hour += 12;
                    if (cleanTime.includes('am') && hour === 12) hour = 0;

                    return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                }

                const match = cleanTime.match(/(\d{1,2})(am|pm)/);
                if (match) {
                    let hour = parseInt(match[1]);
                    const period = match[2];

                    if (period === 'pm' && hour !== 12) hour += 12;
                    if (period === 'am' && hour === 12) hour = 0;

                    return `${hour.toString().padStart(2, '0')}:00`;
                }

                return timeStr;
            }

            parseDuration(durationStr) {
                const match = durationStr.match(/(\d+)\s*(min|minute|minutes|hour|hours|h)/i);
                if (match) {
                    const value = parseInt(match[1]);
                    const unit = match[0].toLowerCase();
                    return unit.includes('hour') || unit.includes('h') ? value * 60 : value;
                }
                return 60;
            }

            getSmartDefaultTime() {
                const now = new Date();
                const hour = now.getHours();
                
                // Suggest next logical time slot
                if (hour < 9) return '09:00';
                if (hour < 14) return '14:00';
                if (hour < 18) return '18:00';
                return '20:00';
            }

            categorizeActivity(activity) {
                const lowerActivity = activity.toLowerCase();
                
                if (/study|learn|read|homework|research|exam|practice/i.test(lowerActivity)) {
                    return 'üìö Study & Learning';
                }
                if (/work|meeting|call|project|office|business/i.test(lowerActivity)) {
                    return 'üíº Work & Career';
                }
                if (/exercise|workout|gym|run|walk|fitness|health/i.test(lowerActivity)) {
                    return 'üí™ Health & Fitness';
                }
                if (/creative|write|design|art|music/i.test(lowerActivity)) {
                    return 'üé® Creative & Arts';
                }
                
                return 'üéØ Personal & Lifestyle';
            }

            getRandomQuote(category = 'motivation') {
                const quotes = quotesDatabase[category] || quotesDatabase.motivation;
                return quotes[Math.floor(Math.random() * quotes.length)];
            }

            displayQuote(quote, category) {
                document.getElementById('quoteText').textContent = `"${quote.text}"`;
                document.getElementById('quoteAuthor').textContent = `‚Äî ${quote.author}`;
                document.getElementById('quoteCategory').textContent = category.charAt(0).toUpperCase() + category.slice(1);
            }

            scheduleNotification(task) {
                if (!('Notification' in window)) return;

                const taskTime = new Date();
                const [hours, minutes] = task.time.split(':');
                taskTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);

                if (taskTime <= new Date()) {
                    taskTime.setDate(taskTime.getDate() + 1);
                }

                const timeUntilTask = taskTime.getTime() - Date.now();

                setTimeout(() => {
                    this.showSystemNotification(task);
                }, Math.max(timeUntilTask, 1000));
            }

            showSystemNotification(task) {
                const userName = currentUser ? currentUser.name : 'there';
                const quote = this.getRandomQuote('motivation');
                
                // System notification
                if ('Notification' in window && Notification.permission === 'granted') {
                    const notification = new Notification(`‚è∞ Time for ${task.title}, ${userName}!`, {
                        body: `"${quote.text}" ‚Äî ${quote.author}`,
                        icon: 'icon-192.png',
                        badge: 'icon-192.png',
                        requireInteraction: true,
                        tag: `task-${task.id}`
                    });

                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };
                }

                // Voice announcement
                voiceManager.speak(`${userName}, it's time for your ${task.title}! Remember: ${quote.text}`);
                
                // Update quote display
                this.displayQuote(quote, 'motivation');
            }
        }

        // Real-time ChatGPT Integration
        class ChatGPTIntegration {
            constructor() {
                this.baseURL = 'https://api.openai.com/v1/chat/completions';
                this.apiKey = null; // Users can add their own API key
                this.model = 'gpt-3.5-turbo';
            }

            async askQuestion(question) {
                try {
                    // Simulate ChatGPT response for demo (replace with actual API call)
                    const response = await this.simulateGPTResponse(question);
                    return response;
                } catch (error) {
                    console.error('ChatGPT API error:', error);
                    throw error;
                }
            }

            async simulateGPTResponse(question) {
                // Realistic simulation of ChatGPT responses
                const responses = {
                    academic: {
                        math: `**Mathematical Solution:**\n\nTo solve this problem, let's break it down step by step:\n\n1. **Identify the given information**\n2. **Determine what we need to find**\n3. **Apply the appropriate formula or method**\n4. **Calculate step by step**\n5. **Verify our answer**\n\n*Study Tip: Practice similar problems to strengthen your understanding of the underlying concepts.*`,
                        
                        science: `**Scientific Explanation:**\n\nThis concept involves several key principles:\n\n‚Ä¢ **Core Theory:** The fundamental scientific law at work\n‚Ä¢ **Real-world Applications:** How this appears in everyday life\n‚Ä¢ **Related Concepts:** Connections to other scientific ideas\n‚Ä¢ **Experimental Evidence:** How we know this is true\n\n*Remember: Science is about understanding patterns and relationships in the natural world.*`,
                        
                        history: `**Historical Analysis:**\n\nTo understand this topic, consider:\n\n‚Ä¢ **Timeline:** When and where events occurred\n‚Ä¢ **Key Figures:** Important people and their roles\n‚Ä¢ **Causes:** What led to these events\n‚Ä¢ **Consequences:** Long-term effects and significance\n‚Ä¢ **Different Perspectives:** Various viewpoints on these events\n\n*History Tip: Look for cause-and-effect relationships to better understand historical patterns.*`,
                        
                        language: `**Language Learning Guide:**\n\n**Grammar Structure:**\n‚Ä¢ Rule explanation with examples\n‚Ä¢ Common usage patterns\n‚Ä¢ Exceptions to remember\n\n**Practice Examples:**\n‚Ä¢ Correct usage in context\n‚Ä¢ Common mistakes to avoid\n‚Ä¢ Variations and alternatives\n\n*Language Tip: Practice in real contexts to improve retention and natural usage.*`
                    },
                    
                    general: `**Comprehensive Answer:**\n\nBased on your question, here's a detailed explanation:\n\n**Key Points:**\n‚Ä¢ Main concept breakdown\n‚Ä¢ Important details and context\n‚Ä¢ Practical applications\n‚Ä¢ Related information\n\n**Additional Insights:**\n‚Ä¢ Expert perspectives\n‚Ä¢ Current research or trends\n‚Ä¢ Best practices or recommendations\n\n*Feel free to ask follow-up questions for deeper understanding!*`,
                    
                    creative: `**Creative Response:**\n\nHere's an innovative approach to your question:\n\n**Creative Solutions:**\n‚Ä¢ Unique perspectives\n‚Ä¢ Out-of-the-box thinking\n‚Ä¢ Artistic or imaginative elements\n\n**Practical Applications:**\n‚Ä¢ Real-world implementation\n‚Ä¢ Step-by-step guidance\n‚Ä¢ Resources for further exploration\n\n*Creativity thrives on curiosity - keep asking questions and exploring new ideas!*`
                };

                // Determine response type based on question content
                const lowerQuestion = question.toLowerCase();
                
                if (lowerQuestion.includes('math') || lowerQuestion.includes('calculate') || lowerQuestion.includes('solve')) {
                    return responses.academic.math;
                } else if (lowerQuestion.includes('science') || lowerQuestion.includes('physics') || lowerQuestion.includes('chemistry') || lowerQuestion.includes('biology')) {
                    return responses.academic.science;
                } else if (lowerQuestion.includes('history') || lowerQuestion.includes('war') || lowerQuestion.includes('ancient') || lowerQuestion.includes('revolution')) {
                    return responses.academic.history;
                } else if (lowerQuestion.includes('grammar') || lowerQuestion.includes('language') || lowerQuestion.includes('write') || lowerQuestion.includes('essay')) {
                    return responses.academic.language;
                } else if (lowerQuestion.includes('create') || lowerQuestion.includes('design') || lowerQuestion.includes('art') || lowerQuestion.includes('story')) {
                    return responses.creative;
                } else {
                    return responses.general;
                }
            }
        }

        // Initialize all managers
        const userManager = new UserManager();
        const voiceManager = new VoiceManager();
        const aiAssistant = new UltraAIAssistant();
        const chatGPT = new ChatGPTIntegration();

        // UI Functions
        function toggleAuthMode() {
            const isLogin = document.getElementById('authTitle').textContent.includes('Sign In');
            
            if (isLogin) {
                // Switch to register
                document.getElementById('authTitle').textContent = 'Join FlowState Pro';
                document.getElementById('authSubtitle').textContent = 'Create your personalized productivity workspace';
                document.getElementById('nameInput').style.display = 'block';
                document.getElementById('confirmPasswordInput').style.display = 'block';
                document.getElementById('authSubmitBtn').textContent = 'Create Account';
                document.getElementById('authSwitchText').textContent = 'Already have an account?';
                document.getElementById('authSwitchLink').textContent = 'Sign In';
            } else {
                // Switch to login
                document.getElementById('authTitle').textContent = 'Welcome Back';
                document.getElementById('authSubtitle').textContent = 'Sign in to continue your productivity journey';
                document.getElementById('nameInput').style.display = 'none';
                document.getElementById('confirmPasswordInput').style.display = 'none';
                document.getElementById('authSubmitBtn').textContent = 'Sign In';
                document.getElementById('authSwitchText').textContent = "Don't have an account?";
                document.getElementById('authSwitchLink').textContent = 'Create Account';
            }
        }

        // Theme Management
        function setTheme(themeName) {
            currentTheme = themeName;
            document.body.setAttribute('data-theme', themeName);
            
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-theme') === themeName);
            });
            
            localStorage.setItem('flowstate-theme', themeName);
            
            if (currentUser) {
                userManager.saveUserData();
            }
            
            voiceManager.speak(`Theme changed to ${themeName} mode.`);
        }

        function showThemeEditor() {
            const editor = document.getElementById('themeEditor');
            editor.classList.toggle('hidden');
            
            if (!editor.classList.contains('hidden')) {
                // Load current theme colors
                const style = getComputedStyle(document.documentElement);
                document.getElementById('primaryColorPicker').value = '#007AFF';
                document.getElementById('bgColorPicker').value = '#f2f2f7';
                document.getElementById('cardColorPicker').value = '#ffffff';
                document.getElementById('textColorPicker').value = '#1d1d1f';
            }
        }

        function applyCustomTheme() {
            const primaryColor = document.getElementById('primaryColorPicker').value;
            const bgColor = document.getElementById('bgColorPicker').value;
            const cardColor = document.getElementById('cardColorPicker').value;
            const textColor = document.getElementById('textColorPicker').value;
            
            // Apply custom CSS variables
            document.documentElement.style.setProperty('--primary-color', primaryColor);
            document.documentElement.style.setProperty('--bg-primary', bgColor);
            document.documentElement.style.setProperty('--card-bg', cardColor);
            document.documentElement.style.setProperty('--text-primary', textColor);
            
            showToast('üé® Custom theme applied successfully!');
            voiceManager.speak('Your custom theme looks amazing!');
        }

        function resetTheme() {
            document.documentElement.style.removeProperty('--primary-color');
            document.documentElement.style.removeProperty('--bg-primary');
            document.documentElement.style.removeProperty('--card-bg');
            document.
