<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowState Pro - Ultimate AI Productivity Companion</title>
    <meta name="description" content="Ultimate AI productivity companion with user accounts, voice features, and intelligent assistance">
    <meta name="theme-color" content="var(--primary-color)">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }
    </script>
    
    <style>
        :root {
            /* Light Theme - Clean & Professional */
            --bg-primary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --bg-tertiary: rgba(248, 250, 252, 0.9);
            --text-primary: #1a202c;
            --text-secondary: #64748b;
            --text-accent: #3b82f6;
            --border-color: rgba(0, 0, 0, 0.08);
            --shadow-primary: 0 10px 25px rgba(0, 0, 0, 0.08);
            --shadow-secondary: 0 4px 12px rgba(0, 0, 0, 0.04);
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --card-bg: rgba(255, 255, 255, 0.9);
            --accent-gradient: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        [data-theme="dark"] {
            /* Dark Theme - Sophisticated & Modern */
            --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --bg-secondary: rgba(15, 23, 42, 0.95);
            --bg-tertiary: rgba(30, 41, 59, 0.9);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-accent: #60a5fa;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-primary: 0 25px 50px rgba(0, 0, 0, 0.4);
            --shadow-secondary: 0 8px 25px rgba(0, 0, 0, 0.2);
            --primary-color: #60a5fa;
            --success-color: #34d399;
            --warning-color: #fbbf24;
            --danger-color: #f87171;
            --card-bg: rgba(15, 23, 42, 0.95);
            --accent-gradient: linear-gradient(135deg, #60a5fa, #3730a3);
        }

        [data-theme="elegant"] {
            /* Elegant Theme - Luxury & Premium */
            --bg-primary: linear-gradient(135deg, #fdf4ff 0%, #f3e8ff 100%);
            --bg-secondary: rgba(253, 244, 255, 0.95);
            --bg-tertiary: rgba(243, 232, 255, 0.9);
            --text-primary: #581c87;
            --text-secondary: #7c3aed;
            --text-accent: #a855f7;
            --border-color: rgba(139, 92, 246, 0.15);
            --shadow-primary: 0 20px 40px rgba(139, 92, 246, 0.15);
            --shadow-secondary: 0 8px 20px rgba(139, 92, 246, 0.08);
            --primary-color: #8b5cf6;
            --success-color: #06d6a0;
            --warning-color: #ffd60a;
            --danger-color: #ff006e;
            --card-bg: rgba(253, 244, 255, 0.9);
            --accent-gradient: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
        }

        /* Login/Register Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .auth-modal.hidden {
            display: none;
        }

        .auth-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-primary);
            max-width: 450px;
            width: 90%;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .auth-logo {
            width: 64px;
            height: 64px;
            background: var(--accent-gradient);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin: 0 auto 24px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .auth-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .auth-subtitle {
            color: var(--text-secondary);
            margin-bottom: 32px;
            font-size: 16px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-input {
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .auth-input::placeholder {
            color: var(--text-secondary);
        }

        .auth-btn {
            padding: 16px 24px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .auth-switch {
            margin-top: 24px;
            color: var(--text-secondary);
        }

        .auth-link {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* User Profile Dropdown */
        .user-profile {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .user-profile:hover {
            background: var(--card-bg);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--accent-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: var(--shadow-primary);
            border: 1px solid var(--border-color);
            padding: 8px;
            min-width: 200px;
            z-index: 1000;
            display: none;
        }

        .user-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .dropdown-item {
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        .dropdown-item:hover {
            background: var(--bg-tertiary);
        }

        /* Voice Control Interface */
        .voice-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .voice-btn {
            padding: 12px;
            border: none;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .voice-btn:hover {
            background: var(--text-accent);
            transform: scale(1.05);
        }

        .voice-btn.listening {
            background: var(--danger-color);
            animation: pulse 1s infinite;
        }

        .voice-settings {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .voice-select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
        }

        /* Quote Display */
        .quote-display {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            border-left: 4px solid var(--primary-color);
            border: 1px solid var(--border-color);
            position: relative;
        }

        .quote-text {
            font-style: italic;
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .quote-author {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 14px;
        }

        .quote-category {
            position: absolute;
            top: 12px;
            right: 16px;
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Doubt Resolution Section */
        .doubt-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            margin-bottom: 24px;
        }

        .doubt-input {
            width: 100%;
            min-height: 100px;
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 16px;
        }

        .doubt-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .doubt-response {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
            border: 1px solid var(--border-color);
            display: none;
        }

        .doubt-response.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Study Insights Panel */
        .insights-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            margin-bottom: 24px;
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }

        .insight-icon {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }

        .insight-content h3 {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .insight-content p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Rest of previous styles remain the same... */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-secondary);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: var(--shadow-primary);
            border: 1px solid var(--border-color);
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .app-logo {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            font-weight: 700;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .app-name {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .app-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-left: 4px;
            font-weight: 500;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .theme-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .theme-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .theme-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .theme-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Continue with all previous styles... */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-primary);
        }

        .card-header {
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
            text-align: center;
            justify-content: center;
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .theme-selector {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 20px;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 16px;
            }

            .auth-content {
                padding: 24px;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .show { display: block !important; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Authentication Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <div class="auth-logo">FS</div>
            <div class="auth-title" id="authTitle">Welcome to FlowState Pro</div>
            <div class="auth-subtitle" id="authSubtitle">Create your account to sync across devices</div>
            
            <form class="auth-form" id="authForm">
                <input type="text" class="auth-input" id="nameInput" placeholder="Full Name" style="display: none;">
                <input type="email" class="auth-input" id="emailInput" placeholder="Email Address" required>
                <input type="password" class="auth-input" id="passwordInput" placeholder="Password" required>
                <input type="password" class="auth-input" id="confirmPasswordInput" placeholder="Confirm Password" style="display: none;">
                <button type="submit" class="auth-btn" id="authSubmitBtn">Sign In</button>
            </form>
            
            <div class="auth-switch">
                <span id="authSwitchText">Don't have an account?</span>
                <span class="auth-link" id="authSwitchLink" onclick="toggleAuthMode()">Sign Up</span>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Enhanced App Header with User Profile -->
        <div class="app-header">
            <div class="app-title">
                <div class="app-logo">FS</div>
                <div>
                    <div class="app-name">FlowState Pro</div>
                    <div class="app-subtitle">Ultimate AI Productivity Companion</div>
                </div>
            </div>
            <div class="header-controls">
                <div class="theme-selector">
                    <button class="theme-btn active" data-theme="light" onclick="setTheme('light')">Light</button>
                    <button class="theme-btn" data-theme="dark" onclick="setTheme('dark')">Dark</button>
                    <button class="theme-btn" data-theme="elegant" onclick="setTheme('elegant')">Elegant</button>
                </div>
                
                <!-- User Profile Dropdown -->
                <div class="user-profile" id="userProfile" onclick="toggleUserDropdown()">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <div class="user-name" id="userName">Guest</div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item" onclick="showProfile()">
                            <span>👤</span> My Profile
                        </div>
                        <div class="dropdown-item" onclick="showSettings()">
                            <span>⚙️</span> Settings
                        </div>
                        <div class="dropdown-item" onclick="exportData()">
                            <span>📤</span> Export Data
                        </div>
                        <div class="dropdown-item" onclick="showHelp()">
                            <span>❓</span> Help & Support
                        </div>
                        <div class="dropdown-item" onclick="logout()">
                            <span>🚪</span> Logout
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Voice Controls Section -->
        <div class="voice-controls">
            <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()">
                🎤
            </button>
            <div class="voice-settings">
                <label for="voiceGender">Voice:</label>
                <select id="voiceGender" class="voice-select" onchange="updateVoiceSettings()">
                    <option value="female">Female Voice</option>
                    <option value="male">Male Voice</option>
                    <option value="neutral">Neutral Voice</option>
                </select>
                <button class="btn btn-secondary btn-small" onclick="testVoice()">Test Voice</button>
            </div>
            <div id="voiceStatus" style="color: var(--text-secondary); font-size: 14px;">Voice commands ready</div>
        </div>

        <!-- Inspirational Quote Display -->
        <div class="quote-display" id="quoteDisplay">
            <div class="quote-category" id="quoteCategory">Motivation</div>
            <div class="quote-text" id="quoteText">
                "The way to get started is to quit talking and begin doing."
            </div>
            <div class="quote-author" id="quoteAuthor">— Walt Disney</div>
        </div>

        <!-- Study Insights Panel -->
        <div class="insights-panel">
            <div class="card-title">📊 Personalized Study Insights</div>
            <div id="insightsContainer">
                <div class="insight-item">
                    <div class="insight-icon">🧠</div>
                    <div class="insight-content">
                        <h3>Peak Learning Time</h3>
                        <p>Your best study sessions happen between 9 AM - 11 AM based on your activity patterns.</p>
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">📈</div>
                    <div class="insight-content">
                        <h3>Weekly Progress</h3>
                        <p>You've improved focus duration by 23% this week. Keep up the excellent work!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div style="display: flex; flex-direction: column; gap: 30px;">
                <!-- Enhanced AI Assistant with Quotes -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">🧠 Ultra AI Assistant</div>
                        <div class="card-subtitle">Smart productivity coach with inspirational guidance</div>
                    </div>
                    
                    <div style="height: 400px; display: flex; flex-direction: column;">
                        <div style="flex: 1; overflow-y: auto; padding: 16px; background: var(--bg-tertiary); border-radius: 12px; margin-bottom: 16px; border: 1px solid var(--border-color);" id="chatMessages"></div>
                        
                        <div style="display: flex; gap: 12px;">
                            <input type="text" style="flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary);" id="chatInput" placeholder="Ask me anything or describe a task...">
                            <button class="btn btn-primary btn-small" onclick="sendMessage()">Send</button>
                            <button class="btn btn-secondary btn-small" onclick="getMotivationalQuote()">Quote</button>
                        </div>
                    </div>
                </div>

                <!-- Doubt Resolution with ChatGPT -->
                <div class="doubt-section">
                    <div class="card-title">🤔 Ask Your Doubts</div>
                    <div class="card-subtitle">Get instant help with your studies from advanced AI</div>
                    
                    <textarea class="doubt-input" id="doubtInput" placeholder="Ask any question about your studies, homework, or concepts you're learning..."></textarea>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <button class="btn btn-primary" onclick="resolveDoubt()">
                            🧠 Get AI Help
                        </button>
                        <button class="btn btn-secondary" onclick="clearDoubt()">
                            🗑️ Clear
                        </button>
                    </div>
                    
                    <div class="doubt-response" id="doubtResponse">
                        <div style="font-weight: 600; margin-bottom: 12px; color: var(--primary-color);">AI Assistant Response:</div>
                        <div id="doubtAnswer"></div>
                    </div>
                </div>

                <!-- Enhanced Task Creation -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">🎯 Smart Task Creator</div>
                        <div class="card-subtitle">Voice-enabled task creation with AI understanding</div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <input type="text" style="flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary);" id="taskInput" placeholder="Describe your task or use voice...">
                        <button class="btn btn-primary" onclick="createTaskWithAI()">
                            🤖 Create
                        </button>
                        <button class="btn btn-secondary" onclick="startVoiceTaskCreation()">
                            🎤 Voice
                        </button>
                    </div>
                </div>

                <!-- Enhanced Learning Resources -->
                <div class="card">
                    <div class="card-title">📚 Smart Learning Hub</div>
                    <div class="card-subtitle">Personalized study tools and resources</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <button class="btn btn-secondary" onclick="openFlashcards()">
                            🃏 Smart Flashcards
                        </button>
                        <button class="btn btn-secondary" onclick="openStudyPlanner()">
                            📅 Study Planner
                        </button>
                        <button class="btn btn-secondary" onclick="openFocusTimer()">
                            ⏱️ Focus Timer
                        </button>
                        <button class="btn btn-secondary" onclick="openProgressTracker()">
                            📊 Progress Tracker
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div style="display: flex; flex-direction: column; gap: 30px;">
                <!-- Task List with Enhanced Features -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">📋 Today's Tasks</div>
                        <div class="card-subtitle" id="tasksSummary">No tasks scheduled</div>
                    </div>
                    <div id="tasksList">
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <div style="font-size: 48px; margin-bottom: 16px;">📝</div>
                            <div>Create your first task to get started!</div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Progress Ring -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">🎯 Daily Progress</div>
                        <div class="card-subtitle">Your productivity journey</div>
                    </div>
                    
                    <div style="text-align: center;">
                        <div style="width: 120px; height: 120px; margin: 24px auto; position: relative;">
                            <svg style="width: 100%; height: 100%; transform: rotate(-90deg);">
                                <circle cx="60" cy="60" r="45" fill="none" stroke="var(--border-color)" stroke-width="8" stroke-linecap="round"></circle>
                                <circle cx="60" cy="60" r="45" fill="none" stroke="var(--primary-color)" stroke-width="8" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="283" id="progressCircle" style="transition: stroke-dashoffset 0.8s ease;"></circle>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);" id="progressPercent">0%</div>
                                <div style="font-size: 12px; color: var(--text-secondary); font-weight: 600;">Complete</div>
                            </div>
                        </div>
                        <div style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin-top: 16px;" id="dailyMessage">Ready to start your productive day!</div>
                    </div>
                </div>

                <!-- Weekly Goal Tracker -->
                <div class="card">
                    <div class="card-title">🏆 Weekly Goals</div>
                    <div class="card-subtitle">Track your long-term objectives</div>
                    
                    <div style="margin-top: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 500;">Study Hours</span>
                            <span style="font-weight: 600; color: var(--primary-color);">12 / 20 hrs</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden;">
                            <div style="width: 60%; height: 100%; background: var(--primary-color); transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Application State with User Management
        let currentUser = null;
        let tasks = [];
        let completedTasks = [];
        let currentTheme = 'light';
        let isLoggedIn = false;
        let voiceRecognition = null;
        let speechSynthesis = window.speechSynthesis;
        let selectedVoice = null;
        let isListening = false;

        // Famous Quotes Database
        const quotesDatabase = {
            motivation: [
                { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
                { text: "Innovation distinguishes between a leader and a follower.", author: "Steve Jobs" },
                { text: "Life is what happens to you while you're busy making other plans.", author: "John Lennon" },
                { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
                { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" }
            ],
            success: [
                { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
                { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
                { text: "Success is walking from failure to failure with no loss of enthusiasm.", author: "Winston Churchill" },
                { text: "Don't be afraid to give up the good to go for the great.", author: "John D. Rockefeller" }
            ],
            productivity: [
                { text: "The key is not to prioritize what's on your schedule, but to schedule your priorities.", author: "Stephen Covey" },
                { text: "Focus on being productive instead of busy.", author: "Tim Ferriss" },
                { text: "You don't have to be great to get started, but you have to get started to be great.", author: "Les Brown" },
                { text: "The secret of getting ahead is getting started.", author: "Mark Twain" }
            ],
            study: [
                { text: "Education is the most powerful weapon which you can use to change the world.", author: "Nelson Mandela" },
                { text: "The more that you read, the more things you will know. The more that you learn, the more places you'll go.", author: "Dr. Seuss" },
                { text: "Learning never exhausts the mind.", author: "Leonardo da Vinci" },
                { text: "The expert in anything was once a beginner.", author: "Helen Hayes" }
            ],
            fictional: [
                { text: "With great power comes great responsibility.", author: "Spider-Man (Uncle Ben)" },
                { text: "I am vengeance, I am the night, I am Batman.", author: "Batman" },
                { text: "Do or do not, there is no try.", author: "Yoda (Star Wars)" },
                { text: "Even the darkest night will end and the sun will rise.", author: "Victor Hugo" },
                { text: "It's not who I am underneath, but what I do that defines me.", author: "Batman" }
            ]
        };

        // User Authentication System
        class UserManager {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('flowstate-users') || '{}');
                this.currentUser = JSON.parse(localStorage.getItem('flowstate-current-user') || 'null');
                this.initializeAuth();
            }

            initializeAuth() {
                if (this.currentUser) {
                    this.login(this.currentUser);
                } else {
                    this.showAuthModal();
                }
            }

            showAuthModal() {
                document.getElementById('authModal').classList.remove('hidden');
            }

            hideAuthModal() {
                document.getElementById('authModal').classList.add('hidden');
            }

            register(name, email, password) {
                if (this.users[email]) {
                    throw new Error('User already exists');
                }

                const user = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    password: password, // In production, hash this!
                    createdAt: new Date(),
                    tasks: [],
                    completedTasks: [],
                    preferences: {
                        theme: 'light',
                        voiceGender: 'female',
                        notifications: true
                    },
                    stats: {
                        totalStudyTime: 0,
                        tasksCompleted: 0,
                        streakDays: 0
                    }
                };

                this.users[email] = user;
                localStorage.setItem('flowstate-users', JSON.stringify(this.users));
                return user;
            }

            authenticate(email, password) {
                const user = this.users[email];
                if (!user || user.password !== password) {
                    throw new Error('Invalid credentials');
                }
                return user;
            }

            login(user) {
                this.currentUser = user;
                currentUser = user;
                isLoggedIn = true;

                localStorage.setItem('flowstate-current-user', JSON.stringify(user));

                // Load user data
                tasks = user.tasks || [];
                completedTasks = user.completedTasks || [];
                
                // Update UI
                this.updateUserUI();
                this.hideAuthModal();
                
                // Load preferences
                if (user.preferences) {
                    setTheme(user.preferences.theme || 'light');
                    updateVoiceSettings(user.preferences.voiceGender || 'female');
                }

                showToast(`Welcome back, ${user.name}! 👋`);
                this.syncUserData();
            }

            logout() {
                if (this.currentUser) {
                    this.saveUserData();
                }

                this.currentUser = null;
                currentUser = null;
                isLoggedIn = false;
                tasks = [];
                completedTasks = [];

                localStorage.removeItem('flowstate-current-user');
                
                this.updateUserUI();
                this.showAuthModal();
                showToast('Logged out successfully');
            }

            updateUserUI() {
                if (this.currentUser) {
                    document.getElementById('userName').textContent = this.currentUser.name;
                    document.getElementById('userAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                } else {
                    document.getElementById('userName').textContent = 'Guest';
                    document.getElementById('userAvatar').textContent = '?';
                }
            }

            saveUserData() {
                if (!this.currentUser) return;

                this.currentUser.tasks = tasks;
                this.currentUser.completedTasks = completedTasks;
                this.currentUser.preferences = {
                    theme: currentTheme,
                    voiceGender: document.getElementById('voiceGender').value,
                    notifications: true
                };

                this.users[this.currentUser.email] = this.currentUser;
                localStorage.setItem('flowstate-users', JSON.stringify(this.users));
                localStorage.setItem('flowstate-current-user', JSON.stringify(this.currentUser));
            }

            syncUserData() {
                // Simulate cloud sync
                console.log('Syncing user data to cloud...');
                this.saveUserData();
            }
        }

        // Initialize User Manager
        const userManager = new UserManager();

        // Voice Recognition and Synthesis
        class VoiceManager {
            constructor() {
                this.initializeVoiceRecognition();
                this.initializeVoiceSynthesis();
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        isListening = true;
                        document.getElementById('voiceBtn').classList.add('listening');
                        document.getElementById('voiceStatus').textContent = 'Listening...';
                    };

                    this.recognition.onend = () => {
                        isListening = false;
                        document.getElementById('voiceBtn').classList.remove('listening');
                        document.getElementById('voiceStatus').textContent = 'Voice commands ready';
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processVoiceCommand(transcript);
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        showToast('❌ Voice recognition error. Please try again.');
                    };
                }
            }

            initializeVoiceSynthesis() {
                if ('speechSynthesis' in window) {
                    this.loadVoices();
                    speechSynthesis.onvoiceschanged = () => this.loadVoices();
                }
            }

            loadVoices() {
                const voices = speechSynthesis.getVoices();
                const genderPref = document.getElementById('voiceGender').value;
                
                // Filter voices based on gender preference
                let filteredVoices = voices.filter(voice => {
                    if (genderPref === 'female') {
                        return voice.name.toLowerCase().includes('female') || 
                               voice.name.toLowerCase().includes('woman') ||
                               voice.name.toLowerCase().includes('samantha') ||
                               voice.name.toLowerCase().includes('karen');
                    } else if (genderPref === 'male') {
                        return voice.name.toLowerCase().includes('male') || 
                               voice.name.toLowerCase().includes('man') ||
                               voice.name.toLowerCase().includes('daniel') ||
                               voice.name.toLowerCase().includes('alex');
                    }
                    return true;
                });

                // Fallback to any available voice
                if (filteredVoices.length === 0) {
                    filteredVoices = voices;
                }

                selectedVoice = filteredVoices[0] || voices[0];
            }

            speak(text) {
                if (!speechSynthesis) return;

                const utterance = new SpeechSynthesisUtterance(text);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 0.8;

                speechSynthesis.speak(utterance);
            }

            startListening() {
                if (this.recognition && !isListening) {
                    this.recognition.start();
                }
            }

            processVoiceCommand(transcript) {
                console.log('Voice command:', transcript);
                document.getElementById('voiceStatus').textContent = `Heard: "${transcript}"`;
                
                // Process the voice command
                if (transcript.toLowerCase().includes('create task') || 
                    transcript.toLowerCase().includes('add task') ||
                    transcript.toLowerCase().includes('schedule')) {
                    document.getElementById('taskInput').value = transcript;
                    createTaskWithAI();
                } else if (transcript.toLowerCase().includes('motivation') ||
                          transcript.toLowerCase().includes('quote')) {
                    getMotivationalQuote();
                } else {
                    // Send to AI assistant
                    document.getElementById('chatInput').value = transcript;
                    sendMessage();
                }

                this.speak("I understood your command and I'm processing it now.");
            }
        }

        // Initialize Voice Manager
        const voiceManager = new VoiceManager();

        // Enhanced AI Assistant with Quotes
        class UltraAIAssistant {
            constructor() {
                this.context = [];
                this.userPreferences = {};
            }

            async processMessage(message) {
                this.context.push({ message, timestamp: new Date() });

                // Check for task creation
                if (this.isTaskCreationRequest(message)) {
                    return await this.handleTaskCreation(message);
                }

                // Check for quote requests
                if (this.isQuoteRequest(message)) {
                    return this.handleQuoteRequest(message);
                }

                // Handle general conversation
                return this.generateResponse(message);
            }

            isTaskCreationRequest(message) {
                const taskKeywords = ['create', 'add', 'schedule', 'remind', 'task', 'activity'];
                return taskKeywords.some(keyword => message.toLowerCase().includes(keyword));
            }

            isQuoteRequest(message) {
                const quoteKeywords = ['quote', 'motivation', 'inspire', 'encourage'];
                return quoteKeywords.some(keyword => message.toLowerCase().includes(keyword));
            }

            async handleTaskCreation(message) {
                // Extract task details from message
                const taskData = this.extractTaskData(message);
                
                if (taskData.activity) {
                    const newTask = {
                        id: Date.now(),
                        title: taskData.activity,
                        time: taskData.time || this.getDefaultTime(),
                        duration: taskData.duration || 60,
                        completed: false,
                        createdAt: new Date(),
                        createdBy: 'Ultra AI'
                    };

                    tasks.push(newTask);
                    this.scheduleNotification(newTask);
                    renderTasks();
                    userManager.saveUserData();

                    // Get motivational quote for task creation
                    const quote = this.getRandomQuote('motivation');
                    
                    return `✅ **Task Created Successfully!**\n\n` +
                           `📋 **Task:** ${taskData.activity}\n` +
                           `⏰ **Time:** ${newTask.time}\n` +
                           `⏱️ **Duration:** ${newTask.duration} minutes\n\n` +
                           `💡 **Inspiration for you:**\n` +
                           `*"${quote.text}"*\n— ${quote.author}\n\n` +
                           `You've got this! Let's make it happen! 🚀`;
                }

                return "I'd love to help you create a task! Please provide more details about what you'd like to do and when.";
            }

            handleQuoteRequest(message) {
                const categories = ['motivation', 'success', 'productivity', 'study', 'fictional'];
                let category = 'motivation';

                // Determine quote category based on message
                if (message.toLowerCase().includes('study') || message.toLowerCase().includes('learn')) {
                    category = 'study';
                } else if (message.toLowerCase().includes('success') || message.toLowerCase().includes('achieve')) {
                    category = 'success';
                } else if (message.toLowerCase().includes('batman') || message.toLowerCase().includes('spider')) {
                    category = 'fictional';
                } else if (message.toLowerCase().includes('productive') || message.toLowerCase().includes('focus')) {
                    category = 'productivity';
                }

                const quote = this.getRandomQuote(category);
                this.displayQuote(quote, category);

                return `Here's an inspiring ${category} quote for you:\n\n` +
                       `*"${quote.text}"*\n— ${quote.author}\n\n` +
                       `I hope this motivates you to achieve great things! 🌟`;
            }

            extractTaskData(message) {
                // Simple extraction logic - can be enhanced
                const activity = message.replace(/create|add|schedule|task|remind me to/gi, '').trim();
                const timeMatch = message.match(/(\d{1,2}:\d{2}|\d{1,2}\s*(am|pm))/i);
                const durationMatch = message.match(/(\d+)\s*(min|hour|hours)/i);

                return {
                    activity: activity || 'New Task',
                    time: timeMatch ? timeMatch[0] : null,
                    duration: durationMatch ? this.parseDuration(durationMatch[0]) : null
                };
            }

            parseDuration(durationStr) {
                const match = durationStr.match(/(\d+)\s*(min|hour|hours)/i);
                if (match) {
                    const value = parseInt(match[1]);
                    const unit = match[2].toLowerCase();
                    return unit.includes('hour') ? value * 60 : value;
                }
                return 60;
            }

            getDefaultTime() {
                const now = new Date();
                const hour = now.getHours();
                const nextHour = hour + 1;
                return `${nextHour.toString().padStart(2, '0')}:00`;
            }

            getRandomQuote(category = 'motivation') {
                const quotes = quotesDatabase[category] || quotesDatabase.motivation;
                return quotes[Math.floor(Math.random() * quotes.length)];
            }

            displayQuote(quote, category) {
                document.getElementById('quoteText').textContent = `"${quote.text}"`;
                document.getElementById('quoteAuthor').textContent = `— ${quote.author}`;
                document.getElementById('quoteCategory').textContent = category.charAt(0).toUpperCase() + category.slice(1);
            }

            scheduleNotification(task) {
                if (!('Notification' in window)) return;

                const taskTime = new Date();
                const [hours, minutes] = (task.time || '09:00').split(':');
                taskTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);

                if (taskTime <= new Date()) {
                    taskTime.setDate(taskTime.getDate() + 1);
                }

                const timeUntilTask = taskTime.getTime() - Date.now();

                setTimeout(() => {
                    this.showSystemNotification(task);
                }, timeUntilTask);
            }

            showSystemNotification(task) {
                // Browser notification
                if ('Notification' in window && Notification.permission === 'granted') {
                    const quote = this.getRandomQuote('motivation');
                    
                    const notification = new Notification(`⏰ Time for ${task.title}!`, {
                        body: `"${quote.text}" — ${quote.author}`,
                        icon: 'icon-192.png',
                        badge: 'icon-192.png',
                        requireInteraction: true,
                        tag: `task-${task.id}`
                    });

                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };
                }

                // Speak notification
                voiceManager.speak(`Time for your task: ${task.title}. Let's get productive!`);
            }

            generateResponse(message) {
                const responses = [
                    "I'm your Ultra AI productivity companion! I can help you create tasks, provide motivation, and keep you focused. What would you like to accomplish?",
                    "Ready to supercharge your productivity? I'm here to help with task management, study planning, and motivational support. How can I assist you?",
                    "Your success is my mission! I can help you organize tasks, provide inspiring quotes, and keep you motivated. What's your goal today?",
                    "Let's make today amazing! I'm equipped with advanced AI to understand your needs and provide personalized productivity assistance. What shall we work on?"
                ];

                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        // Initialize AI Assistant
        const aiAssistant = new UltraAIAssistant();

        // ChatGPT Integration for Doubt Resolution
        class DoubtResolver {
            constructor() {
                this.apiKey = null; // Users can add their own API key
            }

            async resolveDoubt(question) {
                const doubtAnswer = document.getElementById('doubtAnswer');
                const doubtResponse = document.getElementById('doubtResponse');

                // Show loading
                doubtAnswer.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; color: var(--text-secondary);">
                        <div style="width: 20px; height: 20px; border: 2px solid var(--primary-color); border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        AI is analyzing your question...
                    </div>
                `;
                doubtResponse.classList.add('show');

                try {
                    // Simulate AI processing (replace with actual ChatGPT API call)
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    const response = this.generateEducationalResponse(question);
                    doubtAnswer.innerHTML = response;

                    // Speak the response
                    voiceManager.speak("I've found an answer to your question. Please check the response below.");

                } catch (error) {
                    doubtAnswer.innerHTML = `
                        <div style="color: var(--danger-color);">
                            ❌ Sorry, I couldn't process your question right now. Please try again later.
                        </div>
                    `;
                }
            }

            generateEducationalResponse(question) {
                // Educational AI responses (replace with actual ChatGPT integration)
                const responses = {
                    math: `
                        <div style="line-height: 1.6;">
                            <strong>📊 Mathematical Concept Explanation:</strong><br><br>
                            Let me break this down step by step:<br><br>
                            1. <strong>Understanding the Problem:</strong> First, identify what we're trying to solve<br>
                            2. <strong>Apply the Formula:</strong> Use the relevant mathematical principle<br>
                            3. <strong>Work Through:</strong> Calculate step by step<br>
                            4. <strong>Verify:</strong> Check our answer makes sense<br><br>
                            <em>💡 Study Tip: Practice similar problems to reinforce understanding!</em>
                        </div>
                    `,
                    science: `
                        <div style="line-height: 1.6;">
                            <strong>🔬 Scientific Explanation:</strong><br><br>
                            This concept involves:<br><br>
                            • <strong>Core Principle:</strong> The fundamental scientific law at work<br>
                            • <strong>Real-world Application:</strong> How this applies in everyday life<br>
                            • <strong>Key Terms:</strong> Important vocabulary to remember<br>
                            • <strong>Related Concepts:</strong> How this connects to other topics<br><br>
                            <em>💡 Remember: Science is all about understanding patterns in nature!</em>
                        </div>
                    `,
                    history: `
                        <div style="line-height: 1.6;">
                            <strong>📚 Historical Context:</strong><br><br>
                            To understand this topic:<br><br>
                            • <strong>Timeline:</strong> When and where this occurred<br>
                            • <strong>Key Figures:</strong> Important people involved<br>
                            • <strong>Causes:</strong> What led to these events<br>
                            • <strong>Impact:</strong> How this influenced the future<br><br>
                            <em>💡 History Tip: Connect events to understand cause and effect!</em>
                        </div>
                    `,
                    language: `
                        <div style="line-height: 1.6;">
                            <strong>📖 Language Learning Guide:</strong><br><br>
                            Let's explore this concept:<br><br>
                            • <strong>Grammar Rule:</strong> The underlying structure<br>
                            • <strong>Usage Examples:</strong> How to use it correctly<br>
                            • <strong>Common Mistakes:</strong> What to avoid<br>
                            • <strong>Practice Exercises:</strong> Ways to improve<br><br>
                            <em>💡 Language Tip: Practice in context for better retention!</em>
                        </div>
                    `
                };

                // Determine subject based on keywords
                const lowerQuestion = question.toLowerCase();
                if (lowerQuestion.includes('math') || lowerQuestion.includes('calculate') || lowerQuestion.includes('solve')) {
                    return responses.math;
                } else if (lowerQuestion.includes('science') || lowerQuestion.includes('physics') || lowerQuestion.includes('chemistry')) {
                    return responses.science;
                } else if (lowerQuestion.includes('history') || lowerQuestion.includes('when') || lowerQuestion.includes('war')) {
                    return responses.history;
                } else if (lowerQuestion.includes('grammar') || lowerQuestion.includes('language') || lowerQuestion.includes('write')) {
                    return responses.language;
                } else {
                    return `
                        <div style="line-height: 1.6;">
                            <strong>🧠 AI Learning Assistant:</strong><br><br>
                            Based on your question: "${question}"<br><br>
                            Here's my analysis and guidance:<br><br>
                            • <strong>Key Concept:</strong> The main idea you're exploring<br>
                            • <strong>Breaking it Down:</strong> Simplified explanation<br>
                            • <strong>Study Strategy:</strong> How to approach this topic<br>
                            • <strong>Additional Resources:</strong> Where to learn more<br><br>
                            <em>💡 Remember: Every expert was once a beginner. Keep asking questions!</em><br><br>
                            <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; margin-top: 12px;">
                                <strong>🎓 Study Quote:</strong><br>
                                <em>"The important thing is not to stop questioning. Curiosity has its own reason for existing."</em><br>
                                — Albert Einstein
                            </div>
                        </div>
                    `;
                }
            }
        }

        // Initialize Doubt Resolver
        const doubtResolver = new DoubtResolver();

        // UI Functions
        function toggleAuthMode() {
            const isLogin = document.getElementById('authTitle').textContent.includes('Sign In');
            
            if (isLogin) {
                // Switch to register
                document.getElementById('authTitle').textContent = 'Create Account';
                document.getElementById('authSubtitle').textContent = 'Join FlowState Pro to sync your progress';
                document.getElementById('nameInput').style.display = 'block';
                document.getElementById('confirmPasswordInput').style.display = 'block';
                document.getElementById('authSubmitBtn').textContent = 'Create Account';
                document.getElementById('authSwitchText').textContent = 'Already have an account?';
                document.getElementById('authSwitchLink').textContent = 'Sign In';
            } else {
                // Switch to login
                document.getElementById('authTitle').textContent = 'Welcome Back';
                document.getElementById('authSubtitle').textContent = 'Sign in to access your productivity data';
                document.getElementById('nameInput').style.display = 'none';
                document.getElementById('confirmPasswordInput').style.display = 'none';
                document.getElementById('authSubmitBtn').textContent = 'Sign In';
                document.getElementById('authSwitchText').textContent = "Don't have an account?";
                document.getElementById('authSwitchLink').textContent = 'Sign Up';
            }
        }

        // Auth form submission
        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            const isRegister = document.getElementById('nameInput').style.display !== 'none';
            
            try {
                if (isRegister) {
                    const name = document.getElementById('nameInput').value;
                    const confirmPassword = document.getElementById('confirmPasswordInput').value;
                    
                    if (password !== confirmPassword) {
                        throw new Error('Passwords do not match');
                    }
                    
                    const user = userManager.register(name, email, password);
                    userManager.login(user);
                } else {
                    const user = userManager.authenticate(email, password);
                    userManager.login(user);
                }
            } catch (error) {
                showToast(`❌ ${error.message}`);
            }
        });

        // Voice functions
        function toggleVoiceRecognition() {
            if (isListening) {
                voiceManager.recognition.stop();
            } else {
                voiceManager.startListening();
            }
        }

        function updateVoiceSettings() {
            voiceManager.loadVoices();
            if (currentUser) {
                userManager.saveUserData();
            }
        }

        function testVoice() {
            const quote = aiAssistant.getRandomQuote('motivation');
            voiceManager.speak(`${quote.text} — ${quote.author}`);
        }

        function startVoiceTaskCreation() {
            document.getElementById('voiceStatus').textContent = 'Say your task description...';
            voiceManager.startListening();
        }

        // UI Functions
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        function showProfile() {
            showToast('🚧 Profile settings coming soon!');
            toggleUserDropdown();
        }

        function showSettings() {
            showToast('⚙️ Settings panel coming soon!');
            toggleUserDropdown();
        }

        function exportData() {
            if (currentUser) {
                const data = {
                    user: currentUser.name,
                    tasks: tasks,
                    completedTasks: completedTasks,
                    exportDate: new Date()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `flowstate-data-${currentUser.name}-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                showToast('📤 Data exported successfully!');
            }
            toggleUserDropdown();
        }

        function showHelp() {
            showToast('❓ Help documentation coming soon!');
            toggleUserDropdown();
        }

        function logout() {
            userManager.logout();
            toggleUserDropdown();
        }

        // AI and messaging functions
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            try {
                const response = await aiAssistant.processMessage(message);
                addChatMessage(response, 'ai');
            } catch (error) {
                addChatMessage('Sorry, I encountered an error. Please try again.', 'ai');
            }
        }

        function addChatMessage(message, sender) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.style.cssText = `
                margin-bottom: 16px;
                padding: 12px 16px;
                border-radius: 18px;
                max-width: 85%;
                word-wrap: break-word;
                animation: fadeIn 0.3s ease;
            `;
            
            if (sender === 'user') {
                div.style.cssText += `
                    background: var(--accent-gradient);
                    color: white;
                    margin-left: auto;
                    text-align: right;
                `;
            } else {
                div.style.cssText += `
                    background: var(--card-bg);
                    color: var(--text-primary);
                    border: 1px solid var(--border-color);
                    margin-right: auto;
                `;
            }
            
            if (sender === 'ai') {
                div.innerHTML = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            } else {
                div.textContent = message;
            }
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function getMotivationalQuote() {
            const quote = aiAssistant.getRandomQuote('motivation');
            aiAssistant.displayQuote(quote, 'motivation');
            voiceManager.speak(`Here's some inspiration: ${quote.text}. ${quote.author} said this.`);
            addChatMessage(`Here's an inspiring quote for you:\n\n*"${quote.text}"*\n— ${quote.author}`, 'ai');
        }

        async function createTaskWithAI() {
            const input = document.getElementById('taskInput');
            const message = input.value.trim();
            
            if (!message) {
                showToast('❌ Please describe your task');
                return;
            }
            
            input.value = '';
            addChatMessage(message, 'user');
            
            try {
                const response = await aiAssistant.processMessage(message);
                addChatMessage(response, 'ai');
                
                // Show completion quote
                const quote = aiAssistant.getRandomQuote('success');
                setTimeout(() => {
                    voiceManager.speak(`Task created successfully! Remember: ${quote.text}`);
                }, 1000);
                
            } catch (error) {
                addChatMessage('Sorry, I had trouble creating that task. Please try again.', 'ai');
            }
        }

        // Doubt resolution
        async function resolveDoubt() {
            const question = document.getElementById('doubtInput').value.trim();
            
            if (!question) {
                showToast('❌ Please enter your question');
                return;
            }
            
            await doubtResolver.resolveDoubt(question);
        }

        function clearDoubt() {
            document.getElementById('doubtInput').value = '';
            document.getElementById('doubtResponse').classList.remove('show');
        }

        // Learning hub functions
        function openFlashcards() {
            showToast('🃏 Smart Flashcards feature coming soon!');
        }

        function openStudyPlanner() {
            showToast('📅 Study Planner feature coming soon!');
        }

        function openFocusTimer() {
            showToast('⏱️ Focus Timer feature coming soon!');
        }

        function openProgressTracker() {
            showToast('📊 Progress Tracker feature coming soon!');
        }

        // Theme management
        function setTheme(themeName) {
            currentTheme = themeName;
            document.body.setAttribute('data-theme', themeName);
            
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-theme') === themeName);
            });
            
            localStorage.setItem('flowstate-theme', themeName);
            
            if (currentUser) {
                userManager.saveUserData();
            }
        }

        // Task management
        function renderTasks() {
            const container = document.getElementById('tasksList');
            const summary = document.getElementById('tasksSummary');
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px;">📝</div>
                        <div>Create your first task to get started!</div>
                    </div>
                `;
                summary.textContent = 'No tasks scheduled';
                return;
            }
            
            const today = new Date().toDateString();
            const todayTasks = tasks.filter(t => t.createdAt.toDateString() === today);
            const completedToday = todayTasks.filter(t => t.completed).length;
            
            summary.textContent = `${completedToday}/${todayTasks.length} completed today`;
            
            container.innerHTML = '';
            
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.style.cssText = `
                    background: var(--bg-tertiary);
                    border-radius: 12px;
                    padding: 16px;
                    margin-bottom: 12px;
                    border: 1px solid var(--border-color);
                    transition: all 0.2s ease;
                `;
                
                taskElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 20px; height: 20px; border: 2px solid var(--primary-color); border-radius: 50%; cursor: pointer; ${task.completed ? 'background: var(--primary-color);' : ''}" onclick="toggleTask(${task.id})">
                            ${task.completed ? '<div style="color: white; font-size: 12px; text-align: center; line-height: 16px;">✓</div>' : ''}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary);">${task.title}</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">${task.time} • ${task.duration} min • ${task.createdBy}</div>
                        </div>
                        <button style="padding: 6px 12px; border: none; border-radius: 6px; background: var(--danger-color); color: white; cursor: pointer;" onclick="removeTask(${task.id})">Remove</button>
                    </div>
                `;
                
                container.appendChild(taskElement);
            });
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                
                if (task.completed) {
                    completedTasks.push({
                        ...task,
                        completedAt: new Date()
                    });
                    
                    // Show completion quote
                    const quote = aiAssistant.getRandomQuote('success');
                    addChatMessage(`🎉 Task completed! Here's a success quote for you:\n\n*"${quote.text}"*\n— ${quote.author}`, 'ai');
                    voiceManager.speak(`Excellent work! ${quote.text}`);
                } else {
                    completedTasks = completedTasks.filter(t => t.id !== id);
                }
                
                renderTasks();
                userManager.saveUserData();
            }
        }

        function removeTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            completedTasks = completedTasks.filter(t => t.id !== id);
            renderTasks();
            userManager.saveUserData();
            showToast('🗑️ Task removed');
        }

        // Utility functions
        function showToast(message) {
            // Create and show toast notification
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--bg-secondary);
                color: var(--text-primary);
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: var(--shadow-primary);
                z-index: 1000;
                border: 1px solid var(--border-color);
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            // Load saved theme
            const savedTheme = localStorage.getItem('flowstate-theme') || 'light';
            setTheme(savedTheme);
            
            // Initialize chat
            setTimeout(() => {
                if (isLoggedIn) {
                    addChatMessage("👋 Welcome back! I'm your Ultra AI assistant with voice recognition, motivational quotes, and advanced doubt resolution. How can I help you achieve your goals today?", 'ai');
                }
            }, 1000);
            
            // Enable Enter key for inputs
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            document.getElementById('taskInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') createTaskWithAI();
            });
            
            document.getElementById('doubtInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) resolveDoubt();
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.user-profile')) {
                    document.getElementById('userDropdown').classList.remove('show');
                }
            });
            
            // Show initial quote
            const initialQuote = aiAssistant.getRandomQuote('motivation');
            aiAssistant.displayQuote(initialQuote, 'motivation');
        });

        // Add CSS animation keyframes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
