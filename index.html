<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowState Pro - Ultimate AI Productivity Companion</title>
    <meta name="description" content="Ultimate AI productivity companion with real-time ChatGPT, user accounts, voice AI, system notifications, study tracking, and intelligent task management">
    <meta name="keywords" content="productivity, AI assistant, task management, study timer, focus app, flowstate, chatgpt, voice commands">
    <meta name="author" content="FlowState Pro">
    <meta name="theme-color" content="#3b82f6">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Enhanced Meta Tags for SEO -->
    <meta property="og:title" content="FlowState Pro - Ultimate AI Productivity Companion">
    <meta property="og:description" content="Transform your productivity with AI-powered task management, voice commands, real-time ChatGPT integration, and intelligent study tracking">
    <meta property="og:image" content="icon-512.png">
    <meta property="og:url" content="https://prakash-ravi11.github.io/flowstate-pro-new/">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="FlowState Pro - Ultimate AI Productivity Companion">
    <meta name="twitter:description" content="Transform your productivity with AI-powered task management">
    <meta name="twitter:image" content="icon-512.png">
    
    <!-- Cache Control for Updates -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="6.0.0">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "FlowState Pro",
        "description": "Ultimate AI productivity companion with user accounts, voice features, real-time ChatGPT, and intelligent task management",
        "url": "https://prakash-ravi11.github.io/flowstate-pro-new/",
        "applicationCategory": "ProductivityApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "creator": {
            "@type": "Organization",
            "name": "FlowState Pro Team"
        },
        "featureList": [
            "Real-time ChatGPT Integration",
            "Voice AI Assistant",
            "User Account Management",
            "Study Progress Tracking",
            "System Notifications",
            "Multiple Themes",
            "Task Timer Management",
            "Motivational Quotes",
            "Data Export/Import"
        ]
    }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Enhanced Service Worker Registration with Update Detection -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ ServiceWorker registration successful');
                        
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            console.log('üîÑ New version found, installing...');
                            
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        showUpdateNotification();
                                    } else {
                                        console.log('üéâ App ready for offline use');
                                    }
                                }
                            });
                        });
                        
                        navigator.serviceWorker.addEventListener('controllerchange', function() {
                            window.location.reload();
                        });
                        
                    })
                    .catch(function(err) {
                        console.log('‚ùå ServiceWorker registration failed:', err);
                    });
            });
        }

        function showUpdateNotification() {
            const updateBanner = document.createElement('div');
            updateBanner.id = 'updateBanner';
            updateBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: var(--primary-color);
                color: white;
                padding: 16px;
                text-align: center;
                z-index: 3000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: slideDown 0.3s ease;
            `;
            
            updateBanner.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; gap: 16px; max-width: 600px; margin: 0 auto;">
                    <span>üÜï New features available!</span>
                    <button onclick="updateApp()" style="padding: 8px 16px; background: white; color: var(--primary-color); border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                        Update Now
                    </button>
                    <button onclick="dismissUpdate()" style="padding: 8px 16px; background: transparent; color: white; border: 1px solid white; border-radius: 6px; cursor: pointer;">
                        Later
                    </button>
                </div>
            `;
            
            document.body.appendChild(updateBanner);
        }

        function updateApp() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(function(registration) {
                    if (registration && registration.waiting) {
                        registration.waiting.postMessage({type: 'SKIP_WAITING'});
                    }
                });
            }
            dismissUpdate();
        }

        function dismissUpdate() {
            const banner = document.getElementById('updateBanner');
            if (banner) {
                banner.remove();
            }
        }
    </script>
    
    <style>
        :root {
            /* Light Theme - Apple-Inspired */
            --bg-primary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --bg-tertiary: rgba(248, 250, 252, 0.9);
            --text-primary: #1a202c;
            --text-secondary: #64748b;
            --text-accent: #3b82f6;
            --border-color: rgba(0, 0, 0, 0.08);
            --shadow-primary: 0 10px 25px rgba(0, 0, 0, 0.08);
            --shadow-secondary: 0 4px 12px rgba(0, 0, 0, 0.04);
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --card-bg: rgba(255, 255, 255, 0.9);
            --accent-gradient: linear-gradient(135deg, #3b82f6, #1d4ed8);
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        [data-theme="dark"] {
            /* Dark Theme - Sophisticated & Modern */
            --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --bg-secondary: rgba(15, 23, 42, 0.95);
            --bg-tertiary: rgba(30, 41, 59, 0.9);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-accent: #60a5fa;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-primary: 0 25px 50px rgba(0, 0, 0, 0.4);
            --shadow-secondary: 0 8px 25px rgba(0, 0, 0, 0.2);
            --primary-color: #60a5fa;
            --success-color: #34d399;
            --warning-color: #fbbf24;
            --danger-color: #f87171;
            --card-bg: rgba(15, 23, 42, 0.95);
            --accent-gradient: linear-gradient(135deg, #60a5fa, #3730a3);
            --glass-bg: rgba(15, 23, 42, 0.7);
        }

        [data-theme="elegant"] {
            /* Elegant Theme - Luxury & Premium */
            --bg-primary: linear-gradient(135deg, #fdf4ff 0%, #f3e8ff 100%);
            --bg-secondary: rgba(253, 244, 255, 0.95);
            --bg-tertiary: rgba(243, 232, 255, 0.9);
            --text-primary: #581c87;
            --text-secondary: #7c3aed;
            --text-accent: #a855f7;
            --border-color: rgba(139, 92, 246, 0.15);
            --shadow-primary: 0 20px 40px rgba(139, 92, 246, 0.15);
            --shadow-secondary: 0 8px 20px rgba(139, 92, 246, 0.08);
            --primary-color: #8b5cf6;
            --success-color: #06d6a0;
            --warning-color: #ffd60a;
            --danger-color: #ff006e;
            --card-bg: rgba(253, 244, 255, 0.9);
            --accent-gradient: linear-gradient(135deg, #8b5cf6, #7c3aed);
            --glass-bg: rgba(253, 244, 255, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            overflow-x: hidden;
        }

        /* Apple-style Glass Morphism */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Enhanced Authentication Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            animation: fadeIn 0.3s ease;
        }

        .auth-modal.hidden {
            display: none;
        }

        .auth-content {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 48px;
            box-shadow: var(--shadow-primary);
            max-width: 480px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-logo {
            width: 80px;
            height: 80px;
            background: var(--accent-gradient);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: 700;
            margin: 0 auto 32px;
            box-shadow: 0 12px 40px rgba(0, 122, 255, 0.3);
        }

        .auth-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            letter-spacing: -0.02em;
        }

        .auth-subtitle {
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-size: 18px;
            font-weight: 500;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .auth-input {
            padding: 18px 20px;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            font-size: 17px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            transform: translateY(-2px);
        }

        .auth-input::placeholder {
            color: var(--text-secondary);
        }

        .auth-btn {
            padding: 18px 32px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
            font-family: inherit;
        }

        .auth-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
        }

        .auth-btn.loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .auth-btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid white;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Error and Success Messages */
        .error-message, .success-message {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 500;
            animation: slideDown 0.3s ease;
        }

        .error-message {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.2);
            color: var(--danger-color);
        }

        .success-message {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.2);
            color: var(--success-color);
        }

        .error-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: inherit;
            padding: 0;
            margin-left: 12px;
        }

        /* Gender Selector */
        .gender-selector {
            margin-bottom: 20px;
            text-align: left;
        }

        .gender-options {
            display: flex;
            gap: 16px;
            margin-top: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .radio-option:hover {
            background: var(--bg-tertiary);
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .radio-option input[type="radio"]:checked + span {
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Email Notice */
        .email-notice {
            background: rgba(0, 122, 255, 0.1);
            border: 1px solid rgba(0, 122, 255, 0.2);
            color: var(--primary-color);
            padding: 12px 16px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .forgot-password {
            margin-top: 16px;
            text-align: center;
            font-size: 14px;
        }

        .auth-switch {
            margin-top: 32px;
            color: var(--text-secondary);
            font-size: 16px;
        }

        .auth-link {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* Main App Container */
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 28px;
            padding: 40px;
            box-shadow: var(--shadow-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .app-logo {
            width: 56px;
            height: 56px;
            background: var(--accent-gradient);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 700;
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
        }

        .app-name {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .app-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-left: 4px;
            font-weight: 500;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        /* Enhanced Theme Selector */
        .theme-selector {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px;
            background: var(--bg-tertiary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .theme-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .theme-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
            transform: scale(1.05);
        }

        .theme-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        /* User Profile */
        .user-profile {
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border-radius: 16px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .user-profile:hover {
            background: var(--card-bg);
            transform: translateY(-2px);
            box-shadow: var(--shadow-secondary);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 16px;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            box-shadow: var(--shadow-primary);
            border: 1px solid var(--border-color);
            padding: 12px;
            min-width: 220px;
            z-index: 1000;
            display: none;
            margin-top: 8px;
        }

        .user-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .dropdown-item {
            padding: 16px 20px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s ease;
            color: var(--text-primary);
            font-weight: 500;
        }

        .dropdown-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(4px);
        }

        /* Voice Control Interface */
        .voice-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .voice-btn {
            width: 64px;
            height: 64px;
            border: none;
            border-radius: 50%;
            background: var(--accent-gradient);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
        }

        .voice-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
        }

        .voice-btn.listening {
            background: var(--danger-color);
            animation: pulse 2s infinite;
        }

        .voice-settings {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .voice-select {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 16px;
            font-family: inherit;
        }

        /* Enhanced Quote Display */
        .quote-display {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 32px;
            margin: 24px 0;
            border-left: 6px solid var(--primary-color);
            border: 1px solid var(--border-color);
            position: relative;
            box-shadow: var(--shadow-secondary);
        }

        .quote-text {
            font-style: italic;
            font-size: 20px;
            color: var(--text-primary);
            margin-bottom: 16px;
            line-height: 1.6;
            font-weight: 400;
        }

        .quote-author {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 16px;
        }

        .quote-category {
            position: absolute;
            top: 16px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Study Progress Tracking */
        .study-progress {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
        }

        .study-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .study-stat {
            text-align: center;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .study-stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .study-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Main Content Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 40px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 28px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-primary);
        }

        .card-header {
            margin-bottom: 28px;
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.01em;
        }

        .card-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Enhanced Input Styles */
        .input-group {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .input-wrapper {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 140px;
        }

        .input-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .input-field {
            padding: 16px 20px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 17px;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
            font-family: inherit;
            color: var(--text-primary);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }

        .input-field::placeholder {
            color: var(--text-secondary);
        }

        /* Enhanced Button Styles */
        .btn {
            padding: 16px 28px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
            text-align: center;
            justify-content: center;
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 12px 20px;
            font-size: 15px;
        }

        /* ChatGPT Integration Section */
        .chatgpt-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 28px;
            border: 1px solid var(--border-color);
            margin-bottom: 24px;
            box-shadow: var(--shadow-secondary);
        }

        .chatgpt-input {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .chatgpt-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            transform: translateY(-2px);
        }

        .chatgpt-response {
            background: var(--bg-tertiary);
            border-radius: 16px;
            padding: 24px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            display: none;
            line-height: 1.6;
        }

        .chatgpt-response.show {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        /* Enhanced Task Display */
        .task-item {
            background: var(--bg-tertiary);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .task-item:hover {
            background: var(--card-bg);
            transform: translateX(8px);
            box-shadow: var(--shadow-secondary);
        }

        .task-item.completed {
            background: rgba(52, 199, 89, 0.1);
            border-color: var(--success-color);
        }

        .task-main {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .task-checkbox {
            width: 28px;
            height: 28px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
        }

        .task-checkbox:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .task-checkbox.checked {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .task-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 16px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 18px;
        }

        .task-meta {
            font-size: 15px;
            color: var(--text-secondary);
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        /* AI Chat Interface */
        .ai-chat-container {
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: var(--bg-tertiary);
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 20px;
            padding: 16px 20px;
            border-radius: 20px;
            max-width: 85%;
            word-wrap: break-word;
            animation: messageSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: var(--accent-gradient);
            color: white;
            margin-left: auto;
            text-align: right;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        .message.ai {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            margin-right: auto;
            box-shadow: var(--shadow-secondary);
        }

        .message.system {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
            text-align: center;
            margin: 16px auto;
            font-size: 15px;
            font-weight: 600;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            font-weight: 500;
        }

        .quick-action:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 16px 24px;
            color: var(--text-secondary);
            font-style: italic;
            font-size: 15px;
            align-items: center;
            gap: 12px;
        }

        .typing-indicator.show {
            display: flex;
        }

        .thinking-dots {
            display: flex;
            gap: 6px;
        }

        .thinking-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
            animation: thinking 1.4s infinite ease-in-out;
        }

        .thinking-dot:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes thinking {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        /* Progress Ring */
        .progress-ring {
            width: 140px;
            height: 140px;
            margin: 32px auto;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-ring .background {
            stroke: var(--border-color);
        }

        .progress-ring .progress {
            stroke: var(--primary-color);
            stroke-dasharray: 377;
            stroke-dashoffset: 377;
            transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Stats and Analytics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-secondary);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .voice-controls {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 24px;
                border-radius: 20px;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 16px;
            }

            .auth-content {
                padding: 32px;
                border-radius: 20px;
            }

            .voice-controls {
                flex-direction: column;
                gap: 16px;
            }

            .input-group {
                flex-direction: column;
            }

            .study-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .show { display: block !important; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--primary-color);
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body data-theme="light">
    <!-- Enhanced Authentication Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <div class="auth-logo">FS</div>
            <div class="auth-title" id="authTitle">Welcome to FlowState Pro</div>
            <div class="auth-subtitle" id="authSubtitle">Create your personalized productivity workspace</div>
            
            <!-- Error Message Display -->
            <div class="error-message hidden" id="errorMessage">
                <span id="errorText"></span>
                <button onclick="dismissError()" class="error-close">√ó</button>
            </div>
            
            <!-- Success Message Display -->
            <div class="success-message hidden" id="successMessage">
                <span id="successText"></span>
            </div>
            
            <form class="auth-form" id="authForm">
                <!-- Registration Fields -->
                <input type="text" class="auth-input" id="nameInput" placeholder="Full Name" style="display: none;" required>
                <input type="number" class="auth-input" id="ageInput" placeholder="Age" min="13" max="120" style="display: none;">
                <div class="gender-selector" id="genderSelector" style="display: none;">
                    <label class="input-label">Gender</label>
                    <div class="gender-options">
                        <label class="radio-option">
                            <input type="radio" name="gender" value="male" id="genderMale">
                            <span>Male</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="female" id="genderFemale">
                            <span>Female</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="other" id="genderOther">
                            <span>Other</span>
                        </label>
                    </div>
                </div>
                
                <!-- Common Fields -->
                <input type="email" class="auth-input" id="emailInput" placeholder="Email Address" required>
                <input type="password" class="auth-input" id="passwordInput" placeholder="Password (min 6 characters)" minlength="6" required>
                <input type="password" class="auth-input" id="confirmPasswordInput" placeholder="Confirm Password" style="display: none;" required>
                
                <!-- Email Verification Notice -->
                <div class="email-notice hidden" id="emailNotice">
                    <span>üìß Please check your email for verification link</span>
                </div>
                
                <button type="submit" class="auth-btn" id="authSubmitBtn">Sign In</button>
            </form>
            
            <div class="auth-switch">
                <span id="authSwitchText">Don't have an account?</span>
                <span class="auth-link" id="authSwitchLink" onclick="toggleAuthMode()">Create Account</span>
            </div>
            
            <!-- Forgot Password Link -->
            <div class="forgot-password">
                <span class="auth-link" onclick="showForgotPassword()">Forgot Password?</span>
            </div>
        </div>
    </div>

    <div class="app-container glass hidden" id="mainApp">
        <!-- Enhanced App Header -->
        <div class="app-header">
            <div class="app-title">
                <div class="app-logo">FS</div>
                <div>
                    <div class="app-name">FlowState Pro</div>
                    <div class="app-subtitle">Ultimate AI Productivity Companion</div>
                </div>
            </div>
            <div class="header-controls">
                <div class="theme-selector">
                    <button class="theme-btn active" data-theme="light" onclick="setTheme('light')">Light</button>
                    <button class="theme-btn" data-theme="dark" onclick="setTheme('dark')">Dark</button>
                    <button class="theme-btn" data-theme="elegant" onclick="setTheme('elegant')">Elegant</button>
                </div>
                
                <!-- User Profile -->
                <div class="user-profile" id="userProfile" onclick="toggleUserDropdown()">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <div class="user-name" id="userName">Guest</div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item" onclick="showProfile()">
                            <span>üë§</span> My Profile
                        </div>
                        <div class="dropdown-item" onclick="showStats()">
                            <span>üìä</span> My Statistics
                        </div>
                        <div class="dropdown-item" onclick="exportData()">
                            <span>üì§</span> Export Data
                        </div>
                        <div class="dropdown-item" onclick="importData()">
                            <span>üì•</span> Import Data
                        </div>
                        <div class="dropdown-item" onclick="showSettings()">
                            <span>‚öôÔ∏è</span> Settings
                        </div>
                        <div class="dropdown-item" onclick="showHelp()">
                            <span>‚ùì</span> Help & Support
                        </div>
                        <div class="dropdown-item" onclick="logout()">
                            <span>üö™</span> Sign Out
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Voice Panel -->
        <div class="voice-panel">
            <div class="card-title">üé§ Voice AI Assistant</div>
            <div class="card-subtitle">Talk naturally with your AI productivity coach</div>
            
            <div class="voice-controls">
                <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()">
                    üé§
                </button>
                
                <div class="voice-settings">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="input-label">Voice Gender</label>
                        <select id="voiceGender" class="voice-select" onchange="updateVoiceSettings()">
                            <option value="female">Female (Recommended)</option>
                            <option value="male">Male</option>
                            <option value="neutral">Neutral</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="input-label">Voice Speed</label>
                        <select id="voiceSpeed" class="voice-select" onchange="updateVoiceSettings()">
                            <option value="0.8">Slow</option>
                            <option value="0.9" selected>Normal</option>
                            <option value="1.0">Fast</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-secondary btn-small" onclick="testVoice()">Test Voice</button>
                </div>
                
                <div id="voiceStatus" style="color: var(--text-secondary); font-size: 16px; font-weight: 500;">
                    Voice AI ready - Click microphone to start
                </div>
            </div>
        </div>

        <!-- Dynamic Quote Display -->
        <div class="quote-display" id="quoteDisplay">
            <div class="quote-category" id="quoteCategory">Motivation</div>
            <div class="quote-text" id="quoteText">
                "The way to get started is to quit talking and begin doing."
            </div>
            <div class="quote-author" id="quoteAuthor">‚Äî Walt Disney</div>
        </div>

        <!-- Study Progress Tracking Section -->
        <div class="study-progress">
            <div class="card-title">üìö Study Progress Dashboard</div>
            <div class="card-subtitle">Comprehensive tracking of your learning sessions</div>
            
            <div class="study-stats">
                <div class="study-stat">
                    <div class="study-stat-number" id="totalStudyTime">0h 0m</div>
                    <div class="study-stat-label">Total Study Time</div>
                </div>
                <div class="study-stat">
                    <div class="study-stat-number" id="studyStreak">0</div>
                    <div class="study-stat-label">Study Streak (Days)</div>
                </div>
                <div class="study-stat">
                    <div class="study-stat-number" id="breaksTaken">0</div>
                    <div class="study-stat-label">Breaks Taken</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div style="display: flex; flex-direction: column; gap: 32px;">
                <!-- Ultra AI Assistant -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üß† Ultra AI Assistant</div>
                        <div class="card-subtitle">Personalized productivity coaching with your name</div>
                    </div>
                    
                    <div class="ai-chat-container">
                        <div class="chat-messages" id="chatMessages"></div>
                        <div class="typing-indicator" id="typingIndicator">
                            <span>Ultra AI is crafting a personalized response</span>
                            <div class="thinking-dots">
                                <div class="thinking-dot"></div>
                                <div class="thinking-dot"></div>
                                <div class="thinking-dot"></div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <div class="input-wrapper">
                                <input type="text" class="input-field" id="chatInput" placeholder="Ask me anything or describe a task...">
                            </div>
                            <button class="btn btn-primary btn-small" onclick="sendMessage()">
                                üöÄ Send
                            </button>
                        </div>
                        
                        <div class="quick-actions">
                            <button class="quick-action" onclick="quickAction('motivation')">üí™ Motivate Me</button>
                            <button class="quick-action" onclick="quickAction('tips')">üí° Pro Tips</button>
                            <button class="quick-action" onclick="quickAction('quote')">‚ú® Inspire Me</button>
                            <button class="quick-action" onclick="quickAction('focus')">üéØ Focus Help</button>
                            <button class="quick-action" onclick="quickAction('study')">üìö Study Guide</button>
                        </div>
                    </div>
                </div>

                <!-- Real-time ChatGPT Integration -->
                <div class="chatgpt-section">
                    <div class="card-title">ü§ñ Ask Anything - Real-time AI</div>
                    <div class="card-subtitle">Get instant answers to any question beyond productivity scope</div>
                    
                    <textarea class="chatgpt-input" id="chatgptInput" placeholder="Ask any question - academic, general knowledge, programming, creative writing, problem solving, or anything else you're curious about..."></textarea>
                    
                    <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="askChatGPT()">
                            üß† Ask AI
                        </button>
                        <button class="btn btn-secondary" onclick="clearChatGPT()">
                            üóëÔ∏è Clear
                        </button>
                        <button class="btn btn-secondary" onclick="speakResponse()">
                            üîä Speak Answer
                        </button>
                        <button class="btn btn-secondary" onclick="saveResponse()">
                            üíæ Save Response
                        </button>
                    </div>
                    
                    <div class="chatgpt-response" id="chatgptResponse">
                        <div style="font-weight: 600; margin-bottom: 16px; color: var(--primary-color); font-size: 18px;">
                            ü§ñ AI Response:
                        </div>
                        <div id="chatgptAnswer"></div>
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color); font-size: 14px; color: var(--text-secondary);">
                            <strong>Response time:</strong> <span id="responseTime">0ms</span> | 
                            <strong>Words:</strong> <span id="wordCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- Smart Task Creator with Advanced AI -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üéØ Advanced Task Creator</div>
                        <div class="card-subtitle">Ultra-intelligent task creation with voice and natural language</div>
                    </div>
                    
                    <div class="input-group">
                        <div class="input-wrapper">
                            <label class="input-label">Describe Your Task (Natural Language)</label>
                            <input type="text" class="input-field" id="ultraAIInput" placeholder="E.g., 'Study mathematics for 90 minutes at 7 PM tomorrow' or 'Workout session at 6 AM for 45 mins'">
                        </div>
                        <button class="btn btn-primary" onclick="createTaskWithUltraAI()">
                            ü§ñ Create
                        </button>
                        <button class="btn btn-secondary" onclick="startVoiceTaskCreation()">
                            üé§ Voice
                        </button>
                    </div>

                    <div id="aiProcessing" class="typing-indicator">
                        <span>Ultra AI is analyzing your request</span>
                        <div class="thinking-dots">
                            <div class="thinking-dot"></div>
                            <div class="thinking-dot"></div>
                            <div class="thinking-dot"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div style="display: flex; flex-direction: column; gap: 32px;">
                <!-- Enhanced Tasks Display with Timers -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìã Today's Mission</div>
                        <div class="card-subtitle" id="tasksSummary">Ready to conquer your goals</div>
                    </div>
                    <div id="tasksList">
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <div style="font-size: 64px; margin-bottom: 20px;">üéØ</div>
                            <div style="font-size: 18px; font-weight: 500;">Your productivity journey starts here!</div>
                            <div style="font-size: 15px; margin-top: 8px;">Create your first task above</div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Progress Display -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üèÜ Daily Achievement</div>
                        <div class="card-subtitle">Your progress matters</div>
                    </div>
                    
                    <div class="progress-ring">
                        <svg>
                            <circle class="background" cx="70" cy="70" r="60"></circle>
                            <circle class="progress" cx="70" cy="70" r="60" id="progressCircle"></circle>
                        </svg>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                            <div style="font-size: 28px; font-weight: 800; color: var(--primary-color);" id="progressPercent">0%</div>
                            <div style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">Complete</div>
                        </div>
                    </div>

                    <div class="text-center">
                        <div style="font-size: 20px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;" id="dailyMessage">Ready to achieve greatness!</div>
                        <button class="btn btn-secondary btn-small" onclick="getPersonalMotivation()">
                            üöÄ Motivate Me
                        </button>
                    </div>
                </div>

                <!-- Advanced Analytics -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìä Advanced Analytics</div>
                        <div class="card-subtitle">Comprehensive productivity insights</div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="completionRate">0%</div>
                            <div class="stat-label">Completion Rate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalTime">0h</div>
                            <div class="stat-label">Time Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="streakCount">0</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalTasks">0</div>
                            <div class="stat-label">Total Tasks</div>
                        </div>
                    </div>
                </div>

                <!-- Weekly Goals Tracker -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üèÜ Weekly Goals</div>
                        <div class="card-subtitle">Track your long-term objectives</div>
                    </div>
                    
                    <div style="margin-top: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 500;">Study Hours</span>
                            <span style="font-weight: 600; color: var(--primary-color);" id="weeklyStudyProgress">0 / 20 hrs</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; background: var(--primary-color); transition: width 0.3s ease; width: 0%;" id="weeklyStudyBar"></div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 500;">Tasks Completed</span>
                            <span style="font-weight: 600; color: var(--success-color);" id="weeklyTaskProgress">0 / 50 tasks</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; background: var(--success-color); transition: width 0.3s ease; width: 0%;" id="weeklyTaskBar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 2000;"></div>

    <script>
        // Enhanced Application State with All Features
        let currentUser = null;
        let tasks = [];
        let completedTasks = [];
        let currentTheme = 'light';
        let isLoggedIn = false;
        let voiceRecognition = null;
        let speechSynthesis = window.speechSynthesis;
        let selectedVoice = null;
        let isListening = false;
        let motivationCount = 0;
        let lastChatGPTResponse = '';
        let activeTimers = new Map();
        let studySession = null;
        let studyStats = {
            totalStudyTime: 0,
            studyStreak: 0,
            breaksTaken: 0,
            currentSessionTime: 0
        };
        let progressChart = null;
        let selectedDuration = 60;
        let isLoginMode = true;

        // Comprehensive Quotes Database with Factual Attribution
        const quotesDatabase = {
            motivation: [
                { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
                { text: "Innovation distinguishes between a leader and a follower.", author: "Steve Jobs" },
                { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
                { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
                { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
                { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
                { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
                { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
                { text: "Success is walking from failure to failure with no loss of enthusiasm.", author: "Winston Churchill" },
                { text: "Your limitation‚Äîit's only your imagination.", author: "Anonymous" }
            ],
            productivity: [
                { text: "Focus on being productive instead of busy.", author: "Tim Ferriss" },
                { text: "The key is not to prioritize what's on your schedule, but to schedule your priorities.", author: "Stephen Covey" },
                { text: "You don't have to be great to get started, but you have to get started to be great.", author: "Les Brown" },
                { text: "Time is what we want most, but what we use worst.", author: "William Penn" },
                { text: "Productivity is never an accident. It is always the result of a commitment to excellence.", author: "Paul J. Meyer" },
                { text: "The successful warrior is the average man with laser-like focus.", author: "Bruce Lee" },
                { text: "Concentrate all your thoughts upon the work at hand.", author: "Alexander Graham Bell" },
                { text: "Where focus goes, energy flows and results show.", author: "Tony Robbins" }
            ],
            study: [
                { text: "Education is the most powerful weapon which you can use to change the world.", author: "Nelson Mandela" },
                { text: "The more that you read, the more things you will know. The more that you learn, the more places you'll go.", author: "Dr. Seuss" },
                { text: "Learning never exhausts the mind.", author: "Leonardo da Vinci" },
                { text: "The expert in anything was once a beginner.", author: "Helen Hayes" },
                { text: "Study hard what interests you the most in the most undisciplined, irreverent and original manner possible.", author: "Richard Feynman" },
                { text: "The beautiful thing about learning is that nobody can take it away from you.", author: "B.B. King" },
                { text: "Education is not preparation for life; education is life itself.", author: "John Dewey" },
                { text: "The mind is not a vessel to be filled, but a fire to be kindled.", author: "Plutarch" }
            ],
            fictional: [
                { text: "With great power comes great responsibility.", author: "Spider-Man (Uncle Ben)" },
                { text: "I am vengeance, I am the night, I am Batman.", author: "Batman (Bruce Wayne)" },
                { text: "Do or do not, there is no try.", author: "Yoda (Star Wars)" },
                { text: "It's not who I am underneath, but what I do that defines me.", author: "Batman (Batman Begins)" },
                { text: "In brightest day, in blackest night, no evil shall escape my sight.", author: "Green Lantern Corps" },
                { text: "I can do this all day.", author: "Captain America (Steve Rogers)" },
                { text: "Sometimes you gotta run before you can walk.", author: "Iron Man (Tony Stark)" },
                { text: "The hardest choices require the strongest wills.", author: "Thanos (Avengers)" }
            ],
            success: [
                { text: "Success is not the key to happiness. Happiness is the key to success.", author: "Albert Schweitzer" },
                { text: "Don't be afraid to give up the good to go for the great.", author: "John D. Rockefeller" },
                { text: "The way to achieve your own success is to be willing to help somebody else get it first.", author: "Iyanla Vanzant" },
                { text: "Success is going from failure to failure without losing your enthusiasm.", author: "Winston Churchill" },
                { text: "Success is not how high you have climbed, but how you make a positive difference to the world.", author: "Roy T. Bennett" }
            ]
        };

        // Personalized Motivational Messages with User Name Integration
        const personalizedMotivation = [
            "üî• {name}, you're absolutely crushing it today! Your dedication is inspiring everyone around you!",
            "üí™ Hey {name}, remember that every small step you take is building something incredible!",
            "üåü {name}, your future self is going to thank you for the amazing work you're doing right now!",
            "‚ö° You've got this, {name}! Your consistency is what separates champions from dreamers!",
            "üéØ {name}, you're not just completing tasks - you're actively designing the life you want!",
            "üöÄ Amazing work, {name}! Your commitment to growth is truly remarkable and inspiring!",
            "üíé {name}, every challenge you overcome makes you stronger and more resilient!",
            "üèÜ You're making incredible progress, {name}! Stay focused on your extraordinary goals!",
            "‚≠ê {name}, your discipline today creates your freedom and success tomorrow!",
            "üåà Outstanding effort, {name}! You're turning dreams into reality with every action!"
        ];

        // Enhanced User Authentication System with Email Verification
        class AdvancedUserManager {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('flowstate-users') || '{}');
                this.currentUser = JSON.parse(localStorage.getItem('flowstate-current-user') || 'null');
                this.verificationCodes = JSON.parse(localStorage.getItem('flowstate-verification') || '{}');
            }

            async register(userData) {
                const { name, age, gender, email, password } = userData;
                
                if (this.users[email]) {
                    throw new Error('An account with this email already exists. Please sign in or use a different email.');
                }

                this.validateRegistrationData(userData);

                const user = {
                    id: Date.now(),
                    name: name.trim(),
                    age: parseInt(age) || null,
                    gender: gender,
                    email: email.toLowerCase().trim(),
                    password: password,
                    emailVerified: true, // For demo purposes
                    createdAt: new Date(),
                    tasks: [],
                    completedTasks: [],
                    preferences: {
                        theme: 'light',
                        voiceGender: gender === 'female' ? 'female' : 'male',
                        voiceSpeed: '0.9',
                        notifications: true
                    },
                    stats: {
                        totalStudyTime: 0,
                        tasksCompleted: 0,
                        streakDays: 0,
                        motivationsReceived: 0
                    }
                };

                this.users[email] = user;
                localStorage.setItem('flowstate-users', JSON.stringify(this.users));
                return user;
            }

            validateRegistrationData(userData) {
                const { name, email, password } = userData;

                if (!name || name.trim().length < 2) {
                    throw new Error('Please enter a valid full name (at least 2 characters).');
                }

                if (!this.isValidEmail(email)) {
                    throw new Error('Please enter a valid email address.');
                }

                if (password.length < 6) {
                    throw new Error('Password must be at least 6 characters long.');
                }
            }

            isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            authenticate(email, password) {
                const user = this.users[email.toLowerCase().trim()];
                
                if (!user) {
                    throw new Error('No account found with this email address. Please create an account first.');
                }
                
                if (user.password !== password) {
                    throw new Error('Incorrect password. Please try again or reset your password.');
                }
                
                return user;
            }

            login(user) {
                this.currentUser = user;
                currentUser = user;
                isLoggedIn = true;

                localStorage.setItem('flowstate-current-user', JSON.stringify(user));

                tasks = user.tasks || [];
                completedTasks = user.completedTasks || [];
                
                this.updateUserUI();
                this.hideAuthModal();
                
                if (user.preferences) {
                    setTheme(user.preferences.theme || 'light');
                }

                const greeting = this.getTimeBasedGreeting();
                voiceManager.speak(`${greeting}, ${user.name}! Welcome back to FlowState Pro!`);
                
                showToast(`Welcome back, ${user.name}! üéâ`);
                
                setTimeout(() => {
                    const personalizedWelcome = `üåü ${greeting}, ${user.name}! I'm excited to help you achieve your goals today. Your dedication to productivity is truly inspiring!`;
                    addChatMessage(personalizedWelcome, 'ai');
                }, 1500);
            }

            getTimeBasedGreeting() {
                const hour = new Date().getHours();
                if (hour < 12) return 'Good morning';
                if (hour < 17) return 'Good afternoon';
                return 'Good evening';
            }

            hideAuthModal() {
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
            }

            showAuthModal() {
                document.getElementById('authModal').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }

            logout() {
                if (this.currentUser) {
                    this.saveUserData();
                    voiceManager.speak(`Goodbye, ${this.currentUser.name}! Have a productive day!`);
                }

                this.currentUser = null;
                currentUser = null;
                isLoggedIn = false;
                tasks = [];
                completedTasks = [];

                localStorage.removeItem('flowstate-current-user');
                
                this.updateUserUI();
                this.showAuthModal();
                showToast('Signed out successfully');
            }

            updateUserUI() {
                if (this.currentUser) {
                    document.getElementById('userName').textContent = this.currentUser.name;
                    document.getElementById('userAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                } else {
                    document.getElementById('userName').textContent = 'Guest';
                    document.getElementById('userAvatar').textContent = '?';
                }
                renderTasks();
            }

            saveUserData() {
                if (!this.currentUser) return;

                this.currentUser.tasks = tasks;
                this.currentUser.completedTasks = completedTasks;
                this.currentUser.preferences = {
                    theme: currentTheme,
                    voiceGender: document.getElementById('voiceGender')?.value || 'female',
                    voiceSpeed: document.getElementById('voiceSpeed')?.value || '0.9',
                    notifications: true
                };

                this.users[this.currentUser.email] = this.currentUser;
                localStorage.setItem('flowstate-users', JSON.stringify(this.users));
                localStorage.setItem('flowstate-current-user', JSON.stringify(this.currentUser));
            }
        }

        // Enhanced Voice Manager with Realistic High-Quality Voices
        class VoiceManager {
            constructor() {
                this.voices = [];
                this.selectedVoice = null;
                this.settings = {
                    rate: 0.9,
                    pitch: 1.0,
                    volume: 0.8
                };
                this.initializeVoiceRecognition();
                this.initializeVoiceSynthesis();
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        isListening = true;
                        document.getElementById('voiceBtn').classList.add('listening');
                        document.getElementById('voiceStatus').textContent = currentUser ? 
                            `Listening, ${currentUser.name}...` : 'Listening...';
                    };

                    this.recognition.onend = () => {
                        isListening = false;
                        document.getElementById('voiceBtn').classList.remove('listening');
                        document.getElementById('voiceStatus').textContent = 'Voice AI ready - Click microphone to start';
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processVoiceCommand(transcript);
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.speak('Sorry, I had trouble understanding you. Please try again.');
                        showToast('‚ùå Voice recognition error. Please try again.');
                    };
                }
            }

            initializeVoiceSynthesis() {
                if ('speechSynthesis' in window) {
                    this.loadVoices();
                    speechSynthesis.onvoiceschanged = () => this.loadVoices();
                }
            }

            loadVoices() {
                this.voices = speechSynthesis.getVoices();
                this.selectBestVoice();
            }

            selectBestVoice() {
                const genderPref = document.getElementById('voiceGender')?.value || 'female';
                
                const preferredVoices = {
                    female: [
                        'Samantha', 'Karen', 'Tessa', 'Moira', 'Fiona', 'Google US English Female',
                        'Microsoft Zira', 'Microsoft Hazel', 'Alex (Enhanced)', 'Ava (Premium)',
                        'Google fran√ßais', 'Microsoft Julie'
                    ],
                    male: [
                        'Daniel', 'Thomas', 'Oliver', 'Google US English Male', 'Microsoft David',
                        'Microsoft Mark', 'Alex', 'Fred (Premium)', 'Google US English',
                        'Microsoft Paul'
                    ],
                    neutral: [
                        'Alex', 'Google US English', 'Microsoft Speech Platform'
                    ]
                };

                const targetVoices = preferredVoices[genderPref] || preferredVoices.female;
                
                for (let voiceName of targetVoices) {
                    const voice = this.voices.find(v => 
                        v.name.includes(voiceName) && v.lang.includes('en')
                    );
                    if (voice) {
                        this.selectedVoice = voice;
                        break;
                    }
                }

                if (!this.selectedVoice) {
                    this.selectedVoice = this.voices.find(v => v.lang.includes('en')) || this.voices[0];
                }

                this.settings.rate = parseFloat(document.getElementById('voiceSpeed')?.value || '0.9');
            }

            speak(text) {
                if (!speechSynthesis || !text) return;

                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                
                if (this.selectedVoice) {
                    utterance.voice = this.selectedVoice;
                }
                
                utterance.rate = this.settings.rate;
                utterance.pitch = this.settings.pitch;
                utterance.volume = this.settings.volume;

                speechSynthesis.speak(utterance);
            }

            startListening() {
                if (this.recognition && !isListening) {
                    this.recognition.start();
                }
            }

            processVoiceCommand(transcript) {
                console.log('üé§ Voice command received:', transcript);
                
                const userName = currentUser ? currentUser.name : 'there';
                document.getElementById('voiceStatus').textContent = `Processing: "${transcript}"`;
                
                if (this.isTaskCreationCommand(transcript)) {
                    document.getElementById('ultraAIInput').value = transcript;
                    createTaskWithUltraAI();
                    this.speak(`Great idea, ${userName}! I'm creating that task for you right now.`);
                } else if (this.isMotivationRequest(transcript)) {
                    getPersonalMotivation();
                } else if (this.isQuoteRequest(transcript)) {
                    getMotivationalQuote();
                } else if (this.isStudyRequest(transcript)) {
                    quickAction('study');
                } else {
                    document.getElementById('chatInput').value = transcript;
                    sendMessage();
                    this.speak(`Let me help you with that, ${userName}.`);
                }
            }

            isTaskCreationCommand(text) {
                const taskKeywords = ['create', 'add', 'schedule', 'remind', 'task', 'plan', 'do', 'make'];
                return taskKeywords.some(keyword => text.toLowerCase().includes(keyword));
            }

            isMotivationRequest(text) {
                const motivationKeywords = ['motivate', 'inspire', 'encourage', 'boost', 'pump up', 'energy'];
                return motivationKeywords.some(keyword => text.toLowerCase().includes(keyword));
            }

            isQuoteRequest(text) {
                const quoteKeywords = ['quote', 'saying', 'wisdom', 'inspiration', 'inspire me'];
                return quoteKeywords.some(keyword => text.toLowerCase().includes(keyword));
            }

            isStudyRequest(text) {
                const studyKeywords = ['study', 'learn', 'homework', 'assignment', 'exam', 'research'];
                return studyKeywords.some(keyword => text.toLowerCase().includes(keyword));
            }
        }

        // Initialize managers
        const userManager = new AdvancedUserManager();
        const voiceManager = new VoiceManager();

        // Authentication Functions
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            
            const nameInput = document.getElementById('nameInput');
            const ageInput = document.getElementById('ageInput');
            const genderSelector = document.getElementById('genderSelector');
            const confirmInput = document.getElementById('confirmPasswordInput');
            const submitBtn = document.getElementById('authSubmitBtn');
            const title = document.getElementById('authTitle');
            const subtitle = document.getElementById('authSubtitle');
            const switchText = document.getElementById('authSwitchText');
            const switchLink = document.getElementById('authSwitchLink');
            
            if (isLoginMode) {
                nameInput.style.display = 'none';
                ageInput.style.display = 'none';
                genderSelector.style.display = 'none';
                confirmInput.style.display = 'none';
                submitBtn.textContent = 'Sign In';
                title.textContent = 'Welcome Back';
                subtitle.textContent = 'Sign in to your FlowState Pro account';
                switchText.textContent = "Don't have an account?";
                switchLink.textContent = 'Create Account';
                
                nameInput.required = false;
                confirmInput.required = false;
            } else {
                nameInput.style.display = 'block';
                ageInput.style.display = 'block';
                genderSelector.style.display = 'block';
                confirmInput.style.display = 'block';
                submitBtn.textContent = 'Create Account';
                title.textContent = 'Join FlowState Pro';
                subtitle.textContent = 'Create your personalized productivity workspace';
                switchText.textContent = 'Already have an account?';
                switchLink.textContent = 'Sign In';
                
                nameInput.required = true;
                confirmInput.required = true;
            }
            
            // Clear any errors
            dismissError();
        }

        function handleAuth(event) {
            event.preventDefault();
            
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value;
            
            if (!email || !password) {
                showErrorMessage('Please fill in all required fields');
                return;
            }
            
            const submitBtn = document.getElementById('authSubmitBtn');
            submitBtn.classList.add('loading');
            
            try {
                if (isLoginMode) {
                    // Login
                    const user = userManager.authenticate(email, password);
                    userManager.login(user);
                    showSuccessMessage(`Welcome back, ${user.name}!`);
                } else {
                    // Register
                    const name = document.getElementById('nameInput').value.trim();
                    const age = document.getElementById('ageInput').value;
                    const gender = document.querySelector('input[name="gender"]:checked')?.value;
                    const confirmPassword = document.getElementById('confirmPasswordInput').value;
                    
                    if (password !== confirmPassword) {
                        throw new Error('Passwords do not match. Please try again.');
                    }
                    
                    const user = userManager.register({ name, age, gender, email, password });
                    userManager.login(user);
                    showSuccessMessage(`Account created successfully! Welcome, ${user.name}!`);
                }
            } catch (error) {
                showErrorMessage(error.message);
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.textContent = isLoginMode ? 'Sign In' : 'Create Account';
            }
        }

        function showErrorMessage(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function showSuccessMessage(message) {
            const successDiv = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            
            successText.textContent = message;
            successDiv.classList.remove('hidden');
            
            setTimeout(() => {
                successDiv.classList.add('hidden');
            }, 3000);
        }

        function dismissError() {
            document.getElementById('errorMessage').classList.add('hidden');
        }

        function showForgotPassword() {
            showSuccessMessage('Password reset feature coming soon! For now, please create a new account.');
        }

        // Main App Functions
        function logout() {
            userManager.logout();
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        function setTheme(themeName) {
            currentTheme = themeName;
            document.body.setAttribute('data-theme', themeName);
            
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-theme') === themeName);
            });
            
            localStorage.setItem('flowstate-theme', themeName);
            showToast(`üé® Switched to ${themeName} theme`);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--bg-secondary);
                color: var(--text-primary);
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: var(--shadow-primary);
                z-index: 1000;
                border: 1px solid var(--border-color);
                backdrop-filter: blur(20px);
                animation: slideDown 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Voice Functions
        function toggleVoiceRecognition() {
            if (!voiceManager.recognition) {
                showToast('‚ùå Voice recognition not supported in this browser');
                return;
            }

            if (isListening) {
                voiceManager.recognition.stop();
            } else {
                voiceManager.startListening();
            }
        }

        function updateVoiceSettings() {
            voiceManager.selectBestVoice();
        }

        function testVoice() {
            const userName = currentUser ? currentUser.name : 'there';
            voiceManager.speak(`Hello ${userName}! I'm your FlowState Pro AI assistant. I'm here to help you stay productive and motivated!`);
        }

        function startVoiceTaskCreation() {
            voiceManager.speak("Please describe the task you want to create");
            setTimeout(() => {
                toggleVoiceRecognition();
            }, 2000);
        }

        // Quote Functions
        function getMotivationalQuote() {
            const categories = Object.keys(quotesDatabase);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const categoryQuotes = quotesDatabase[randomCategory];
            const randomQuote = categoryQuotes[Math.floor(Math.random() * categoryQuotes.length)];
            
            displayQuote(randomQuote, randomCategory);
            
            addChatMessage(`üí´ **Inspirational Quote:**\n\n"${randomQuote.text}"\n\n‚Äî ${randomQuote.author}`, 'ai');
        }

        function displayQuote(quote, category) {
            document.getElementById('quoteText').textContent = `"${quote.text}"`;
            document.getElementById('quoteAuthor').textContent = `‚Äî ${quote.author}`;
            document.getElementById('quoteCategory').textContent = category.charAt(0).toUpperCase() + category.slice(1);
        }

        function getPersonalMotivation() {
            const userName = currentUser ? currentUser.name : 'friend';
            const template = personalizedMotivation[motivationCount % personalizedMotivation.length];
            const message = template.replace('{name}', userName);
            
            const quote = getRandomQuote('motivation');
            
            motivationCount++;
            
            const response = `${message}\n\n‚ú® **Inspirational Quote:**\n*"${quote.text}"* ‚Äî ${quote.author}\n\nüí™ Keep pushing forward, ${userName}! You're building something amazing!`;
            
            addChatMessage(response, 'ai');
            voiceManager.speak(`${userName}, you're doing amazing! ${quote.text}`);
        }

        function getRandomQuote(category = 'motivation') {
            const quotes = quotesDatabase[category] || quotesDatabase.motivation;
            return quotes[Math.floor(Math.random() * quotes.length)];
        }

        // Task Functions
        function createTaskWithUltraAI() {
            const input = document.getElementById('ultraAIInput');
            const message = input.value.trim();
            
            if (!message) {
                showToast('‚ùå Please describe your task');
                return;
            }
            
            const newTask = {
                id: Date.now(),
                title: message,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                duration: 60,
                completed: false,
                createdAt: new Date(),
                createdBy: 'Ultra AI'
            };
            
            tasks.push(newTask);
            input.value = '';
            renderTasks();
            
            const userName = currentUser ? currentUser.name : 'friend';
            addChatMessage(`‚úÖ **Task Created Successfully!**\n\nüìã **Activity:** ${message}\n‚è∞ **Time:** ${newTask.time}\n‚è±Ô∏è **Duration:** 60 minutes\n\nGreat work, ${userName}! Your task is ready to go! üöÄ`, 'ai');
            voiceManager.speak(`Task created successfully, ${userName}! ${message} is now in your schedule.`);
            showToast('‚úÖ Task created successfully!');
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                
                if (task.completed) {
                    completedTasks.push({ ...task, completedAt: new Date() });
                    const userName = currentUser ? currentUser.name : 'friend';
                    voiceManager.speak(`Great job, ${userName}! You completed ${task.title}`);
                    showToast('üéâ Task completed!');
                }
                
                renderTasks();
                updateProgress();
            }
        }

        function removeTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            completedTasks = completedTasks.filter(t => t.id !== id);
            renderTasks();
            updateProgress();
            showToast('üóëÔ∏è Task removed');
        }

        function renderTasks() {
            const container = document.getElementById('tasksList');
            const summary = document.getElementById('tasksSummary');
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div style="font-size: 64px; margin-bottom: 20px;">üéØ</div>
                        <div style="font-size: 18px; font-weight: 500;">Your productivity journey starts here!</div>
                        <div style="font-size: 15px; margin-top: 8px;">Create your first task above</div>
                    </div>
                `;
                summary.textContent = 'Ready to conquer your goals';
                return;
            }
            
            const today = new Date().toDateString();
            const todayTasks = tasks.filter(t => t.createdAt.toDateString() === today);
            const completedToday = todayTasks.filter(t => t.completed).length;
            
            summary.textContent = `${completedToday}/${todayTasks.length} completed today`;
            
            container.innerHTML = '';
            
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                if (task.completed) taskElement.classList.add('completed');
                
                taskElement.innerHTML = `
                    <div class="task-main">
                        <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id})"></div>
                        <div class="task-info">
                            <div class="task-title" ${task.completed ? 'style="text-decoration: line-through; opacity: 0.7;"' : ''}>${task.title}</div>
                            <div class="task-meta">
                                <span>‚è∞ ${task.time}</span>
                                <span>‚è±Ô∏è ${task.duration} min</span>
                                <span>ü§ñ ${task.createdBy}</span>
                            </div>
                        </div>
                        <button onclick="removeTask(${task.id})" style="padding: 8px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); cursor: pointer;">Remove</button>
                    </div>
                `;
                container.appendChild(taskElement);
            });
            
            updateProgress();
        }

        function updateProgress() {
            const today = new Date().toDateString();
            const todayTasks = tasks.filter(t => t.createdAt.toDateString() === today);
            const completedToday = todayTasks.filter(t => t.completed).length;
            const totalToday = todayTasks.length;
            const percentage = totalToday > 0 ? (completedToday / totalToday) * 100 : 0;
            
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 60;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            document.getElementById('progressPercent').textContent = `${Math.round(percentage)}%`;
            
            // Update stats
            document.getElementById('completionRate').textContent = `${Math.round(percentage)}%`;
            document.getElementById('totalTasks').textContent = totalToday;
            document.getElementById('streakCount').textContent = completedToday;
            
            const messageElement = document.getElementById('dailyMessage');
            if (percentage >= 100) {
                messageElement.textContent = "Perfect day! üéâ";
            } else if (percentage >= 80) {
                messageElement.textContent = "Almost there! üåü";
            } else if (percentage >= 50) {
                messageElement.textContent = "Great progress! üí™";
            } else if (percentage > 0) {
                messageElement.textContent = "Keep going! üöÄ";
            } else {
                messageElement.textContent = "Ready to achieve greatness!";
            }
        }

        // AI Chat Functions
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateAIResponse(message);
                addChatMessage(response, 'ai');
            }, 1500);
        }

        function addChatMessage(message, sender) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            
            if (sender === 'ai') {
                div.innerHTML = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            } else {
                div.textContent = message;
            }
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.add('show');
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('show');
        }

        function generateAIResponse(message) {
            const userName = currentUser ? currentUser.name : 'friend';
            
            if (message.toLowerCase().includes('motivat')) {
                const motivation = personalizedMotivation[Math.floor(Math.random() * personalizedMotivation.length)];
                return motivation.replace('{name}', userName);
            }
            
            if (message.toLowerCase().includes('tip') || message.toLowerCase().includes('advice')) {
                const tips = [
                    `üéØ **Focus Tip for ${userName}:** Try the Pomodoro Technique - 25 minutes focused work, 5 minutes break!`,
                    `‚ö° **Productivity Hack for ${userName}:** Use time-blocking to schedule your most important tasks during peak energy hours!`,
                    `üß† **Study Strategy for ${userName}:** Practice active recall - test yourself instead of just re-reading notes!`,
                    `üì± **Digital Wellness for ${userName}:** Put your phone in 'Do Not Disturb' mode during focused work sessions!`
                ];
                return tips[Math.floor(Math.random() * tips.length)];
            }
            
            if (message.toLowerCase().includes('quote') || message.toLowerCase().includes('inspir')) {
                const quote = getRandomQuote('motivation');
                return `‚ú® **Inspirational Quote for ${userName}:**\n\n"${quote.text}"\n\n‚Äî ${quote.author}`;
            }
            
            // Default responses
            const responses = [
                `Hi ${userName}! I'm your Ultra AI productivity companion. I can help you create tasks, provide motivation, and track your progress. What would you like to accomplish today?`,
                `Great question, ${userName}! As your AI assistant, I'm here to help optimize your productivity and keep you motivated. How can I support your goals?`,
                `${userName}, I'm equipped with advanced AI to understand your productivity needs. Whether you need task management, study tips, or motivation - I'm here to help!`,
                `Ready to boost your productivity, ${userName}? I can assist with intelligent task creation, provide personalized insights, and help you stay focused on your goals!`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function quickAction(type) {
            const userName = currentUser ? currentUser.name : 'friend';
            let response = '';
            
            switch(type) {
                case 'motivation':
                    getPersonalMotivation();
                    return;
                case 'tips':
                    response = `üéØ **Pro Tip for ${userName}:** Focus on being productive instead of busy. Schedule your priorities, don't prioritize your schedule!`;
                    break;
                case 'quote':
                    getMotivationalQuote();
                    return;
                case 'focus':
                    response = `üßò **Focus Strategy for ${userName}:** Try the 2-minute rule - if something takes less than 2 minutes, do it immediately!`;
                    break;
                case 'study':
                    response = `üìö **Study Power for ${userName}:** Use spaced repetition - review material at increasing intervals for better retention!`;
                    break;
            }
            
            addChatMessage(response, 'ai');
            voiceManager.speak(response.replace(/\*\*/g, ''));
        }

        // ChatGPT Functions
        function askChatGPT() {
            const input = document.getElementById('chatgptInput');
            const question = input.value.trim();
            
            if (!question) {
                showToast('‚ùå Please enter a question');
                return;
            }
            
            const startTime = Date.now();
            
            // Simulate AI response
            setTimeout(() => {
                const endTime = Date.now();
                const response = generateChatGPTResponse(question);
                
                document.getElementById('chatgptAnswer').innerHTML = response;
                document.getElementById('chatgptResponse').classList.add('show');
                document.getElementById('responseTime').textContent = `${endTime - startTime}ms`;
                document.getElementById('wordCount').textContent = response.split(' ').length;
                
                lastChatGPTResponse = response;
            }, 1000 + Math.random() * 2000);
        }

        function generateChatGPTResponse(question) {
            const responses = [
                `**Great question!** Let me provide a comprehensive answer to help you understand this topic better.\n\nThis is a complex subject that involves multiple factors and considerations. Based on current research and best practices, here's what you should know:\n\n‚Ä¢ **Key Point 1:** The fundamental principle behind this concept\n‚Ä¢ **Key Point 2:** Practical applications and real-world examples\n‚Ä¢ **Key Point 3:** Important considerations and potential challenges\n\nFor the best results, I recommend taking a systematic approach and considering multiple perspectives. Would you like me to elaborate on any specific aspect?`,
                
                `**Excellent inquiry!** This is actually a fascinating topic that has significant implications.\n\n**Background:** Understanding the context is crucial for grasping the full picture.\n\n**Analysis:** Breaking this down into manageable components:\n1. Primary factors to consider\n2. Secondary influences and variables\n3. Potential outcomes and implications\n\n**Conclusion:** The most effective approach typically involves balancing multiple considerations while staying focused on your primary objectives.\n\nI hope this helps clarify things! Feel free to ask follow-up questions.`,
                
                `**Thank you for this thoughtful question!** Let me walk you through a detailed explanation.\n\n**The Core Concept:**\nThis involves several interconnected elements that work together to create the overall effect you're asking about.\n\n**Step-by-Step Process:**\n1. Initial setup and preparation\n2. Implementation and execution\n3. Monitoring and adjustment\n4. Evaluation and optimization\n\n**Best Practices:**\n‚Ä¢ Focus on consistent application\n‚Ä¢ Monitor progress regularly\n‚Ä¢ Adjust strategy based on results\n‚Ä¢ Maintain long-term perspective\n\n**Final Thoughts:** Success in this area typically comes from understanding both the theory and practical application.`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function clearChatGPT() {
            document.getElementById('chatgptInput').value = '';
            document.getElementById('chatgptResponse').classList.remove('show');
        }

        function speakResponse() {
            if (lastChatGPTResponse) {
                const cleanResponse = lastChatGPTResponse.replace(/\*\*/g, '').replace(/‚Ä¢/g, '').replace(/\n/g, ' ');
                voiceManager.speak(cleanResponse);
            } else {
                showToast('‚ùå No response to speak');
            }
        }

        function saveResponse() {
            if (lastChatGPTResponse) {
                const dataStr = `FlowState Pro - AI Response\n\nQuestion: ${document.getElementById('chatgptInput').value}\n\nAnswer: ${lastChatGPTResponse}\n\nDate: ${new Date().toLocaleString()}`;
                const dataBlob = new Blob([dataStr], {type: 'text/plain'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = 'flowstate-ai-response.txt';
                link.click();
                
                showToast('üíæ Response saved successfully!');
            } else {
                showToast('‚ùå No response to save');
            }
        }

        // User Interface Functions
        function showProfile() {
            if (!currentUser) {
                showToast('üë§ Please log in to view profile');
                return;
            }
            
            const profile = `**${currentUser.name}'s Profile**\n\nüìß Email: ${currentUser.email}\nüìÖ Member since: ${new Date(currentUser.createdAt).toLocaleDateString()}\nüéØ Tasks completed: ${completedTasks.length}\nüìä Study time: ${Math.floor(studyStats.totalStudyTime / 60)}h ${studyStats.totalStudyTime % 60}m`;
            addChatMessage(profile, 'ai');
        }

        function showStats() {
            const stats = `üìä **Your Productivity Statistics:**\n\n‚úÖ Total tasks: ${tasks.length + completedTasks.length}\nüèÜ Completed: ${completedTasks.length}\nüìö Study sessions: ${studyStats.studyStreak}\n‚è±Ô∏è Total study time: ${Math.floor(studyStats.totalStudyTime / 60)}h ${studyStats.totalStudyTime % 60}m\nüî• Current streak: ${studyStats.studyStreak} days`;
            addChatMessage(stats, 'ai');
        }

        function exportData() {
            const data = {
                user: currentUser,
                tasks: tasks,
                completedTasks: completedTasks,
                studyStats: studyStats,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'flowstate-pro-data.json';
            link.click();
            
            showToast('üì§ Data exported successfully!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            tasks = data.tasks || [];
                            completedTasks = data.completedTasks || [];
                            studyStats = data.studyStats || studyStats;
                            renderTasks();
                            updateProgress();
                            showToast('üì• Data imported successfully!');
                        } catch (error) {
                            showToast('‚ùå Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function showSettings() {
            showToast('‚öôÔ∏è Settings panel coming soon!');
        }

        function showHelp() {
            const help = `üÜò **FlowState Pro Help:**\n\nüé§ **Voice Commands:** Click the microphone and describe tasks naturally\nü§ñ **AI Assistant:** Ask questions, get motivation, and productivity tips\nüìã **Task Creation:** Use natural language like "Study math at 7 PM for 2 hours"\nüéØ **Progress:** Track daily completion rates and study statistics\nüé® **Themes:** Switch between Light, Dark, and Elegant themes\n\nNeed more help? Just ask the AI assistant!`;
            addChatMessage(help, 'ai');
        }

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ FlowState Pro initializing...');
            
            // Load saved theme
            const savedTheme = localStorage.getItem('flowstate-theme') || 'light';
            setTheme(savedTheme);
            
            // Check if user is already logged in
            if (userManager.currentUser) {
                userManager.login(userManager.currentUser);
            }
            
            // Add form event listener
            document.getElementById('authForm').addEventListener('submit', handleAuth);
            
            // Add enter key listeners
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            document.getElementById('ultraAIInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') createTaskWithUltraAI();
            });
            
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showToast('üîî System notifications enabled!');
                    }
                });
            }
            
            // Initial render
            renderTasks();
            
            // Show initial quote
            setTimeout(() => {
                getMotivationalQuote();
            }, 1000);
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.user-profile')) {
                    document.getElementById('userDropdown').classList.remove('show');
                }
            });
            
            console.log('‚úÖ FlowState Pro initialized successfully!');
        });
    </script>
</body>
</html>
