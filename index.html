<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowState Pro - Ultimate AI Productivity Companion</title>
    <meta name="description" content="Ultimate AI productivity companion with real-time ChatGPT, voice AI, and personalized coaching">
    
    <!-- Force cache refresh -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <meta name="theme-color" content="#007AFF">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Enhanced Service Worker with forced updates
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ Service Worker registered');
                        
                        // Check for updates immediately
                        registration.update();
                        
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateBanner();
                                }
                            });
                        });
                        
                        navigator.serviceWorker.addEventListener('controllerchange', function() {
                            window.location.reload();
                        });
                    })
                    .catch(function(err) {
                        console.log('‚ùå Service Worker registration failed:', err);
                    });
            });
        }

        function showUpdateBanner() {
            const banner = document.createElement('div');
            banner.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; background: #007AFF; color: white; padding: 16px; text-align: center; z-index: 9999;">
                    üÜï New features available! 
                    <button onclick="updateApp()" style="margin-left: 12px; padding: 8px 16px; background: white; color: #007AFF; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                        Update Now
                    </button>
                </div>
            `;
            document.body.appendChild(banner);
        }

        function updateApp() {
            navigator.serviceWorker.getRegistration().then(function(registration) {
                if (registration && registration.waiting) {
                    registration.waiting.postMessage({type: 'SKIP_WAITING'});
                }
            });
        }
    </script>
    
    <style>
        :root {
            --bg-primary: #f2f2f7;
            --bg-secondary: rgba(255, 255, 255, 0.9);
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --primary-color: #007AFF;
            --success-color: #34c759;
            --danger-color: #ff3b30;
            --border-color: rgba(60, 60, 67, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --card-bg: rgba(255, 255, 255, 0.8);
        }

        [data-theme="dark"] {
            --bg-primary: #000000;
            --bg-secondary: rgba(28, 28, 30, 0.9);
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --primary-color: #0a84ff;
            --border-color: rgba(84, 84, 88, 0.3);
            --card-bg: rgba(28, 28, 30, 0.8);
        }

        [data-theme="elegant"] {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #667eea;
            --text-primary: #2d3748;
            --card-bg: rgba(255, 255, 255, 0.85);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .app-logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-color), #5856D6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            font-weight: 700;
        }

        .app-name {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .theme-selector {
            display: flex;
            gap: 8px;
            padding: 4px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .theme-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .theme-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .auth-modal.hidden {
            display: none;
        }

        .auth-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-input {
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .auth-btn {
            padding: 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .input-field {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            flex: 1;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
        }

        .message {
            margin-bottom: 16px;
            padding: 12px 16px;
            border-radius: 16px;
            max-width: 80%;
        }

        .message.user {
            background: var(--primary-color);
            color: white;
            margin-left: auto;
        }

        .message.ai {
            background: white;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .voice-btn {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 18px;
        }

        .voice-btn.listening {
            background: var(--danger-color);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            cursor: pointer;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Authentication Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <h2 id="authTitle">Welcome to FlowState Pro</h2>
            <p id="authSubtitle">Create your account to get started</p>
            <form class="auth-form" id="authForm">
                <input type="text" class="auth-input" id="nameInput" placeholder="Full Name" style="display: none;">
                <input type="email" class="auth-input" id="emailInput" placeholder="Email Address" required>
                <input type="password" class="auth-input" id="passwordInput" placeholder="Password" required>
                <input type="password" class="auth-input" id="confirmPasswordInput" placeholder="Confirm Password" style="display: none;">
                <button type="submit" class="auth-btn" id="authSubmitBtn">Sign In</button>
            </form>
            <p style="margin-top: 20px;">
                <span id="authSwitchText">Don't have an account?</span>
                <a href="#" id="authSwitchLink" onclick="toggleAuthMode()">Sign Up</a>
            </p>
        </div>
    </div>

    <div class="app-container">
        <!-- App Header -->
        <div class="app-header">
            <div class="app-title">
                <div class="app-logo">FS</div>
                <div>
                    <div class="app-name">FlowState Pro</div>
                    <div style="font-size: 16px; color: var(--text-secondary);">Ultimate AI Productivity Companion</div>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="theme-selector">
                    <button class="theme-btn active" onclick="setTheme('light')">Light</button>
                    <button class="theme-btn" onclick="setTheme('dark')">Dark</button>
                    <button class="theme-btn" onclick="setTheme('elegant')">Elegant</button>
                </div>
                <div class="user-profile" onclick="toggleUserMenu()">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div id="userName">User</div>
                </div>
            </div>
        </div>

        <!-- Voice Controls -->
        <div class="voice-controls">
            <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">üé§</button>
            <div>
                <select id="voiceGender" onchange="updateVoice()">
                    <option value="female">Female Voice</option>
                    <option value="male">Male Voice</option>
                </select>
            </div>
            <div id="voiceStatus">Voice ready</div>
        </div>

        <!-- Quote Display -->
        <div style="background: var(--card-bg); border-radius: 16px; padding: 24px; margin-bottom: 24px; border-left: 4px solid var(--primary-color);">
            <div style="font-style: italic; font-size: 18px; margin-bottom: 12px;" id="quoteText">
                "The way to get started is to quit talking and begin doing."
            </div>
            <div style="font-weight: 600; color: var(--primary-color);" id="quoteAuthor">‚Äî Walt Disney</div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
                <!-- AI Assistant -->
                <div class="card">
                    <div class="card-title">üß† Ultra AI Assistant</div>
                    <div class="card-subtitle">Personalized AI coach with motivational guidance</div>
                    
                    <div class="chat-messages" id="chatMessages"></div>
                    
                    <div style="display: flex; gap: 12px;">
                        <input type="text" class="input-field" id="chatInput" placeholder="Ask me anything...">
                        <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;">
                        <button onclick="quickAction('progress')" style="padding: 6px 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; cursor: pointer;">üìä Progress</button>
                        <button onclick="quickAction('tips')" style="padding: 6px 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; cursor: pointer;">üí° Tips</button>
                        <button onclick="quickAction('motivation')" style="padding: 6px 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; cursor: pointer;">üöÄ Motivate</button>
                    </div>
                </div>

                <!-- Task Creation -->
                <div class="card">
                    <div class="card-title">üéØ Smart Task Creator</div>
                    <div class="card-subtitle">AI-powered task creation with voice support</div>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <input type="text" class="input-field" id="taskInput" placeholder="Describe your task...">
                        <button class="btn btn-primary" onclick="createTask()">Create</button>
                    </div>
                </div>

                <!-- Doubt Resolution -->
                <div class="card">
                    <div class="card-title">ü§î Ask Your Doubts</div>
                    <div class="card-subtitle">Get instant help with ChatGPT AI</div>
                    
                    <textarea style="width: 100%; height: 80px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); resize: vertical;" id="doubtInput" placeholder="Ask any question..."></textarea>
                    
                    <div style="margin-top: 12px;">
                        <button class="btn btn-primary" onclick="resolveDoubt()">üß† Get AI Help</button>
                    </div>
                    
                    <div id="doubtResponse" style="margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 8px; display: none;"></div>
                </div>
            </div>

            <!-- Right Panel -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
                <!-- Today's Tasks -->
                <div class="card">
                    <div class="card-title">üìã Today's Tasks</div>
                    <div class="card-subtitle" id="tasksSummary">No tasks yet</div>
                    <div id="tasksList">
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                            <div>Create your first task!</div>
                        </div>
                    </div>
                </div>

                <!-- Progress -->
                <div class="card">
                    <div class="card-title">üéØ Daily Progress</div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="width: 100px; height: 100px; margin: 0 auto; position: relative;">
                            <svg style="width: 100%; height: 100%; transform: rotate(-90deg);">
                                <circle cx="50" cy="50" r="40" fill="none" stroke="var(--border-color)" stroke-width="6"></circle>
                                <circle cx="50" cy="50" r="40" fill="none" stroke="var(--primary-color)" stroke-width="6" stroke-dasharray="251" stroke-dashoffset="251" id="progressCircle"></circle>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                <div style="font-size: 20px; font-weight: 700; color: var(--primary-color);" id="progressPercent">0%</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Complete</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let currentUser = null;
        let tasks = [];
        let isLoggedIn = false;
        let isListening = false;
        let selectedVoice = null;
        let recognition = null;

        // Famous Quotes Database
        const quotes = {
            motivation: [
                { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
                { text: "Innovation distinguishes between a leader and a follower.", author: "Steve Jobs" },
                { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
                { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" }
            ],
            superhero: [
                { text: "With great power comes great responsibility.", author: "Spider-Man (Uncle Ben)" },
                { text: "I am vengeance, I am the night, I am Batman.", author: "Batman" },
                { text: "It's not who I am underneath, but what I do that defines me.", author: "Batman" }
            ]
        };

        // User Management
        class UserManager {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('flowstate-users') || '{}');
                this.currentUser = JSON.parse(localStorage.getItem('flowstate-current-user') || 'null');
                if (!this.currentUser) {
                    this.showAuth();
                } else {
                    this.login(this.currentUser);
                }
            }

            showAuth() {
                document.getElementById('authModal').classList.remove('hidden');
            }

            hideAuth() {
                document.getElementById('authModal').classList.add('hidden');
            }

            register(name, email, password) {
                const user = {
                    id: Date.now(),
                    name,
                    email,
                    password,
                    tasks: [],
                    preferences: { theme: 'light', voice: 'female' }
                };
                this.users[email] = user;
                localStorage.setItem('flowstate-users', JSON.stringify(this.users));
                return user;
            }

            login(user) {
                this.currentUser = user;
                currentUser = user;
                isLoggedIn = true;
                localStorage.setItem('flowstate-current-user', JSON.stringify(user));
                
                document.getElementById('userName').textContent = user.name;
                document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
                
                tasks = user.tasks || [];
                this.hideAuth();
                renderTasks();
                
                // Welcome message
                setTimeout(() => {
                    addChatMessage(`Welcome back, ${user.name}! I'm your AI productivity coach. How can I help you achieve your goals today?`, 'ai');
                    speakText(`Welcome back, ${user.name}! Ready to be productive?`);
                }, 1000);
            }

            saveData() {
                if (this.currentUser) {
                    this.currentUser.tasks = tasks;
                    this.users[this.currentUser.email] = this.currentUser;
                    localStorage.setItem('flowstate-users', JSON.stringify(this.users));
                    localStorage.setItem('flowstate-current-user', JSON.stringify(this.currentUser));
                }
            }
        }

        // Initialize User Manager
        const userManager = new UserManager();

        // Voice Management
        function initVoice() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    isListening = true;
                    document.getElementById('voiceBtn').classList.add('listening');
                    document.getElementById('voiceStatus').textContent = 'Listening...';
                };
                
                recognition.onend = () => {
                    isListening = false;
                    document.getElementById('voiceBtn').classList.remove('listening');
                    document.getElementById('voiceStatus').textContent = 'Voice ready';
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    processVoiceCommand(transcript);
                };
            }

            // Initialize text-to-speech
            if ('speechSynthesis' in window) {
                speechSynthesis.onvoiceschanged = updateVoiceOptions;
                updateVoiceOptions();
            }
        }

        function updateVoiceOptions() {
            const voices = speechSynthesis.getVoices();
            const genderPref = document.getElementById('voiceGender').value;
            
            selectedVoice = voices.find(voice => {
                if (genderPref === 'female') {
                    return voice.name.toLowerCase().includes('female') || 
                           voice.name.toLowerCase().includes('samantha') ||
                           voice.name.toLowerCase().includes('karen');
                } else {
                    return voice.name.toLowerCase().includes('male') || 
                           voice.name.toLowerCase().includes('daniel') ||
                           voice.name.toLowerCase().includes('alex');
                }
            }) || voices[0];
        }

        function speakText(text) {
            if ('speechSynthesis' in window && selectedVoice) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = selectedVoice;
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                speechSynthesis.speak(utterance);
            }
        }

        function toggleVoice() {
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function processVoiceCommand(command) {
            document.getElementById('voiceStatus').textContent = `Heard: "${command}"`;
            
            if (command.toLowerCase().includes('create') || command.toLowerCase().includes('task')) {
                document.getElementById('taskInput').value = command;
                createTask();
            } else {
                document.getElementById('chatInput').value = command;
                sendMessage();
            }
        }

        function updateVoice() {
            updateVoiceOptions();
            userManager.saveData();
        }

        // AI Assistant
        class AIAssistant {
            constructor() {
                this.motivationIndex = 0;
            }

            async processMessage(message) {
                // Task creation
                if (this.isTaskRequest(message)) {
                    return this.handleTaskCreation(message);
                }

                // Progress request
                if (message.toLowerCase().includes('progress')) {
                    return this.getProgressReport();
                }

                // Tips request
                if (message.toLowerCase().includes('tip')) {
                    return this.getProductivityTip();
                }

                // Motivation request
                if (message.toLowerCase().includes('motivat')) {
                    return this.getMotivation();
                }

                return this.getGeneralResponse(message);
            }

            isTaskRequest(message) {
                return /create|add|schedule|remind|task/i.test(message);
            }

            handleTaskCreation(message) {
                const task = this.extractTaskFromMessage(message);
                if (task.title) {
                    tasks.push(task);
                    renderTasks();
                    userManager.saveData();
                    
                    const quote = this.getRandomQuote('motivation');
                    return `‚úÖ Task "${task.title}" created for ${task.time}!\n\nüí° Inspiration: "${quote.text}" ‚Äî ${quote.author}`;
                }
                return "I'd love to help you create a task! Please provide more details.";
            }

            extractTaskFromMessage(message) {
                const title = message.replace(/create|add|schedule|task|remind me to/gi, '').trim() || 'New Task';
                const timeMatch = message.match(/(\d{1,2}:\d{2}|\d{1,2}\s*(am|pm))/i);
                const time = timeMatch ? timeMatch[0] : '09:00';
                
                return {
                    id: Date.now(),
                    title: title.charAt(0).toUpperCase() + title.slice(1),
                    time: time,
                    completed: false,
                    createdAt: new Date()
                };
            }

            getProgressReport() {
                const completed = tasks.filter(t => t.completed).length;
                const total = tasks.length;
                const rate = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                return `üìä Progress Report for ${currentUser?.name || 'you'}:\n\n‚úÖ Completed: ${completed}/${total} tasks\nüìà Success Rate: ${rate}%\n\n${this.getMotivationalMessage(rate)}`;
            }

            getProductivityTip() {
                const tips = [
                    "üéØ Use the 2-minute rule: If it takes less than 2 minutes, do it now!",
                    "‚ö° Schedule your hardest tasks during your peak energy hours.",
                    "üîÑ Try time-blocking: assign specific time slots to different activities.",
                    "üì± Put your phone in another room during focused work sessions.",
                    "üß† Take a 5-minute break every 25 minutes to stay sharp."
                ];
                return tips[Math.floor(Math.random() * tips.length)];
            }

            getMotivation() {
                const motivations = [
                    `üåü ${currentUser?.name || 'Champion'}, you're building something amazing!`,
                    `üí™ Keep going, ${currentUser?.name || 'Achiever'}! Every step counts!`,
                    `üöÄ ${currentUser?.name || 'Star'}, your consistency is inspiring!`,
                    `‚ö° You've got this, ${currentUser?.name || 'Winner'}! Stay focused!`
                ];
                
                this.motivationIndex = (this.motivationIndex + 1) % motivations.length;
                return motivations[this.motivationIndex];
            }

            getMotivationalMessage(rate) {
                if (rate >= 80) return `üéâ Outstanding work, ${currentUser?.name || 'Champion'}!`;
                if (rate >= 60) return `üéØ Great progress, ${currentUser?.name || 'Achiever'}!`;
                if (rate >= 40) return `üí™ Keep building momentum, ${currentUser?.name || 'Fighter'}!`;
                return `üöÄ Every journey starts with a single step, ${currentUser?.name || 'Explorer'}!`;
            }

            getGeneralResponse(message) {
                const responses = [
                    `Great question, ${currentUser?.name || 'friend'}! I'm here to help you stay productive and motivated.`,
                    `${currentUser?.name || 'Champion'}, I'm your AI productivity coach! How can I help you achieve your goals?`,
                    `Ready to boost your productivity, ${currentUser?.name || 'Star'}? Let's make today amazing!`
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            getRandomQuote(category) {
                const quoteArray = quotes[category] || quotes.motivation;
                return quoteArray[Math.floor(Math.random() * quoteArray.length)];
            }

            displayQuote(category = 'motivation') {
                const quote = this.getRandomQuote(category);
                document.getElementById('quoteText').textContent = `"${quote.text}"`;
                document.getElementById('quoteAuthor').textContent = `‚Äî ${quote.author}`;
            }
        }

        const aiAssistant = new AIAssistant();

        // ChatGPT-style Doubt Resolution
        async function resolveDoubt() {
            const question = document.getElementById('doubtInput').value.trim();
            if (!question) return;

            const response = document.getElementById('doubtResponse');
            response.style.display = 'block';
            response.innerHTML = '<div>ü§î Thinking...</div>';

            // Simulate AI processing
            setTimeout(() => {
                const answer = generateEducationalResponse(question);
                response.innerHTML = answer;
                speakText('I found an answer to your question. Please check the response.');
            }, 2000);
        }

        function generateEducationalResponse(question) {
            return `
                <div style="line-height: 1.6;">
                    <strong>üß† AI Learning Assistant Response:</strong><br><br>
                    Based on your question: "<em>${question}</em>"<br><br>
                    <strong>Key Concept:</strong> Let me break this down into understandable parts.<br>
                    <strong>Explanation:</strong> Here's a step-by-step approach to understanding this topic.<br>
                    <strong>Study Tip:</strong> Practice regularly and connect this to real-world examples.<br><br>
                    <em>üí° Remember: Every expert was once a beginner. Keep asking questions, ${currentUser?.name || 'learner'}!</em>
                </div>
            `;
        }

        // UI Functions
        function toggleAuthMode() {
            const isLogin = document.getElementById('authTitle').textContent.includes('Sign In');
            
            if (isLogin) {
                document.getElementById('authTitle').textContent = 'Create Account';
                document.getElementById('nameInput').style.display = 'block';
                document.getElementById('confirmPasswordInput').style.display = 'block';
                document.getElementById('authSubmitBtn').textContent = 'Create Account';
                document.getElementById('authSwitchText').textContent = 'Already have an account?';
                document.getElementById('authSwitchLink').textContent = 'Sign In';
            } else {
                document.getElementById('authTitle').textContent = 'Welcome Back';
                document.getElementById('nameInput').style.display = 'none';
                document.getElementById('confirmPasswordInput').style.display = 'none';
                document.getElementById('authSubmitBtn').textContent = 'Sign In';
                document.getElementById('authSwitchText').textContent = "Don't have an account?";
                document.getElementById('authSwitchLink').textContent = 'Sign Up';
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage(message, 'user');
            input.value = '';

            const response = await aiAssistant.processMessage(message);
            addChatMessage(response, 'ai');
            speakText(response.replace(/[üéØüí™üöÄ‚ö°üåüüìä‚úÖüìàüîÑüì±üß†]/g, ''));
        }

        function addChatMessage(message, sender) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.innerHTML = message.replace(/\n/g, '<br>');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function createTask() {
            const input = document.getElementById('taskInput');
            const message = input.value.trim();
            if (!message) return;

            input.value = '';
            addChatMessage(message, 'user');
            
            const response = aiAssistant.handleTaskCreation(message);
            addChatMessage(response, 'ai');
            speakText(`Task created successfully! ${aiAssistant.getMotivation()}`);
        }

        function renderTasks() {
            const container = document.getElementById('tasksList');
            const summary = document.getElementById('tasksSummary');
            
            if (tasks.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);"><div style="font-size: 48px; margin-bottom: 16px;">üìù</div><div>Create your first task!</div></div>';
                summary.textContent = 'No tasks yet';
                return;
            }

            const completed = tasks.filter(t => t.completed).length;
            summary.textContent = `${completed}/${tasks.length} completed`;

            container.innerHTML = '';
            tasks.forEach(task => {
                const div = document.createElement('div');
                div.style.cssText = 'display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--bg-secondary); border-radius: 12px; margin-bottom: 12px; border: 1px solid var(--border-color);';
                div.innerHTML = `
                    <div style="width: 20px; height: 20px; border: 2px solid var(--primary-color); border-radius: 50%; cursor: pointer; ${task.completed ? 'background: var(--primary-color); color: white; display: flex; align-items: center; justify-content: center;' : ''}" onclick="toggleTask(${task.id})">
                        ${task.completed ? '‚úì' : ''}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--text-primary);">${task.title}</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">${task.time}</div>
                    </div>
                    <button onclick="removeTask(${task.id})" style="padding: 6px 12px; background: var(--danger-color); color: white; border: none; border-radius: 6px; cursor: pointer;">Remove</button>
                `;
                container.appendChild(div);
            });

            updateProgress();
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                if (task.completed) {
                    const quote = aiAssistant.getRandomQuote('superhero');
                    addChatMessage(`üéâ Task completed! Remember: "${quote.text}" ‚Äî ${quote.author}`, 'ai');
                    speakText(`Great job ${currentUser?.name}! Task completed. ${quote.text}`);
                }
                renderTasks();
                userManager.saveData();
            }
        }

        function removeTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            renderTasks();
            userManager.saveData();
        }

        function updateProgress() {
            const completed = tasks.filter(t => t.completed).length;
            const total = tasks.length;
            const percentage = total > 0 ? (completed / total) * 100 : 0;
            
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 40;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            document.getElementById('progressPercent').textContent = `${Math.round(percentage)}%`;
        }

        function quickAction(type) {
            const actions = {
                progress: 'Show my progress report',
                tips: 'Give me a productivity tip',
                motivation: 'I need motivation'
            };
            document.getElementById('chatInput').value = actions[type];
            sendMessage();
        }

        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase() === theme);
            });
            if (currentUser) {
                currentUser.preferences.theme = theme;
                userManager.saveData();
            }
        }

        function toggleUserMenu() {
            // User menu functionality
        }

        // Auth form handling
        document.getElementById('authForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            const isRegister = document.getElementById('nameInput').style.display !== 'none';
            
            try {
                if (isRegister) {
                    const name = document.getElementById('nameInput').value;
                    const user = userManager.register(name, email, password);
                    userManager.login(user);
                } else {
                    const user = userManager.users[email];
                    if (user && user.password === password) {
                        userManager.login(user);
                    } else {
                        throw new Error('Invalid credentials');
                    }
                }
            } catch (error) {
                alert(error.message);
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initVoice();
            aiAssistant.displayQuote();
            
            // Enable enter key for inputs
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            document.getElementById('taskInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') createTask();
            });
            
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });
    </script>
</body>
</html>
